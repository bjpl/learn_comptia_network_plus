import{b as e,g as t,a as r}from"./react-vendor-jGr1bFq6.js";import{g as n,M as a,I as i,h as o,D as s,i as l,Q as c,d as u,O as f,P as d,j as h,k as p,c as v,l as g,m,n as y,H as b,F as w,o as x,p as S,f as _,q as U,r as T,s as k,t as E,u as M,v as C,w as A,x as F,y as P,z as O,E as I,G as R,J as D,K as L,X as B,Y as G,Z as j,_ as z,$ as N,a0 as W,a1 as H,a2 as V,S as X,a3 as Y,W as q,a4 as $,a5 as Z,a6 as K,a7 as Q,a8 as J,a9 as ee,U as te,aa as re,ab as ne,ac as ae,ad as ie,ae as oe,af as se,ag as le,ah as ce,ai as ue,aj as fe}from"./three-core-djLeyVVM.js";import{u as de,s as he,a as pe,e as ve,b as ge,c as me,d as ye}from"./three-fiber-v_RWOTGE.js";var be,we={};const xe=t(function(){if(be)return we;be=1;var t=e();return we.createRoot=t.createRoot,we.hydrateRoot=t.hydrateRoot,we}()),Se={BASE_URL:"/learn_comptia_network_plus/",DEV:!1,MODE:"production",PROD:!0,SSR:!1,VITE_API_TIMEOUT:"10000",VITE_API_URL:"http://localhost:3000/api",VITE_ENV:"development",VITE_USE_MOCK_API:"true"},_e=new Map,Ue=e=>{const t=_e.get(e);return t?Object.fromEntries(Object.entries(t.stores).map(([e,t])=>[e,t.getState()])):{}},Te=e=>{var t,r;if(!e)return;const n=e.split("\n"),a=n.findIndex(e=>e.includes("api.setState"));if(a<0)return;const i=(null==(t=n[a+1])?void 0:t.trim())||"";return null==(r=/.+ (.+) .+/.exec(i))?void 0:r[1]},ke=(e,t={})=>(r,n,a)=>{const{enabled:i,anonymousActionType:o,store:s,...l}=t;let c;try{c=(null!=i?i:"production"!==(Se?"production":void 0))&&window.__REDUX_DEVTOOLS_EXTENSION__}catch(v){}if(!c)return e(r,n,a);const{connection:u,...f}=((e,t,r)=>{if(void 0===e)return{type:"untracked",connection:t.connect(r)};const n=_e.get(r.name);if(n)return{type:"tracked",store:e,...n};const a={connection:t.connect(r),stores:{}};return _e.set(r.name,a),{type:"tracked",store:e,...a}})(s,c,l);let d=!0;a.setState=(e,t,i)=>{const c=r(e,t);if(!d)return c;const f=void 0===i?{type:o||Te((new Error).stack)||"anonymous"}:"string"==typeof i?{type:i}:i;return void 0===s?(null==u||u.send(f,n()),c):(null==u||u.send({...f,type:`${s}/${f.type}`},{...Ue(l.name),[s]:a.getState()}),c)},a.devtools={cleanup:()=>{u&&"function"==typeof u.unsubscribe&&u.unsubscribe(),((e,t)=>{if(void 0===t)return;const r=_e.get(e);r&&(delete r.stores[t],0===Object.keys(r.stores).length&&_e.delete(e))})(l.name,s)}};const h=(...e)=>{const t=d;d=!1,r(...e),d=t},p=e(a.setState,n,a);if("untracked"===f.type?null==u||u.init(p):(f.stores[f.store]=a,null==u||u.init(Object.fromEntries(Object.entries(f.stores).map(([e,t])=>[e,e===f.store?p:t.getState()])))),a.dispatchFromDevtools&&"function"==typeof a.dispatch){let e=!1;const t=a.dispatch;a.dispatch=(...r)=>{"production"===(Se?"production":void 0)||"__setState"!==r[0].type||e||(e=!0),t(...r)}}return u.subscribe(e=>{var t;switch(e.type){case"ACTION":if("string"!=typeof e.payload)return;return Ee(e.payload,e=>{if("__setState"===e.type){if(void 0===s)return void h(e.state);Object.keys(e.state).length;const t=e.state[s];if(null==t)return;return void(JSON.stringify(a.getState())!==JSON.stringify(t)&&h(t))}a.dispatchFromDevtools&&"function"==typeof a.dispatch&&a.dispatch(e)});case"DISPATCH":switch(e.payload.type){case"RESET":return h(p),void 0===s?null==u?void 0:u.init(a.getState()):null==u?void 0:u.init(Ue(l.name));case"COMMIT":return void 0===s?void(null==u||u.init(a.getState())):null==u?void 0:u.init(Ue(l.name));case"ROLLBACK":return Ee(e.state,e=>{if(void 0===s)return h(e),void(null==u||u.init(a.getState()));h(e[s]),null==u||u.init(Ue(l.name))});case"JUMP_TO_STATE":case"JUMP_TO_ACTION":return Ee(e.state,e=>{void 0!==s?JSON.stringify(a.getState())!==JSON.stringify(e[s])&&h(e[s]):h(e)});case"IMPORT_STATE":{const{nextLiftedState:r}=e.payload,n=null==(t=r.computedStates.slice(-1)[0])?void 0:t.state;if(!n)return;return h(void 0===s?n:n[s]),void(null==u||u.send(null,r))}case"PAUSE_RECORDING":return d=!d}return}}),p},Ee=(e,t)=>{let r;try{r=JSON.parse(e)}catch(n){}void 0!==r&&t(r)};function Me(e,t){let r;try{r=e()}catch(n){return}return{getItem:e=>{var t;const n=e=>null===e?null:JSON.parse(e,void 0),a=null!=(t=r.getItem(e))?t:null;return a instanceof Promise?a.then(n):n(a)},setItem:(e,t)=>r.setItem(e,JSON.stringify(t,void 0)),removeItem:e=>r.removeItem(e)}}const Ce=e=>t=>{try{const r=e(t);return r instanceof Promise?r:{then:e=>Ce(e)(r),catch(e){return this}}}catch(r){return{then(e){return this},catch:e=>Ce(e)(r)}}},Ae=(e,t)=>(r,n,a)=>{let i={storage:Me(()=>localStorage),partialize:e=>e,version:0,merge:(e,t)=>({...t,...e}),...t},o=!1;const s=new Set,l=new Set;let c=i.storage;if(!c)return e((...e)=>{r(...e)},n,a);const u=()=>{const e=i.partialize({...n()});return c.setItem(i.name,{state:e,version:i.version})},f=a.setState;a.setState=(e,t)=>(f(e,t),u());const d=e((...e)=>(r(...e),u()),n,a);let h;a.getInitialState=()=>d;const p=()=>{var e,t;if(!c)return;o=!1,s.forEach(e=>{var t;return e(null!=(t=n())?t:d)});const a=(null==(t=i.onRehydrateStorage)?void 0:t.call(i,null!=(e=n())?e:d))||void 0;return Ce(c.getItem.bind(c))(i.name).then(e=>{if(e){if("number"!=typeof e.version||e.version===i.version)return[!1,e.state];if(i.migrate){const t=i.migrate(e.state,e.version);return t instanceof Promise?t.then(e=>[!0,e]):[!0,t]}}return[!1,void 0]}).then(e=>{var t;const[a,o]=e;if(h=i.merge(o,null!=(t=n())?t:d),r(h,!0),a)return u()}).then(()=>{null==a||a(h,void 0),h=n(),o=!0,l.forEach(e=>e(h))}).catch(e=>{null==a||a(void 0,e)})};return a.persist={setOptions:e=>{i={...i,...e},e.storage&&(c=e.storage)},clearStorage:()=>{null==c||c.removeItem(i.name)},getOptions:()=>i,rehydrate:()=>p(),hasHydrated:()=>o,onHydrate:e=>(s.add(e),()=>{s.delete(e)}),onFinishHydration:e=>(l.add(e),()=>{l.delete(e)})},i.skipHydration||p(),h||d},Fe={},Pe=function(e,t,r){let n=Promise.resolve();if(t&&t.length>0){let e=function(e){return Promise.all(e.map(e=>Promise.resolve(e).then(e=>({status:"fulfilled",value:e}),e=>({status:"rejected",reason:e}))))};document.getElementsByTagName("link");const r=document.querySelector("meta[property=csp-nonce]"),a=r?.nonce||r?.getAttribute("nonce");n=e(t.map(e=>{if((e=function(e){return"/learn_comptia_network_plus/"+e}(e))in Fe)return;Fe[e]=!0;const t=e.endsWith(".css"),r=t?'[rel="stylesheet"]':"";if(document.querySelector(`link[href="${e}"]${r}`))return;const n=document.createElement("link");return n.rel=t?"stylesheet":"modulepreload",t||(n.as="script"),n.crossOrigin="",n.href=e,a&&n.setAttribute("nonce",a),document.head.appendChild(n),t?new Promise((t,r)=>{n.addEventListener("load",t),n.addEventListener("error",()=>r(new Error(`Unable to preload CSS for ${e}`)))}):void 0}))}function a(e){const t=new Event("vite:preloadError",{cancelable:!0});if(t.payload=e,window.dispatchEvent(t),!t.defaultPrevented)throw e}return n.then(t=>{for(const e of t||[])"rejected"===e.status&&a(e.reason);return e().catch(a)})};function Oe(){return Oe=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var n in r)({}).hasOwnProperty.call(r,n)&&(e[n]=r[n])}return e},Oe.apply(null,arguments)}const Ie=(()=>parseInt(n.replace(/\D+/g,"")))();var Re=Uint8Array,De=Uint16Array,Le=Uint32Array,Be=new Re([0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0,0,0,0]),Ge=new Re([0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13,0,0]),je=new Re([16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15]),ze=function(e,t){for(var r=new De(31),n=0;n<31;++n)r[n]=t+=1<<e[n-1];var a=new Le(r[30]);for(n=1;n<30;++n)for(var i=r[n];i<r[n+1];++i)a[i]=i-r[n]<<5|n;return[r,a]},Ne=ze(Be,2),We=Ne[0],He=Ne[1];We[28]=258,He[258]=28;for(var Ve=ze(Ge,0)[0],Xe=new De(32768),Ye=0;Ye<32768;++Ye){var qe=(43690&Ye)>>>1|(21845&Ye)<<1;qe=(61680&(qe=(52428&qe)>>>2|(13107&qe)<<2))>>>4|(3855&qe)<<4,Xe[Ye]=((65280&qe)>>>8|(255&qe)<<8)>>>1}var $e=function(e,t,r){for(var n=e.length,a=0,i=new De(t);a<n;++a)++i[e[a]-1];var o,s=new De(t);for(a=0;a<t;++a)s[a]=s[a-1]+i[a-1]<<1;if(r){o=new De(1<<t);var l=15-t;for(a=0;a<n;++a)if(e[a])for(var c=a<<4|e[a],u=t-e[a],f=s[e[a]-1]++<<u,d=f|(1<<u)-1;f<=d;++f)o[Xe[f]>>>l]=c}else for(o=new De(n),a=0;a<n;++a)e[a]&&(o[a]=Xe[s[e[a]-1]++]>>>15-e[a]);return o},Ze=new Re(288);for(Ye=0;Ye<144;++Ye)Ze[Ye]=8;for(Ye=144;Ye<256;++Ye)Ze[Ye]=9;for(Ye=256;Ye<280;++Ye)Ze[Ye]=7;for(Ye=280;Ye<288;++Ye)Ze[Ye]=8;var Ke=new Re(32);for(Ye=0;Ye<32;++Ye)Ke[Ye]=5;var Qe=$e(Ze,9,1),Je=$e(Ke,5,1),et=function(e){for(var t=e[0],r=1;r<e.length;++r)e[r]>t&&(t=e[r]);return t},tt=function(e,t,r){var n=t/8|0;return(e[n]|e[n+1]<<8)>>(7&t)&r},rt=function(e,t){var r=t/8|0;return(e[r]|e[r+1]<<8|e[r+2]<<16)>>(7&t)},nt=function(e){return(e/8|0)+(7&e&&1)},at=function(e,t,r){var n=e.length;if(!n||r&&!r.l&&n<5)return t||new Re(0);var a=!t||r,i=!r||r.i;r||(r={}),t||(t=new Re(3*n));var o=function(e){var r=t.length;if(e>r){var n=new Re(Math.max(2*r,e));n.set(t),t=n}},s=r.f||0,l=r.p||0,c=r.b||0,u=r.l,f=r.d,d=r.m,h=r.n,p=8*n;do{if(!u){r.f=s=tt(e,l,1);var v=tt(e,l+1,3);if(l+=3,!v){var g=e[(E=nt(l)+4)-4]|e[E-3]<<8,m=E+g;if(m>n){if(i)throw"unexpected EOF";break}a&&o(c+g),t.set(e.subarray(E,m),c),r.b=c+=g,r.p=l=8*m;continue}if(1==v)u=Qe,f=Je,d=9,h=5;else{if(2!=v)throw"invalid block type";var y=tt(e,l,31)+257,b=tt(e,l+10,15)+4,w=y+tt(e,l+5,31)+1;l+=14;for(var x=new Re(w),S=new Re(19),_=0;_<b;++_)S[je[_]]=tt(e,l+3*_,7);l+=3*b;var U=et(S),T=(1<<U)-1,k=$e(S,U,1);for(_=0;_<w;){var E,M=k[tt(e,l,T)];if(l+=15&M,(E=M>>>4)<16)x[_++]=E;else{var C=0,A=0;for(16==E?(A=3+tt(e,l,3),l+=2,C=x[_-1]):17==E?(A=3+tt(e,l,7),l+=3):18==E&&(A=11+tt(e,l,127),l+=7);A--;)x[_++]=C}}var F=x.subarray(0,y),P=x.subarray(y);d=et(F),h=et(P),u=$e(F,d,1),f=$e(P,h,1)}if(l>p){if(i)throw"unexpected EOF";break}}a&&o(c+131072);for(var O=(1<<d)-1,I=(1<<h)-1,R=l;;R=l){var D=(C=u[rt(e,l)&O])>>>4;if((l+=15&C)>p){if(i)throw"unexpected EOF";break}if(!C)throw"invalid length/literal";if(D<256)t[c++]=D;else{if(256==D){R=l,u=null;break}var L=D-254;if(D>264){var B=Be[_=D-257];L=tt(e,l,(1<<B)-1)+We[_],l+=B}var G=f[rt(e,l)&I],j=G>>>4;if(!G)throw"invalid distance";l+=15&G;P=Ve[j];if(j>3){B=Ge[j];P+=rt(e,l)&(1<<B)-1,l+=B}if(l>p){if(i)throw"unexpected EOF";break}a&&o(c+131072);for(var z=c+L;c<z;c+=4)t[c]=t[c-P],t[c+1]=t[c+1-P],t[c+2]=t[c+2-P],t[c+3]=t[c+3-P];c=z}}r.l=u,r.p=R,r.b=c,u&&(s=1,r.m=d,r.d=f,r.n=h)}while(!s);return c==t.length?t:function(e,t,r){(null==r||r>e.length)&&(r=e.length);var n=new(e instanceof De?De:e instanceof Le?Le:Re)(r-t);return n.set(e.subarray(t,r)),n}(t,0,c)},it=new Re(0);function ot(e,t){return at((function(e){if(8!=(15&e[0])||e[0]>>>4>7||(e[0]<<8|e[1])%31)throw"invalid zlib data";if(32&e[1])throw"invalid zlib data: preset dictionaries not supported"}(e),e.subarray(2,-4)),t)}var st="undefined"!=typeof TextDecoder&&new TextDecoder;try{st.decode(it,{stream:!0})}catch(Sn){}class lt extends a{constructor(e,t){var r,n;const a=(l=e)&&l.isCubeTexture;var l;const c=(null!=(n=a?null==(r=e.image[0])?void 0:r.width:e.image.width)?n:1024)/4,u=Math.floor(Math.log2(c)),f=Math.pow(2,u),d=[a?"#define ENVMAP_TYPE_CUBE":"","#define CUBEUV_TEXEL_WIDTH "+1/(3*Math.max(f,112)),"#define CUBEUV_TEXEL_HEIGHT "+1/(4*f),`#define CUBEUV_MAX_MIP ${u}.0`].join("\n")+`\n        #define ENVMAP_TYPE_CUBE_UV\n        varying vec3 vWorldPosition;\n        uniform float radius;\n        uniform float height;\n        uniform float angle;\n        #ifdef ENVMAP_TYPE_CUBE\n            uniform samplerCube map;\n        #else\n            uniform sampler2D map;\n        #endif\n        // From: https://www.shadertoy.com/view/4tsBD7\n        float diskIntersectWithBackFaceCulling( vec3 ro, vec3 rd, vec3 c, vec3 n, float r ) \n        {\n            float d = dot ( rd, n );\n            \n            if( d > 0.0 ) { return 1e6; }\n            \n            vec3  o = ro - c;\n            float t = - dot( n, o ) / d;\n            vec3  q = o + rd * t;\n            \n            return ( dot( q, q ) < r * r ) ? t : 1e6;\n        }\n        // From: https://www.iquilezles.org/www/articles/intersectors/intersectors.htm\n        float sphereIntersect( vec3 ro, vec3 rd, vec3 ce, float ra ) \n        {\n            vec3 oc = ro - ce;\n            float b = dot( oc, rd );\n            float c = dot( oc, oc ) - ra * ra;\n            float h = b * b - c;\n            \n            if( h < 0.0 ) { return -1.0; }\n            \n            h = sqrt( h );\n            \n            return - b + h;\n        }\n        vec3 project() \n        {\n            vec3 p = normalize( vWorldPosition );\n            vec3 camPos = cameraPosition;\n            camPos.y -= height;\n            float intersection = sphereIntersect( camPos, p, vec3( 0.0 ), radius );\n            if( intersection > 0.0 ) {\n                \n                vec3 h = vec3( 0.0, - height, 0.0 );\n                float intersection2 = diskIntersectWithBackFaceCulling( camPos, p, h, vec3( 0.0, 1.0, 0.0 ), radius );\n                p = ( camPos + min( intersection, intersection2 ) * p ) / radius;\n            } else {\n                p = vec3( 0.0, 1.0, 0.0 );\n            }\n            return p;\n        }\n        #include <common>\n        #include <cube_uv_reflection_fragment>\n        void main() \n        {\n            vec3 projectedWorldPosition = project();\n            \n            #ifdef ENVMAP_TYPE_CUBE\n                vec3 outcolor = textureCube( map, projectedWorldPosition ).rgb;\n            #else\n                vec3 direction = normalize( projectedWorldPosition );\n                vec2 uv = equirectUv( direction );\n                vec3 outcolor = texture2D( map, uv ).rgb;\n            #endif\n            gl_FragColor = vec4( outcolor, 1.0 );\n            #include <tonemapping_fragment>\n            #include <${Ie>=154?"colorspace_fragment":"encodings_fragment"}>\n        }\n        `,h={map:{value:e},height:{value:(null==t?void 0:t.height)||15},radius:{value:(null==t?void 0:t.radius)||100}};super(new i(1,16),new o({uniforms:h,fragmentShader:d,vertexShader:"\n        varying vec3 vWorldPosition;\n        void main() \n        {\n            vec4 worldPosition = ( modelMatrix * vec4( position, 1.0 ) );\n            vWorldPosition = worldPosition.xyz;\n            \n            gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );\n        }\n        ",side:s}))}set radius(e){this.material.uniforms.radius.value=e}get radius(){return this.material.uniforms.radius.value}set height(e){this.material.uniforms.height.value=e}get height(){return this.material.uniforms.height.value}}var ct=Object.defineProperty,ut=(e,t,r)=>(((e,t,r)=>{t in e?ct(e,t,{enumerable:!0,configurable:!0,writable:!0,value:r}):e[t]=r})(e,t+"",r),r);class ft{constructor(){ut(this,"_listeners")}addEventListener(e,t){void 0===this._listeners&&(this._listeners={});const r=this._listeners;void 0===r[e]&&(r[e]=[]),-1===r[e].indexOf(t)&&r[e].push(t)}hasEventListener(e,t){if(void 0===this._listeners)return!1;const r=this._listeners;return void 0!==r[e]&&-1!==r[e].indexOf(t)}removeEventListener(e,t){if(void 0===this._listeners)return;const r=this._listeners[e];if(void 0!==r){const e=r.indexOf(t);-1!==e&&r.splice(e,1)}}dispatchEvent(e){if(void 0===this._listeners)return;const t=this._listeners[e.type];if(void 0!==t){e.target=this;const r=t.slice(0);for(let t=0,n=r.length;t<n;t++)r[t].call(this,e);e.target=null}}}var dt=Object.defineProperty,ht=(e,t,r)=>(((e,t,r)=>{t in e?dt(e,t,{enumerable:!0,configurable:!0,writable:!0,value:r}):e[t]=r})(e,"symbol"!=typeof t?t+"":t,r),r);const pt=new g,vt=new m,gt=Math.cos(Math.PI/180*70),mt=(e,t)=>(e%t+t)%t;let yt=class extends ft{constructor(e,t){super(),ht(this,"object"),ht(this,"domElement"),ht(this,"enabled",!0),ht(this,"target",new u),ht(this,"minDistance",0),ht(this,"maxDistance",1/0),ht(this,"minZoom",0),ht(this,"maxZoom",1/0),ht(this,"minPolarAngle",0),ht(this,"maxPolarAngle",Math.PI),ht(this,"minAzimuthAngle",-1/0),ht(this,"maxAzimuthAngle",1/0),ht(this,"enableDamping",!1),ht(this,"dampingFactor",.05),ht(this,"enableZoom",!0),ht(this,"zoomSpeed",1),ht(this,"enableRotate",!0),ht(this,"rotateSpeed",1),ht(this,"enablePan",!0),ht(this,"panSpeed",1),ht(this,"screenSpacePanning",!0),ht(this,"keyPanSpeed",7),ht(this,"zoomToCursor",!1),ht(this,"autoRotate",!1),ht(this,"autoRotateSpeed",2),ht(this,"reverseOrbit",!1),ht(this,"reverseHorizontalOrbit",!1),ht(this,"reverseVerticalOrbit",!1),ht(this,"keys",{LEFT:"ArrowLeft",UP:"ArrowUp",RIGHT:"ArrowRight",BOTTOM:"ArrowDown"}),ht(this,"mouseButtons",{LEFT:h.ROTATE,MIDDLE:h.DOLLY,RIGHT:h.PAN}),ht(this,"touches",{ONE:p.ROTATE,TWO:p.DOLLY_PAN}),ht(this,"target0"),ht(this,"position0"),ht(this,"zoom0"),ht(this,"_domElementKeyEvents",null),ht(this,"getPolarAngle"),ht(this,"getAzimuthalAngle"),ht(this,"setPolarAngle"),ht(this,"setAzimuthalAngle"),ht(this,"getDistance"),ht(this,"getZoomScale"),ht(this,"listenToKeyEvents"),ht(this,"stopListenToKeyEvents"),ht(this,"saveState"),ht(this,"reset"),ht(this,"update"),ht(this,"connect"),ht(this,"dispose"),ht(this,"dollyIn"),ht(this,"dollyOut"),ht(this,"getScale"),ht(this,"setScale"),this.object=e,this.domElement=t,this.target0=this.target.clone(),this.position0=this.object.position.clone(),this.zoom0=this.object.zoom,this.getPolarAngle=()=>m.phi,this.getAzimuthalAngle=()=>m.theta,this.setPolarAngle=e=>{let t=mt(e,2*Math.PI),n=m.phi;n<0&&(n+=2*Math.PI),t<0&&(t+=2*Math.PI);let a=Math.abs(t-n);2*Math.PI-a<a&&(t<n?t+=2*Math.PI:n+=2*Math.PI),y.phi=t-n,r.update()},this.setAzimuthalAngle=e=>{let t=mt(e,2*Math.PI),n=m.theta;n<0&&(n+=2*Math.PI),t<0&&(t+=2*Math.PI);let a=Math.abs(t-n);2*Math.PI-a<a&&(t<n?t+=2*Math.PI:n+=2*Math.PI),y.theta=t-n,r.update()},this.getDistance=()=>r.object.position.distanceTo(r.target),this.listenToKeyEvents=e=>{e.addEventListener("keydown",ae),this._domElementKeyEvents=e},this.stopListenToKeyEvents=()=>{this._domElementKeyEvents.removeEventListener("keydown",ae),this._domElementKeyEvents=null},this.saveState=()=>{r.target0.copy(r.target),r.position0.copy(r.object.position),r.zoom0=r.object.zoom},this.reset=()=>{r.target.copy(r.target0),r.object.position.copy(r.position0),r.object.zoom=r.zoom0,r.object.updateProjectionMatrix(),r.dispatchEvent(n),r.update(),s=o.NONE},this.update=(()=>{const t=new u,a=new u(0,1,0),i=(new c).setFromUnitVectors(e.up,a),l=i.clone().invert(),h=new u,p=new c,v=2*Math.PI;return function(){const c=r.object.position;i.setFromUnitVectors(e.up,a),l.copy(i).invert(),t.copy(c).sub(r.target),t.applyQuaternion(i),m.setFromVector3(t),r.autoRotate&&s===o.NONE&&D(2*Math.PI/60/60*r.autoRotateSpeed),r.enableDamping?(m.theta+=y.theta*r.dampingFactor,m.phi+=y.phi*r.dampingFactor):(m.theta+=y.theta,m.phi+=y.phi);let x=r.minAzimuthAngle,S=r.maxAzimuthAngle;isFinite(x)&&isFinite(S)&&(x<-Math.PI?x+=v:x>Math.PI&&(x-=v),S<-Math.PI?S+=v:S>Math.PI&&(S-=v),m.theta=x<=S?Math.max(x,Math.min(S,m.theta)):m.theta>(x+S)/2?Math.max(x,m.theta):Math.min(S,m.theta)),m.phi=Math.max(r.minPolarAngle,Math.min(r.maxPolarAngle,m.phi)),m.makeSafe(),!0===r.enableDamping?r.target.addScaledVector(w,r.dampingFactor):r.target.add(w),r.zoomToCursor&&P||r.object.isOrthographicCamera?m.radius=V(m.radius):m.radius=V(m.radius*b),t.setFromSpherical(m),t.applyQuaternion(l),c.copy(r.target).add(t),r.object.matrixAutoUpdate||r.object.updateMatrix(),r.object.lookAt(r.target),!0===r.enableDamping?(y.theta*=1-r.dampingFactor,y.phi*=1-r.dampingFactor,w.multiplyScalar(1-r.dampingFactor)):(y.set(0,0,0),w.set(0,0,0));let _=!1;if(r.zoomToCursor&&P){let n=null;if(r.object instanceof d&&r.object.isPerspectiveCamera){const e=t.length();n=V(e*b);const a=e-n;r.object.position.addScaledVector(A,a),r.object.updateMatrixWorld()}else if(r.object.isOrthographicCamera){const e=new u(F.x,F.y,0);e.unproject(r.object),r.object.zoom=Math.max(r.minZoom,Math.min(r.maxZoom,r.object.zoom/b)),r.object.updateProjectionMatrix(),_=!0;const a=new u(F.x,F.y,0);a.unproject(r.object),r.object.position.sub(a).add(e),r.object.updateMatrixWorld(),n=t.length()}else r.zoomToCursor=!1;null!==n&&(r.screenSpacePanning?r.target.set(0,0,-1).transformDirection(r.object.matrix).multiplyScalar(n).add(r.object.position):(pt.origin.copy(r.object.position),pt.direction.set(0,0,-1).transformDirection(r.object.matrix),Math.abs(r.object.up.dot(pt.direction))<gt?e.lookAt(r.target):(vt.setFromNormalAndCoplanarPoint(r.object.up,r.target),pt.intersectPlane(vt,r.target))))}else r.object instanceof f&&r.object.isOrthographicCamera&&(_=1!==b,_&&(r.object.zoom=Math.max(r.minZoom,Math.min(r.maxZoom,r.object.zoom/b)),r.object.updateProjectionMatrix()));return b=1,P=!1,!!(_||h.distanceToSquared(r.object.position)>g||8*(1-p.dot(r.object.quaternion))>g)&&(r.dispatchEvent(n),h.copy(r.object.position),p.copy(r.object.quaternion),_=!1,!0)}})(),this.connect=e=>{r.domElement=e,r.domElement.style.touchAction="none",r.domElement.addEventListener("contextmenu",ie),r.domElement.addEventListener("pointerdown",ee),r.domElement.addEventListener("pointercancel",re),r.domElement.addEventListener("wheel",ne)},this.dispose=()=>{var e,t,n,a,i,o;r.domElement&&(r.domElement.style.touchAction="auto"),null==(e=r.domElement)||e.removeEventListener("contextmenu",ie),null==(t=r.domElement)||t.removeEventListener("pointerdown",ee),null==(n=r.domElement)||n.removeEventListener("pointercancel",re),null==(a=r.domElement)||a.removeEventListener("wheel",ne),null==(i=r.domElement)||i.ownerDocument.removeEventListener("pointermove",te),null==(o=r.domElement)||o.ownerDocument.removeEventListener("pointerup",re),null!==r._domElementKeyEvents&&r._domElementKeyEvents.removeEventListener("keydown",ae)};const r=this,n={type:"change"},a={type:"start"},i={type:"end"},o={NONE:-1,ROTATE:0,DOLLY:1,PAN:2,TOUCH_ROTATE:3,TOUCH_PAN:4,TOUCH_DOLLY_PAN:5,TOUCH_DOLLY_ROTATE:6};let s=o.NONE;const g=1e-6,m=new l,y=new l;let b=1;const w=new u,x=new v,S=new v,_=new v,U=new v,T=new v,k=new v,E=new v,M=new v,C=new v,A=new u,F=new v;let P=!1;const O=[],I={};function R(){return Math.pow(.95,r.zoomSpeed)}function D(e){r.reverseOrbit||r.reverseHorizontalOrbit?y.theta+=e:y.theta-=e}function L(e){r.reverseOrbit||r.reverseVerticalOrbit?y.phi+=e:y.phi-=e}const B=(()=>{const e=new u;return function(t,r){e.setFromMatrixColumn(r,0),e.multiplyScalar(-t),w.add(e)}})(),G=(()=>{const e=new u;return function(t,n){!0===r.screenSpacePanning?e.setFromMatrixColumn(n,1):(e.setFromMatrixColumn(n,0),e.crossVectors(r.object.up,e)),e.multiplyScalar(t),w.add(e)}})(),j=(()=>{const e=new u;return function(t,n){const a=r.domElement;if(a&&r.object instanceof d&&r.object.isPerspectiveCamera){const i=r.object.position;e.copy(i).sub(r.target);let o=e.length();o*=Math.tan(r.object.fov/2*Math.PI/180),B(2*t*o/a.clientHeight,r.object.matrix),G(2*n*o/a.clientHeight,r.object.matrix)}else a&&r.object instanceof f&&r.object.isOrthographicCamera?(B(t*(r.object.right-r.object.left)/r.object.zoom/a.clientWidth,r.object.matrix),G(n*(r.object.top-r.object.bottom)/r.object.zoom/a.clientHeight,r.object.matrix)):r.enablePan=!1}})();function z(e){r.object instanceof d&&r.object.isPerspectiveCamera||r.object instanceof f&&r.object.isOrthographicCamera?b=e:r.enableZoom=!1}function N(e){z(b/e)}function W(e){z(b*e)}function H(e){if(!r.zoomToCursor||!r.domElement)return;P=!0;const t=r.domElement.getBoundingClientRect(),n=e.clientX-t.left,a=e.clientY-t.top,i=t.width,o=t.height;F.x=n/i*2-1,F.y=-a/o*2+1,A.set(F.x,F.y,1).unproject(r.object).sub(r.object.position).normalize()}function V(e){return Math.max(r.minDistance,Math.min(r.maxDistance,e))}function X(e){x.set(e.clientX,e.clientY)}function Y(e){U.set(e.clientX,e.clientY)}function q(){if(1==O.length)x.set(O[0].pageX,O[0].pageY);else{const e=.5*(O[0].pageX+O[1].pageX),t=.5*(O[0].pageY+O[1].pageY);x.set(e,t)}}function $(){if(1==O.length)U.set(O[0].pageX,O[0].pageY);else{const e=.5*(O[0].pageX+O[1].pageX),t=.5*(O[0].pageY+O[1].pageY);U.set(e,t)}}function Z(){const e=O[0].pageX-O[1].pageX,t=O[0].pageY-O[1].pageY,r=Math.sqrt(e*e+t*t);E.set(0,r)}function K(e){if(1==O.length)S.set(e.pageX,e.pageY);else{const t=se(e),r=.5*(e.pageX+t.x),n=.5*(e.pageY+t.y);S.set(r,n)}_.subVectors(S,x).multiplyScalar(r.rotateSpeed);const t=r.domElement;t&&(D(2*Math.PI*_.x/t.clientHeight),L(2*Math.PI*_.y/t.clientHeight)),x.copy(S)}function Q(e){if(1==O.length)T.set(e.pageX,e.pageY);else{const t=se(e),r=.5*(e.pageX+t.x),n=.5*(e.pageY+t.y);T.set(r,n)}k.subVectors(T,U).multiplyScalar(r.panSpeed),j(k.x,k.y),U.copy(T)}function J(e){const t=se(e),n=e.pageX-t.x,a=e.pageY-t.y,i=Math.sqrt(n*n+a*a);M.set(0,i),C.set(0,Math.pow(M.y/E.y,r.zoomSpeed)),N(C.y),E.copy(M)}function ee(e){var t,n;!1!==r.enabled&&(0===O.length&&(null==(t=r.domElement)||t.ownerDocument.addEventListener("pointermove",te),null==(n=r.domElement)||n.ownerDocument.addEventListener("pointerup",re)),function(e){O.push(e)}(e),"touch"===e.pointerType?function(e){switch(oe(e),O.length){case 1:switch(r.touches.ONE){case p.ROTATE:if(!1===r.enableRotate)return;q(),s=o.TOUCH_ROTATE;break;case p.PAN:if(!1===r.enablePan)return;$(),s=o.TOUCH_PAN;break;default:s=o.NONE}break;case 2:switch(r.touches.TWO){case p.DOLLY_PAN:if(!1===r.enableZoom&&!1===r.enablePan)return;r.enableZoom&&Z(),r.enablePan&&$(),s=o.TOUCH_DOLLY_PAN;break;case p.DOLLY_ROTATE:if(!1===r.enableZoom&&!1===r.enableRotate)return;r.enableZoom&&Z(),r.enableRotate&&q(),s=o.TOUCH_DOLLY_ROTATE;break;default:s=o.NONE}break;default:s=o.NONE}s!==o.NONE&&r.dispatchEvent(a)}(e):function(e){let t;switch(e.button){case 0:t=r.mouseButtons.LEFT;break;case 1:t=r.mouseButtons.MIDDLE;break;case 2:t=r.mouseButtons.RIGHT;break;default:t=-1}switch(t){case h.DOLLY:if(!1===r.enableZoom)return;!function(e){H(e),E.set(e.clientX,e.clientY)}(e),s=o.DOLLY;break;case h.ROTATE:if(e.ctrlKey||e.metaKey||e.shiftKey){if(!1===r.enablePan)return;Y(e),s=o.PAN}else{if(!1===r.enableRotate)return;X(e),s=o.ROTATE}break;case h.PAN:if(e.ctrlKey||e.metaKey||e.shiftKey){if(!1===r.enableRotate)return;X(e),s=o.ROTATE}else{if(!1===r.enablePan)return;Y(e),s=o.PAN}break;default:s=o.NONE}s!==o.NONE&&r.dispatchEvent(a)}(e))}function te(e){!1!==r.enabled&&("touch"===e.pointerType?function(e){switch(oe(e),s){case o.TOUCH_ROTATE:if(!1===r.enableRotate)return;K(e),r.update();break;case o.TOUCH_PAN:if(!1===r.enablePan)return;Q(e),r.update();break;case o.TOUCH_DOLLY_PAN:if(!1===r.enableZoom&&!1===r.enablePan)return;!function(e){r.enableZoom&&J(e),r.enablePan&&Q(e)}(e),r.update();break;case o.TOUCH_DOLLY_ROTATE:if(!1===r.enableZoom&&!1===r.enableRotate)return;!function(e){r.enableZoom&&J(e),r.enableRotate&&K(e)}(e),r.update();break;default:s=o.NONE}}(e):function(e){if(!1===r.enabled)return;switch(s){case o.ROTATE:if(!1===r.enableRotate)return;!function(e){S.set(e.clientX,e.clientY),_.subVectors(S,x).multiplyScalar(r.rotateSpeed);const t=r.domElement;t&&(D(2*Math.PI*_.x/t.clientHeight),L(2*Math.PI*_.y/t.clientHeight)),x.copy(S),r.update()}(e);break;case o.DOLLY:if(!1===r.enableZoom)return;!function(e){M.set(e.clientX,e.clientY),C.subVectors(M,E),C.y>0?N(R()):C.y<0&&W(R()),E.copy(M),r.update()}(e);break;case o.PAN:if(!1===r.enablePan)return;!function(e){T.set(e.clientX,e.clientY),k.subVectors(T,U).multiplyScalar(r.panSpeed),j(k.x,k.y),U.copy(T),r.update()}(e)}}(e))}function re(e){var t,n,a;!function(e){delete I[e.pointerId];for(let t=0;t<O.length;t++)if(O[t].pointerId==e.pointerId)return void O.splice(t,1)}(e),0===O.length&&(null==(t=r.domElement)||t.releasePointerCapture(e.pointerId),null==(n=r.domElement)||n.ownerDocument.removeEventListener("pointermove",te),null==(a=r.domElement)||a.ownerDocument.removeEventListener("pointerup",re)),r.dispatchEvent(i),s=o.NONE}function ne(e){!1===r.enabled||!1===r.enableZoom||s!==o.NONE&&s!==o.ROTATE||(e.preventDefault(),r.dispatchEvent(a),function(e){H(e),e.deltaY<0?W(R()):e.deltaY>0&&N(R()),r.update()}(e),r.dispatchEvent(i))}function ae(e){!1!==r.enabled&&!1!==r.enablePan&&function(e){let t=!1;switch(e.code){case r.keys.UP:j(0,r.keyPanSpeed),t=!0;break;case r.keys.BOTTOM:j(0,-r.keyPanSpeed),t=!0;break;case r.keys.LEFT:j(r.keyPanSpeed,0),t=!0;break;case r.keys.RIGHT:j(-r.keyPanSpeed,0),t=!0}t&&(e.preventDefault(),r.update())}(e)}function ie(e){!1!==r.enabled&&e.preventDefault()}function oe(e){let t=I[e.pointerId];void 0===t&&(t=new v,I[e.pointerId]=t),t.set(e.pageX,e.pageY)}function se(e){const t=e.pointerId===O[0].pointerId?O[1]:O[0];return I[t.pointerId]}this.dollyIn=(e=R())=>{W(e),r.update()},this.dollyOut=(e=R())=>{N(e),r.update()},this.getScale=()=>b,this.setScale=e=>{z(e),r.update()},this.getZoomScale=()=>R(),void 0!==t&&this.connect(t),this.update()}};class bt extends y{constructor(e){super(e),this.type=b}parse(e){const t=function(e,t){switch(e){case 1:throw new Error("THREE.RGBELoader: Read Error: "+(t||""));case 2:throw new Error("THREE.RGBELoader: Write Error: "+(t||""));case 3:throw new Error("THREE.RGBELoader: Bad File Format: "+(t||""));default:throw new Error("THREE.RGBELoader: Memory Error: "+(t||""))}},r=function(e,t,r){t=t||1024;let n=e.pos,a=-1,i=0,o="",s=String.fromCharCode.apply(null,new Uint16Array(e.subarray(n,n+128)));for(;0>(a=s.indexOf("\n"))&&i<t&&n<e.byteLength;)o+=s,i+=s.length,n+=128,s+=String.fromCharCode.apply(null,new Uint16Array(e.subarray(n,n+128)));return-1<a&&(e.pos+=i+a+1,o+s.slice(0,a))},n=function(e,t,r,n){const a=e[t+3],i=Math.pow(2,a-128)/255;r[n+0]=e[t+0]*i,r[n+1]=e[t+1]*i,r[n+2]=e[t+2]*i,r[n+3]=1},a=function(e,t,r,n){const a=e[t+3],i=Math.pow(2,a-128)/255;r[n+0]=x.toHalfFloat(Math.min(e[t+0]*i,65504)),r[n+1]=x.toHalfFloat(Math.min(e[t+1]*i,65504)),r[n+2]=x.toHalfFloat(Math.min(e[t+2]*i,65504)),r[n+3]=x.toHalfFloat(1)},i=new Uint8Array(e);i.pos=0;const o=function(e){const n=/^\s*GAMMA\s*=\s*(\d+(\.\d+)?)\s*$/,a=/^\s*EXPOSURE\s*=\s*(\d+(\.\d+)?)\s*$/,i=/^\s*FORMAT=(\S+)\s*$/,o=/^\s*\-Y\s+(\d+)\s+\+X\s+(\d+)\s*$/,s={valid:0,string:"",comments:"",programtype:"RGBE",format:"",gamma:1,exposure:1,width:0,height:0};let l,c;for((e.pos>=e.byteLength||!(l=r(e)))&&t(1,"no header found"),(c=l.match(/^#\?(\S+)/))||t(3,"bad initial token"),s.valid|=1,s.programtype=c[1],s.string+=l+"\n";l=r(e),!1!==l;)if(s.string+=l+"\n","#"!==l.charAt(0)){if((c=l.match(n))&&(s.gamma=parseFloat(c[1])),(c=l.match(a))&&(s.exposure=parseFloat(c[1])),(c=l.match(i))&&(s.valid|=2,s.format=c[1]),(c=l.match(o))&&(s.valid|=4,s.height=parseInt(c[1],10),s.width=parseInt(c[2],10)),2&s.valid&&4&s.valid)break}else s.comments+=l+"\n";return 2&s.valid||t(3,"missing format specifier"),4&s.valid||t(3,"missing image size specifier"),s}(i),s=o.width,l=o.height,c=function(e,r,n){const a=r;if(a<8||a>32767||2!==e[0]||2!==e[1]||128&e[2])return new Uint8Array(e);a!==(e[2]<<8|e[3])&&t(3,"wrong scanline width");const i=new Uint8Array(4*r*n);i.length||t(4,"unable to allocate buffer space");let o=0,s=0;const l=4*a,c=new Uint8Array(4),u=new Uint8Array(l);let f=n;for(;f>0&&s<e.byteLength;){s+4>e.byteLength&&t(1),c[0]=e[s++],c[1]=e[s++],c[2]=e[s++],c[3]=e[s++],2==c[0]&&2==c[1]&&(c[2]<<8|c[3])==a||t(3,"bad rgbe scanline format");let r,n=0;for(;n<l&&s<e.byteLength;){r=e[s++];const a=r>128;if(a&&(r-=128),(0===r||n+r>l)&&t(3,"bad scanline data"),a){const t=e[s++];for(let e=0;e<r;e++)u[n++]=t}else u.set(e.subarray(s,s+r),n),n+=r,s+=r}const d=a;for(let e=0;e<d;e++){let t=0;i[o]=u[e+t],t+=a,i[o+1]=u[e+t],t+=a,i[o+2]=u[e+t],t+=a,i[o+3]=u[e+t],o+=4}f--}return i}(i.subarray(i.pos),s,l);let u,f,d;switch(this.type){case w:d=c.length/4;const e=new Float32Array(4*d);for(let r=0;r<d;r++)n(c,4*r,e,4*r);u=e,f=w;break;case b:d=c.length/4;const t=new Uint16Array(4*d);for(let r=0;r<d;r++)a(c,4*r,t,4*r);u=t,f=b;break;default:throw new Error("THREE.RGBELoader: Unsupported type: "+this.type)}return{width:s,height:l,data:u,header:o.string,gamma:o.gamma,exposure:o.exposure,type:f}}setDataType(e){return this.type=e,this}load(e,t,r,n){return super.load(e,function(e,r){switch(e.type){case w:case b:"colorSpace"in e?e.colorSpace="srgb-linear":e.encoding=3e3,e.minFilter=S,e.magFilter=S,e.generateMipmaps=!1,e.flipY=!0}t&&t(e,r)},r,n)}}const wt=Ie>=152;class xt extends y{constructor(e){super(e),this.type=b}parse(e){const t=65536,r=14,n=65537,a=16384,i=Math.pow(2.7182818,2.2);const o={l:0,c:0,lc:0};function s(e,t,r,n,a){for(;r<e;)t=t<<8|X(n,a),r+=8;r-=e,o.l=t>>r&(1<<e)-1,o.c=t,o.lc=r}const l=new Array(59);function c(e,t,r,a,i,c,u){for(var f=r,d=0,h=0;i<=c;i++){if(f.value-r.value>a)return!1;s(6,d,h,e,f);var p=o.l;if(d=o.c,h=o.lc,u[i]=p,63==p){if(f.value-r.value>a)throw"Something wrong with hufUnpackEncTable";s(8,d,h,e,f);var v=o.l+6;if(d=o.c,h=o.lc,i+v>c+1)throw"Something wrong with hufUnpackEncTable";for(;v--;)u[i++]=0;i--}else if(p>=59){if(i+(v=p-59+2)>c+1)throw"Something wrong with hufUnpackEncTable";for(;v--;)u[i++]=0;i--}}!function(e){for(var t=0;t<=58;++t)l[t]=0;for(t=0;t<n;++t)l[e[t]]+=1;var r=0;for(t=58;t>0;--t){var a=r+l[t]>>1;l[t]=r,r=a}for(t=0;t<n;++t){var i=e[t];i>0&&(e[t]=i|l[i]++<<6)}}(u)}function u(e){return 63&e}function f(e){return e>>6}const d={c:0,lc:0};function h(e,t,r,n){e=e<<8|X(r,n),t+=8,d.c=e,d.lc=t}const p={c:0,lc:0};function v(e,t,r,n,a,i,o,s,l,c){if(e==t){n<8&&(h(r,n,a,o),r=d.c,n=d.lc);var u=r>>(n-=8);u=new Uint8Array([u])[0];if(l.value+u>c)return!1;for(var f=s[l.value-1];u-- >0;)s[l.value++]=f}else{if(!(l.value<c))return!1;s[l.value++]=e}p.c=r,p.lc=n}function g(e){return 65535&e}function m(e){var t=g(e);return t>32767?t-65536:t}const y={a:0,b:0};function S(e,t){var r=m(e),n=m(t),a=r+(1&n)+(n>>1),i=a,o=a-n;y.a=i,y.b=o}function T(e,t){var r=g(e),n=g(t),a=r-(n>>1)&65535,i=n+a-32768&65535;y.a=i,y.b=a}function k(e,t,r,n,a,i,o){for(var s,l=o<16384,c=r>a?a:r,u=1;u<=c;)u<<=1;for(s=u>>=1,u>>=1;u>=1;){for(var f,d,h,p,v=0,g=v+i*(a-s),m=i*u,b=i*s,w=n*u,x=n*s;v<=g;v+=b){for(var _=v,U=v+n*(r-s);_<=U;_+=x){var k=_+w,E=(M=_+m)+w;l?(S(e[_+t],e[M+t]),f=y.a,h=y.b,S(e[k+t],e[E+t]),d=y.a,p=y.b,S(f,d),e[_+t]=y.a,e[k+t]=y.b,S(h,p),e[M+t]=y.a,e[E+t]=y.b):(T(e[_+t],e[M+t]),f=y.a,h=y.b,T(e[k+t],e[E+t]),d=y.a,p=y.b,T(f,d),e[_+t]=y.a,e[k+t]=y.b,T(h,p),e[M+t]=y.a,e[E+t]=y.b)}if(r&u){var M=_+m;l?S(e[_+t],e[M+t]):T(e[_+t],e[M+t]),f=y.a,e[M+t]=y.b,e[_+t]=f}}if(a&u)for(_=v,U=v+n*(r-s);_<=U;_+=x){k=_+w;l?S(e[_+t],e[k+t]):T(e[_+t],e[k+t]),f=y.a,e[k+t]=y.b,e[_+t]=f}s=u,u>>=1}return v}function E(e,t,i,o,s,l){var g=i.value,m=V(t,i),y=V(t,i);i.value+=4;var b=V(t,i);if(i.value+=4,m<0||m>=n||y<0||y>=n)throw"Something wrong with HUF_ENCSIZE";var w=new Array(n),x=new Array(a);if(function(e){for(var t=0;t<a;t++)e[t]={},e[t].len=0,e[t].lit=0,e[t].p=null}(x),c(e,0,i,o-(i.value-g),m,y,w),b>8*(o-(i.value-g)))throw"Something wrong with hufUncompress";!function(e,t,n,a){for(;t<=n;t++){var i=f(e[t]),o=u(e[t]);if(i>>o)throw"Invalid table entry";if(o>r){if((d=a[i>>o-r]).len)throw"Invalid table entry";if(d.lit++,d.p){var s=d.p;d.p=new Array(d.lit);for(var l=0;l<d.lit-1;++l)d.p[l]=s[l]}else d.p=new Array(1);d.p[d.lit-1]=t}else if(o){var c=0;for(l=1<<r-o;l>0;l--){var d;if((d=a[(i<<r-o)+c]).len||d.p)throw"Invalid table entry";d.len=o,d.lit=t,c++}}}}(w,m,y,x),function(e,t,n,a,i,o,s,l,c,g){for(var m=0,y=0,b=l,w=Math.trunc(i.value+(o+7)/8);i.value<w;)for(h(m,y,n,i),m=d.c,y=d.lc;y>=r;)if((U=t[m>>y-r&16383]).len)y-=U.len,v(U.lit,s,m,y,n,0,i,c,g,b),m=p.c,y=p.lc;else{if(!U.p)throw"hufDecode issues";var x;for(x=0;x<U.lit;x++){for(var S=u(e[U.p[x]]);y<S&&i.value<w;)h(m,y,n,i),m=d.c,y=d.lc;if(y>=S&&f(e[U.p[x]])==(m>>y-S&(1<<S)-1)){y-=S,v(U.p[x],s,m,y,n,0,i,c,g,b),m=p.c,y=p.lc;break}}if(x==U.lit)throw"hufDecode issues"}var _=8-o&7;for(m>>=_,y-=_;y>0;){var U;if(!(U=t[m<<r-y&16383]).len)throw"hufDecode issues";y-=U.len,v(U.lit,s,m,y,n,0,i,c,g,b),m=p.c,y=p.lc}}(w,x,e,0,i,b,y,l,s,{value:0})}function M(e){for(var t=1;t<e.length;t++){var r=e[t-1]+e[t]-128;e[t]=r}}function C(e,t){for(var r=0,n=Math.floor((e.length+1)/2),a=0,i=e.length-1;!(a>i||(t[a++]=e[r++],a>i));)t[a++]=e[n++]}function A(e){for(var t=e.byteLength,r=new Array,n=0,a=new DataView(e);t>0;){var i=a.getInt8(n++);if(i<0){t-=(s=-i)+1;for(var o=0;o<s;o++)r.push(a.getUint8(n++))}else{var s=i;t-=2;var l=a.getUint8(n++);for(o=0;o<s+1;o++)r.push(l)}}return r}function F(e,t,r){for(var n,a=1;a<64;)65280==(n=t[e.value])?a=64:n>>8==255?a+=255&n:(r[a]=n,a++),e.value++}function P(e,t){t[0]=K(e[0]),t[1]=K(e[1]),t[2]=K(e[5]),t[3]=K(e[6]),t[4]=K(e[14]),t[5]=K(e[15]),t[6]=K(e[27]),t[7]=K(e[28]),t[8]=K(e[2]),t[9]=K(e[4]),t[10]=K(e[7]),t[11]=K(e[13]),t[12]=K(e[16]),t[13]=K(e[26]),t[14]=K(e[29]),t[15]=K(e[42]),t[16]=K(e[3]),t[17]=K(e[8]),t[18]=K(e[12]),t[19]=K(e[17]),t[20]=K(e[25]),t[21]=K(e[30]),t[22]=K(e[41]),t[23]=K(e[43]),t[24]=K(e[9]),t[25]=K(e[11]),t[26]=K(e[18]),t[27]=K(e[24]),t[28]=K(e[31]),t[29]=K(e[40]),t[30]=K(e[44]),t[31]=K(e[53]),t[32]=K(e[10]),t[33]=K(e[19]),t[34]=K(e[23]),t[35]=K(e[32]),t[36]=K(e[39]),t[37]=K(e[45]),t[38]=K(e[52]),t[39]=K(e[54]),t[40]=K(e[20]),t[41]=K(e[22]),t[42]=K(e[33]),t[43]=K(e[38]),t[44]=K(e[46]),t[45]=K(e[51]),t[46]=K(e[55]),t[47]=K(e[60]),t[48]=K(e[21]),t[49]=K(e[34]),t[50]=K(e[37]),t[51]=K(e[47]),t[52]=K(e[50]),t[53]=K(e[56]),t[54]=K(e[59]),t[55]=K(e[61]),t[56]=K(e[35]),t[57]=K(e[36]),t[58]=K(e[48]),t[59]=K(e[49]),t[60]=K(e[57]),t[61]=K(e[58]),t[62]=K(e[62]),t[63]=K(e[63])}function O(e){const t=.5*Math.cos(.7853975),r=.5*Math.cos(3.14159/16),n=.5*Math.cos(3.14159/8),a=.5*Math.cos(3*3.14159/16),i=.5*Math.cos(.981746875),o=.5*Math.cos(3*3.14159/8),s=.5*Math.cos(1.374445625);for(var l=new Array(4),c=new Array(4),u=new Array(4),f=new Array(4),d=0;d<8;++d){var h=8*d;l[0]=n*e[h+2],l[1]=o*e[h+2],l[2]=n*e[h+6],l[3]=o*e[h+6],c[0]=r*e[h+1]+a*e[h+3]+i*e[h+5]+s*e[h+7],c[1]=a*e[h+1]-s*e[h+3]-r*e[h+5]-i*e[h+7],c[2]=i*e[h+1]-r*e[h+3]+s*e[h+5]+a*e[h+7],c[3]=s*e[h+1]-i*e[h+3]+a*e[h+5]-r*e[h+7],u[0]=t*(e[h+0]+e[h+4]),u[3]=t*(e[h+0]-e[h+4]),u[1]=l[0]+l[3],u[2]=l[1]-l[2],f[0]=u[0]+u[1],f[1]=u[3]+u[2],f[2]=u[3]-u[2],f[3]=u[0]-u[1],e[h+0]=f[0]+c[0],e[h+1]=f[1]+c[1],e[h+2]=f[2]+c[2],e[h+3]=f[3]+c[3],e[h+4]=f[3]-c[3],e[h+5]=f[2]-c[2],e[h+6]=f[1]-c[1],e[h+7]=f[0]-c[0]}for(var p=0;p<8;++p)l[0]=n*e[16+p],l[1]=o*e[16+p],l[2]=n*e[48+p],l[3]=o*e[48+p],c[0]=r*e[8+p]+a*e[24+p]+i*e[40+p]+s*e[56+p],c[1]=a*e[8+p]-s*e[24+p]-r*e[40+p]-i*e[56+p],c[2]=i*e[8+p]-r*e[24+p]+s*e[40+p]+a*e[56+p],c[3]=s*e[8+p]-i*e[24+p]+a*e[40+p]-r*e[56+p],u[0]=t*(e[p]+e[32+p]),u[3]=t*(e[p]-e[32+p]),u[1]=l[0]+l[3],u[2]=l[1]-l[2],f[0]=u[0]+u[1],f[1]=u[3]+u[2],f[2]=u[3]-u[2],f[3]=u[0]-u[1],e[0+p]=f[0]+c[0],e[8+p]=f[1]+c[1],e[16+p]=f[2]+c[2],e[24+p]=f[3]+c[3],e[32+p]=f[3]-c[3],e[40+p]=f[2]-c[2],e[48+p]=f[1]-c[1],e[56+p]=f[0]-c[0]}function I(e){for(var t=0;t<64;++t){var r=e[0][t],n=e[1][t],a=e[2][t];e[0][t]=r+1.5747*a,e[1][t]=r-.1873*n-.4682*a,e[2][t]=r+1.8556*n}}function R(e,t,r){for(var n=0;n<64;++n)t[r+n]=x.toHalfFloat(D(e[n]))}function D(e){return e<=1?Math.sign(e)*Math.pow(Math.abs(e),2.2):Math.sign(e)*Math.pow(i,Math.abs(e)-1)}function L(e){return new DataView(e.array.buffer,e.offset.value,e.size)}function B(e){var t=e.viewer.buffer.slice(e.offset.value,e.offset.value+e.size),r=new Uint8Array(A(t)),n=new Uint8Array(r.length);return M(r),C(r,n),new DataView(n.buffer)}function G(e){var t=ot(e.array.slice(e.offset.value,e.offset.value+e.size)),r=new Uint8Array(t.length);return M(t),C(t,r),new DataView(r.buffer)}function j(e){for(var r=e.viewer,n={value:e.offset.value},a=new Uint16Array(e.width*e.scanlineBlockSize*(e.channels*e.type)),i=new Uint8Array(8192),o=0,s=new Array(e.channels),l=0;l<e.channels;l++)s[l]={},s[l].start=o,s[l].end=s[l].start,s[l].nx=e.width,s[l].ny=e.lines,s[l].size=e.type,o+=s[l].nx*s[l].ny*s[l].size;var c=Q(r,n),u=Q(r,n);if(u>=8192)throw"Something is wrong with PIZ_COMPRESSION BITMAP_SIZE";if(c<=u)for(l=0;l<u-c+1;l++)i[l+c]=Y(r,n);var f=new Uint16Array(t),d=function(e,r){for(var n=0,a=0;a<t;++a)(0==a||e[a>>3]&1<<(7&a))&&(r[n++]=a);for(var i=n-1;n<t;)r[n++]=0;return i}(i,f),h=V(r,n);E(e.array,r,n,h,a,o);for(l=0;l<e.channels;++l)for(var p=s[l],v=0;v<s[l].size;++v)k(a,p.start+v,p.nx,p.size,p.ny,p.nx*p.size,d);!function(e,t,r){for(var n=0;n<r;++n)t[n]=e[t[n]]}(f,a,o);for(var g=0,m=new Uint8Array(a.buffer.byteLength),y=0;y<e.lines;y++)for(var b=0;b<e.channels;b++){var w=(p=s[b]).nx*p.size,x=new Uint8Array(a.buffer,2*p.end,2*w);m.set(x,g),g+=2*w,p.end+=w}return new DataView(m.buffer)}function z(e){var t=ot(e.array.slice(e.offset.value,e.offset.value+e.size));const r=e.lines*e.channels*e.width,n=1==e.type?new Uint16Array(r):new Uint32Array(r);let a=0,i=0;const o=new Array(4);for(let s=0;s<e.lines;s++)for(let r=0;r<e.channels;r++){let r=0;switch(e.type){case 1:o[0]=a,o[1]=o[0]+e.width,a=o[1]+e.width;for(let a=0;a<e.width;++a){r+=t[o[0]++]<<8|t[o[1]++],n[i]=r,i++}break;case 2:o[0]=a,o[1]=o[0]+e.width,o[2]=o[1]+e.width,a=o[2]+e.width;for(let a=0;a<e.width;++a){r+=t[o[0]++]<<24|t[o[1]++]<<16|t[o[2]++]<<8,n[i]=r,i++}}}return new DataView(n.buffer)}function N(e){var t=e.viewer,r={value:e.offset.value},n=new Uint8Array(e.width*e.lines*(e.channels*e.type*2)),a={version:q(t,r),unknownUncompressedSize:q(t,r),unknownCompressedSize:q(t,r),acCompressedSize:q(t,r),dcCompressedSize:q(t,r),rleCompressedSize:q(t,r),rleUncompressedSize:q(t,r),rleRawSize:q(t,r),totalAcUncompressedCount:q(t,r),totalDcUncompressedCount:q(t,r),acCompression:q(t,r)};if(a.version<2)throw"EXRLoader.parse: "+ae.compression+" version "+a.version+" is unsupported";for(var i=new Array,o=Q(t,r)-2;o>0;){var s=W(t.buffer,r),l=Y(t,r),c=l>>2&3,u=new Int8Array([(l>>4)-1])[0],f=Y(t,r);i.push({name:s,index:u,type:f,compression:c}),o-=s.length+3}for(var d=ae.channels,h=new Array(e.channels),p=0;p<e.channels;++p){var v=h[p]={},g=d[p];v.name=g.name,v.compression=0,v.decoded=!1,v.type=g.pixelType,v.pLinear=g.pLinear,v.width=e.width,v.height=e.lines}for(var m={idx:new Array(3)},y=0;y<e.channels;++y)for(v=h[y],p=0;p<i.length;++p){var b=i[p];v.name==b.name&&(v.compression=b.compression,b.index>=0&&(m.idx[b.index]=y),v.offset=y)}if(a.acCompressedSize>0)switch(a.acCompression){case 0:var w=new Uint16Array(a.totalAcUncompressedCount);E(e.array,t,r,a.acCompressedSize,w,a.totalAcUncompressedCount);break;case 1:var x=ot(e.array.slice(r.value,r.value+a.totalAcUncompressedCount));w=new Uint16Array(x.buffer);r.value+=a.totalAcUncompressedCount}if(a.dcCompressedSize>0){var S={array:e.array,offset:r,size:a.dcCompressedSize},_=new Uint16Array(G(S).buffer);r.value+=a.dcCompressedSize}if(a.rleRawSize>0){var U=A((x=ot(e.array.slice(r.value,r.value+a.rleCompressedSize))).buffer);r.value+=a.rleCompressedSize}var T=0,k=new Array(h.length);for(p=0;p<k.length;++p)k[p]=new Array;for(var M=0;M<e.lines;++M)for(var C=0;C<h.length;++C)k[C].push(T),T+=h[C].width*e.type*2;!function(e,t,r,n,a,i){var o=new DataView(i.buffer),s=r[e.idx[0]].width,l=r[e.idx[0]].height,c=Math.floor(s/8),u=Math.ceil(s/8),f=Math.ceil(l/8),d=s-8*(u-1),h=l-8*(f-1),p={value:0},v=new Array(3),g=new Array(3),m=new Array(3),y=new Array(3),b=new Array(3);for(let E=0;E<3;++E)b[E]=t[e.idx[E]],v[E]=E<1?0:v[E-1]+u*f,g[E]=new Float32Array(64),m[E]=new Uint16Array(64),y[E]=new Uint16Array(64*u);for(let E=0;E<f;++E){var w=8;E==f-1&&(w=h);var x=8;for(let e=0;e<u;++e){e==u-1&&(x=d);for(let e=0;e<3;++e)m[e].fill(0),m[e][0]=a[v[e]++],F(p,n,m[e]),P(m[e],g[e]),O(g[e]);I(g);for(let t=0;t<3;++t)R(g[t],y[t],64*e)}let t=0;for(let n=0;n<3;++n){const a=r[e.idx[n]].type;for(let e=8*E;e<8*E+w;++e){t=b[n][e];for(let r=0;r<c;++r){const i=64*r+8*(7&e);o.setUint16(t+0*a,y[n][i+0],!0),o.setUint16(t+2*a,y[n][i+1],!0),o.setUint16(t+4*a,y[n][i+2],!0),o.setUint16(t+6*a,y[n][i+3],!0),o.setUint16(t+8*a,y[n][i+4],!0),o.setUint16(t+10*a,y[n][i+5],!0),o.setUint16(t+12*a,y[n][i+6],!0),o.setUint16(t+14*a,y[n][i+7],!0),t+=16*a}}if(c!=u)for(let e=8*E;e<8*E+w;++e){const t=b[n][e]+8*c*2*a,r=64*c+8*(7&e);for(let e=0;e<x;++e)o.setUint16(t+2*e*a,y[n][r+e],!0)}}}for(var S=new Uint16Array(s),_=(o=new DataView(i.buffer),0);_<3;++_){r[e.idx[_]].decoded=!0;var U=r[e.idx[_]].type;if(2==r[_].type)for(var T=0;T<l;++T){const e=b[_][T];for(var k=0;k<s;++k)S[k]=o.getUint16(e+2*k*U,!0);for(k=0;k<s;++k)o.setFloat32(e+2*k*U,K(S[k]),!0)}}}(m,k,h,w,_,n);for(p=0;p<h.length;++p){if(!(v=h[p]).decoded){if(2!==v.compression)throw"EXRLoader.parse: unsupported channel compression";var D=0,L=0;for(M=0;M<e.lines;++M){for(var B=k[p][D],j=0;j<v.width;++j){for(var z=0;z<2*v.type;++z)n[B++]=U[L+z*v.width*v.height];L++}D++}}}return new DataView(n.buffer)}function W(e,t){for(var r=new Uint8Array(e),n=0;0!=r[t.value+n];)n+=1;var a=(new TextDecoder).decode(r.slice(t.value,t.value+n));return t.value=t.value+n+1,a}function H(e,t){var r=e.getInt32(t.value,!0);return t.value=t.value+4,r}function V(e,t){var r=e.getUint32(t.value,!0);return t.value=t.value+4,r}function X(e,t){var r=e[t.value];return t.value=t.value+1,r}function Y(e,t){var r=e.getUint8(t.value);return t.value=t.value+1,r}const q=function(e,t){let r;return r="getBigInt64"in DataView.prototype?Number(e.getBigInt64(t.value,!0)):e.getUint32(t.value+4,!0)+Number(e.getUint32(t.value,!0)<<32),t.value+=8,r};function $(e,t){var r=e.getFloat32(t.value,!0);return t.value+=4,r}function Z(e,t){return x.toHalfFloat($(e,t))}function K(e){var t=(31744&e)>>10,r=1023&e;return(e>>15?-1:1)*(t?31===t?r?NaN:1/0:Math.pow(2,t-15)*(1+r/1024):r/1024*6103515625e-14)}function Q(e,t){var r=e.getUint16(t.value,!0);return t.value+=2,r}function J(e,t){return K(Q(e,t))}function ee(e,t,r,n,a){return"string"===n||"stringvector"===n||"iccProfile"===n?function(e,t,r){var n=(new TextDecoder).decode(new Uint8Array(e).slice(t.value,t.value+r));return t.value=t.value+r,n}(t,r,a):"chlist"===n?function(e,t,r,n){for(var a=r.value,i=[];r.value<a+n-1;){var o=W(t,r),s=H(e,r),l=Y(e,r);r.value+=3;var c=H(e,r),u=H(e,r);i.push({name:o,pixelType:s,pLinear:l,xSampling:c,ySampling:u})}return r.value+=1,i}(e,t,r,a):"chromaticities"===n?function(e,t){return{redX:$(e,t),redY:$(e,t),greenX:$(e,t),greenY:$(e,t),blueX:$(e,t),blueY:$(e,t),whiteX:$(e,t),whiteY:$(e,t)}}(e,r):"compression"===n?function(e,t){return["NO_COMPRESSION","RLE_COMPRESSION","ZIPS_COMPRESSION","ZIP_COMPRESSION","PIZ_COMPRESSION","PXR24_COMPRESSION","B44_COMPRESSION","B44A_COMPRESSION","DWAA_COMPRESSION","DWAB_COMPRESSION"][Y(e,t)]}(e,r):"box2i"===n?function(e,t){return{xMin:V(e,t),yMin:V(e,t),xMax:V(e,t),yMax:V(e,t)}}(e,r):"lineOrder"===n?function(e,t){return["INCREASING_Y"][Y(e,t)]}(e,r):"float"===n?$(e,r):"v2f"===n?function(e,t){return[$(e,t),$(e,t)]}(e,r):"v3f"===n?function(e,t){return[$(e,t),$(e,t),$(e,t)]}(e,r):"int"===n?H(e,r):"rational"===n?function(e,t){return[H(e,t),V(e,t)]}(e,r):"timecode"===n?function(e,t){return[V(e,t),V(e,t)]}(e,r):"preview"===n?(r.value+=a,"skipped"):void(r.value+=a)}const te=new DataView(e),re=new Uint8Array(e),ne={value:0},ae=function(e,t,r){const n={};if(20000630!=e.getUint32(0,!0))throw"THREE.EXRLoader: provided file doesn't appear to be in OpenEXR format.";n.version=e.getUint8(4);const a=e.getUint8(5);n.spec={singleTile:!!(2&a),longName:!!(4&a),deepFormat:!!(8&a),multiPart:!!(16&a)},r.value=8;for(var i=!0;i;){var o=W(t,r);if(0==o)i=!1;else{var s=ee(e,t,r,W(t,r),V(e,r));void 0===s||(n[o]=s)}}if(-5&a)throw"THREE.EXRLoader: provided file is currently unsupported.";return n}(te,e,ne),ie=function(e,t,r,n,a){const i={size:0,viewer:t,array:r,offset:n,width:e.dataWindow.xMax-e.dataWindow.xMin+1,height:e.dataWindow.yMax-e.dataWindow.yMin+1,channels:e.channels.length,bytesPerLine:null,lines:null,inputSize:null,type:e.channels[0].pixelType,uncompress:null,getter:null,format:null,[wt?"colorSpace":"encoding"]:null};switch(e.compression){case"NO_COMPRESSION":i.lines=1,i.uncompress=L;break;case"RLE_COMPRESSION":i.lines=1,i.uncompress=B;break;case"ZIPS_COMPRESSION":i.lines=1,i.uncompress=G;break;case"ZIP_COMPRESSION":i.lines=16,i.uncompress=G;break;case"PIZ_COMPRESSION":i.lines=32,i.uncompress=j;break;case"PXR24_COMPRESSION":i.lines=16,i.uncompress=z;break;case"DWAA_COMPRESSION":i.lines=32,i.uncompress=N;break;case"DWAB_COMPRESSION":i.lines=256,i.uncompress=N;break;default:throw"EXRLoader.parse: "+e.compression+" is unsupported"}if(i.scanlineBlockSize=i.lines,1==i.type)switch(a){case w:i.getter=J,i.inputSize=2;break;case b:i.getter=Q,i.inputSize=2}else{if(2!=i.type)throw"EXRLoader.parse: unsupported pixelType "+i.type+" for "+e.compression+".";switch(a){case w:i.getter=$,i.inputSize=4;break;case b:i.getter=Z,i.inputSize=4}}i.blockCount=(e.dataWindow.yMax+1)/i.scanlineBlockSize;for(var o=0;o<i.blockCount;o++)q(t,n);i.outputChannels=3==i.channels?4:i.channels;const s=i.width*i.height*i.outputChannels;switch(a){case w:i.byteArray=new Float32Array(s),i.channels<i.outputChannels&&i.byteArray.fill(1,0,s);break;case b:i.byteArray=new Uint16Array(s),i.channels<i.outputChannels&&i.byteArray.fill(15360,0,s)}return i.bytesPerLine=i.width*i.inputSize*i.channels,4==i.outputChannels?i.format=_:i.format=U,wt?i.colorSpace="srgb-linear":i.encoding=3e3,i}(ae,te,re,ne,this.type),oe={value:0},se={R:0,G:1,B:2,A:3,Y:0};for(let b=0;b<ie.height/ie.scanlineBlockSize;b++){const e=V(te,ne);ie.size=V(te,ne),ie.lines=e+ie.scanlineBlockSize>ie.height?ie.height-e:ie.scanlineBlockSize;const t=ie.size<ie.lines*ie.bytesPerLine?ie.uncompress(ie):L(ie);ne.value+=ie.size;for(let r=0;r<ie.scanlineBlockSize;r++){const e=r+b*ie.scanlineBlockSize;if(e>=ie.height)break;for(let n=0;n<ie.channels;n++){const a=se[ae.channels[n].name];for(let i=0;i<ie.width;i++){oe.value=(r*(ie.channels*ie.width)+n*ie.width+i)*ie.inputSize;const o=(ie.height-1-e)*(ie.width*ie.outputChannels)+i*ie.outputChannels+a;ie.byteArray[o]=ie.getter(t,oe)}}}}return{header:ae,width:ie.width,height:ie.height,data:ie.byteArray,format:ie.format,[wt?"colorSpace":"encoding"]:ie[wt?"colorSpace":"encoding"],type:this.type}}setDataType(e){return this.type=e,this}load(e,t,r,n){return super.load(e,function(e,r){wt?e.colorSpace=r.colorSpace:e.encoding=r.encoding,e.minFilter=S,e.magFilter=S,e.generateMipmaps=!1,e.flipY=!1,t&&t(e,r)},r,n)}}function St(){var e=Object.create(null);function t(n,a){var i=n.id,o=n.name,s=n.dependencies;void 0===s&&(s=[]);var l=n.init;void 0===l&&(l=function(){});var c=n.getTransferables;if(void 0===c&&(c=null),!e[i])try{s=s.map(function(r){return r&&r.isWorkerModule&&(t(r,function(e){if(e instanceof Error)throw e}),r=e[r.id].value),r}),l=r("<"+o+">.init",l),c&&(c=r("<"+o+">.getTransferables",c));var u=null;"function"==typeof l&&(u=l.apply(void 0,s)),e[i]={id:i,value:u,getTransferables:c},a(u)}catch(f){!f||f.noLog,a(f)}}function r(e,t){var r=void 0;self.troikaDefine=function(e){return r=e};var n=URL.createObjectURL(new Blob(["/** "+e.replace(/\*/g,"")+" **/\n\ntroikaDefine(\n"+t+"\n)"],{type:"application/javascript"}));try{importScripts(n)}catch(a){}return URL.revokeObjectURL(n),delete self.troikaDefine,r}self.addEventListener("message",function(r){var n=r.data,a=n.messageId,i=n.action,o=n.data;try{"registerModule"===i&&t(o,function(e){e instanceof Error?postMessage({messageId:a,success:!1,error:e.message}):postMessage({messageId:a,success:!0,result:{isCallable:"function"==typeof e}})}),"callModule"===i&&function(t,r){var n,a=t.id,i=t.args;e[a]&&"function"==typeof e[a].value||r(new Error("Worker module "+a+": not found or its 'init' did not return a function"));try{var o=(n=e[a]).value.apply(n,i);o&&"function"==typeof o.then?o.then(s,function(e){return r(e instanceof Error?e:new Error(""+e))}):s(o)}catch(l){r(l)}function s(t){try{var n=e[a].getTransferables&&e[a].getTransferables(t);n&&Array.isArray(n)&&n.length||(n=void 0),r(t,n)}catch(l){r(l)}}}(o,function(e,t){e instanceof Error?postMessage({messageId:a,success:!1,error:e.message}):postMessage({messageId:a,success:!0,result:e},t||void 0)})}catch(s){postMessage({messageId:a,success:!1,error:s.stack})}})}var _t=function(){var e=!1;if("undefined"!=typeof window&&void 0!==window.document)try{new Worker(URL.createObjectURL(new Blob([""],{type:"application/javascript"}))).terminate(),e=!0}catch(t){}return _t=function(){return e},e},Ut=0,Tt=0,kt=!1,Et=Object.create(null),Mt=Object.create(null),Ct=Object.create(null);function At(e){if(!(e&&"function"==typeof e.init||kt))throw new Error("requires `options.init` function");var t=e.dependencies,r=e.init,n=e.getTransferables,a=e.workerId,i=function(e){var t=function(){for(var e=[],r=arguments.length;r--;)e[r]=arguments[r];return t._getInitResult().then(function(t){if("function"==typeof t)return t.apply(void 0,e);throw new Error("Worker module function was called but `init` did not return a callable function")})};return t._getInitResult=function(){var r=e.dependencies,n=e.init;r=Array.isArray(r)?r.map(function(e){return e&&(e=e.onMainThread||e)._getInitResult&&(e=e._getInitResult()),e}):[];var a=Promise.all(r).then(function(e){return n.apply(null,e)});return t._getInitResult=function(){return a},a},t}(e);null==a&&(a="#default");var o="workerModule"+ ++Ut,s=e.name||o,l=null;function c(){for(var e=[],t=arguments.length;t--;)e[t]=arguments[t];if(!_t())return i.apply(void 0,e);if(!l){l=Pt(a,"registerModule",c.workerModuleData);var r=function(){l=null,Mt[a].delete(r)};(Mt[a]||(Mt[a]=new Set)).add(r)}return l.then(function(t){if(t.isCallable)return Pt(a,"callModule",{id:o,args:e});throw new Error("Worker module function was called but `init` did not return a callable function")})}return t=t&&t.map(function(e){return"function"!=typeof e||e.workerModuleData||(kt=!0,e=At({workerId:a,name:"<"+s+"> function dependency: "+e.name,init:"function(){return (\n"+Ft(e)+"\n)}"}),kt=!1),e&&e.workerModuleData&&(e=e.workerModuleData),e}),c.workerModuleData={isWorkerModule:!0,id:o,name:s,dependencies:t,init:Ft(r),getTransferables:n&&Ft(n)},c.onMainThread=i,c}function Ft(e){var t=e.toString();return!/^function/.test(t)&&/^\w+\s*\(/.test(t)&&(t="function "+t),t}function Pt(e,t,r){return new Promise(function(n,a){var i=++Tt;Ct[i]=function(e){e.success?n(e.result):a(new Error("Error in worker "+t+" call: "+e.error))},function(e){var t=Et[e];if(!t){var r=Ft(St);(t=Et[e]=new Worker(URL.createObjectURL(new Blob(["/** Worker Module Bootstrap: "+e.replace(/\*/g,"")+" **/\n\n;("+r+")()"],{type:"application/javascript"})))).onmessage=function(e){var t=e.data,r=t.messageId,n=Ct[r];if(!n)throw new Error("WorkerModule response with empty or unknown messageId");delete Ct[r],n(t)}}return t}(e).postMessage({messageId:i,action:t,data:r})})}function Ot(){var e=function(e){function t(e,t,r,n,a,i,o,s){var l=1-o;s.x=l*l*e+2*l*o*r+o*o*a,s.y=l*l*t+2*l*o*n+o*o*i}function r(e,t,r,n,a,i,o,s,l,c){var u=1-l;c.x=u*u*u*e+3*u*u*l*r+3*u*l*l*a+l*l*l*o,c.y=u*u*u*t+3*u*u*l*n+3*u*l*l*i+l*l*l*s}function n(e,t){for(var r,n,a,i,o,s=/([MLQCZ])([^MLQCZ]*)/g;r=s.exec(e);){var l=r[2].replace(/^\s*|\s*$/g,"").split(/[,\s]+/).map(function(e){return parseFloat(e)});switch(r[1]){case"M":i=n=l[0],o=a=l[1];break;case"L":l[0]===i&&l[1]===o||t("L",i,o,i=l[0],o=l[1]);break;case"Q":t("Q",i,o,i=l[2],o=l[3],l[0],l[1]);break;case"C":t("C",i,o,i=l[4],o=l[5],l[0],l[1],l[2],l[3]);break;case"Z":i===n&&o===a||t("L",i,o,n,a)}}}function a(e,a,i){void 0===i&&(i=16);var o={x:0,y:0};n(e,function(e,n,s,l,c,u,f,d,h){switch(e){case"L":a(n,s,l,c);break;case"Q":for(var p=n,v=s,g=1;g<i;g++)t(n,s,u,f,l,c,g/(i-1),o),a(p,v,o.x,o.y),p=o.x,v=o.y;break;case"C":for(var m=n,y=s,b=1;b<i;b++)r(n,s,u,f,d,h,l,c,b/(i-1),o),a(m,y,o.x,o.y),m=o.x,y=o.y}})}var i="precision highp float;attribute vec2 aUV;varying vec2 vUV;void main(){vUV=aUV;gl_Position=vec4(mix(vec2(-1.0),vec2(1.0),aUV),0.0,1.0);}",o=new WeakMap,s={premultipliedAlpha:!1,preserveDrawingBuffer:!0,antialias:!1,depth:!1};function l(e,t){var r=e.getContext?e.getContext("webgl",s):e,n=o.get(r);if(!n){let e=function(e){var t=i[e];if(!t&&!(t=i[e]=r.getExtension(e)))throw new Error(e+" not supported");return t},t=function(e,t){var n=r.createShader(t);return r.shaderSource(n,e),r.compileShader(n),n},s=function(n,i,o,s){if(!l[n]){var c={},u={},f=r.createProgram();r.attachShader(f,t(i,r.VERTEX_SHADER)),r.attachShader(f,t(o,r.FRAGMENT_SHADER)),r.linkProgram(f),l[n]={program:f,transaction:function(t){r.useProgram(f),t({setUniform:function(e,t){for(var n=[],a=arguments.length-2;a-- >0;)n[a]=arguments[a+2];var i=u[t]||(u[t]=r.getUniformLocation(f,t));r["uniform"+e].apply(r,[i].concat(n))},setAttribute:function(t,n,i,o,s){var l=c[t];l||(l=c[t]={buf:r.createBuffer(),loc:r.getAttribLocation(f,t),data:null}),r.bindBuffer(r.ARRAY_BUFFER,l.buf),r.vertexAttribPointer(l.loc,n,r.FLOAT,!1,0,0),r.enableVertexAttribArray(l.loc),a?r.vertexAttribDivisor(l.loc,o):e("ANGLE_instanced_arrays").vertexAttribDivisorANGLE(l.loc,o),s!==l.data&&(r.bufferData(r.ARRAY_BUFFER,s,i),l.data=s)}})}}}l[n].transaction(s)},d=function(e,t){u++;try{r.activeTexture(r.TEXTURE0+u);var n=c[e];n||(n=c[e]=r.createTexture(),r.bindTexture(r.TEXTURE_2D,n),r.texParameteri(r.TEXTURE_2D,r.TEXTURE_MIN_FILTER,r.NEAREST),r.texParameteri(r.TEXTURE_2D,r.TEXTURE_MAG_FILTER,r.NEAREST)),r.bindTexture(r.TEXTURE_2D,n),t(n,u)}finally{u--}},h=function(e,t,n){var a=r.createFramebuffer();f.push(a),r.bindFramebuffer(r.FRAMEBUFFER,a),r.activeTexture(r.TEXTURE0+t),r.bindTexture(r.TEXTURE_2D,e),r.framebufferTexture2D(r.FRAMEBUFFER,r.COLOR_ATTACHMENT0,r.TEXTURE_2D,e,0);try{n(a)}finally{r.deleteFramebuffer(a),r.bindFramebuffer(r.FRAMEBUFFER,f[--f.length-1]||null)}},p=function(){i={},l={},c={},u=-1,f.length=0};var a="undefined"!=typeof WebGL2RenderingContext&&r instanceof WebGL2RenderingContext,i={},l={},c={},u=-1,f=[];r.canvas.addEventListener("webglcontextlost",function(e){p(),e.preventDefault()},!1),o.set(r,n={gl:r,isWebGL2:a,getExtension:e,withProgram:s,withTexture:d,withTextureFramebuffer:h,handleContextLoss:p})}t(n)}function c(e,t,r,n,a,o,s,c){void 0===s&&(s=15),void 0===c&&(c=null),l(e,function(e){var l=e.gl,u=e.withProgram;(0,e.withTexture)("copy",function(e,f){l.texImage2D(l.TEXTURE_2D,0,l.RGBA,a,o,0,l.RGBA,l.UNSIGNED_BYTE,t),u("copy",i,"precision highp float;uniform sampler2D tex;varying vec2 vUV;void main(){gl_FragColor=texture2D(tex,vUV);}",function(e){var t=e.setUniform;(0,e.setAttribute)("aUV",2,l.STATIC_DRAW,0,new Float32Array([0,0,2,0,0,2])),t("1i","image",f),l.bindFramebuffer(l.FRAMEBUFFER,c||null),l.disable(l.BLEND),l.colorMask(8&s,4&s,2&s,1&s),l.viewport(r,n,a,o),l.scissor(r,n,a,o),l.drawArrays(l.TRIANGLES,0,3)})})})}var u=Object.freeze({__proto__:null,withWebGLContext:l,renderImageData:c,resizeWebGLCanvasWithoutClearing:function(e,t,r){var n=e.width,a=e.height;l(e,function(i){var o=i.gl,s=new Uint8Array(n*a*4);o.readPixels(0,0,n,a,o.RGBA,o.UNSIGNED_BYTE,s),e.width=t,e.height=r,c(o,s,0,0,n,a)})}});function f(e,t,r,n,i,o){void 0===o&&(o=1);var s=new Uint8Array(e*t),l=n[2]-n[0],c=n[3]-n[1],u=[];a(r,function(e,t,r,n){u.push({x1:e,y1:t,x2:r,y2:n,minX:Math.min(e,r),minY:Math.min(t,n),maxX:Math.max(e,r),maxY:Math.max(t,n)})}),u.sort(function(e,t){return e.maxX-t.maxX});for(var f=0;f<e;f++)for(var d=0;d<t;d++){var h=g(n[0]+l*(f+.5)/e,n[1]+c*(d+.5)/t),v=Math.pow(1-Math.abs(h)/i,o)/2;h<0&&(v=1-v),v=Math.max(0,Math.min(255,Math.round(255*v))),s[d*e+f]=v}return s;function g(e,t){for(var r=1/0,n=1/0,a=u.length;a--;){var i=u[a];if(i.maxX+n<=e)break;if(e+n>i.minX&&t-n<i.maxY&&t+n>i.minY){var o=p(e,t,i.x1,i.y1,i.x2,i.y2);o<r&&(r=o,n=Math.sqrt(r))}}return function(e,t){for(var r=0,n=u.length;n--;){var a=u[n];if(a.maxX<=e)break;a.y1>t!=a.y2>t&&e<(a.x2-a.x1)*(t-a.y1)/(a.y2-a.y1)+a.x1&&(r+=a.y1<a.y2?1:-1)}return 0!==r}(e,t)&&(n=-n),n}}function d(e,t,r,n,a,i,o,s,l,c){void 0===i&&(i=1),void 0===s&&(s=0),void 0===l&&(l=0),void 0===c&&(c=0),h(e,t,r,n,a,i,o,null,s,l,c)}function h(e,t,r,n,a,i,o,s,l,u,d){void 0===i&&(i=1),void 0===l&&(l=0),void 0===u&&(u=0),void 0===d&&(d=0);for(var h=f(e,t,r,n,a,i),p=new Uint8Array(4*h.length),v=0;v<h.length;v++)p[4*v+d]=h[v];c(o,p,l,u,e,t,1<<3-d,s)}function p(e,t,r,n,a,i){var o=a-r,s=i-n,l=o*o+s*s,c=l?Math.max(0,Math.min(1,((e-r)*o+(t-n)*s)/l)):0,u=e-(r+c*o),f=t-(n+c*s);return u*u+f*f}var v=Object.freeze({__proto__:null,generate:f,generateIntoCanvas:d,generateIntoFramebuffer:h}),g=new Float32Array([0,0,2,0,0,2]),m=null,y=!1,b={},w=new WeakMap;function x(e){if(!y&&!T(e))throw new Error("WebGL generation not supported")}function S(e,t,r,n,a,i,o){if(void 0===i&&(i=1),void 0===o&&(o=null),!o&&!(o=m)){var s="function"==typeof OffscreenCanvas?new OffscreenCanvas(1,1):"undefined"!=typeof document?document.createElement("canvas"):null;if(!s)throw new Error("OffscreenCanvas or DOM canvas not supported");o=m=s.getContext("webgl",{depth:!1})}x(o);var c=new Uint8Array(e*t*4);l(o,function(o){var s=o.gl,l=o.withTexture,u=o.withTextureFramebuffer;l("readable",function(o,l){s.texImage2D(s.TEXTURE_2D,0,s.RGBA,e,t,0,s.RGBA,s.UNSIGNED_BYTE,null),u(o,l,function(o){U(e,t,r,n,a,i,s,o,0,0,0),s.readPixels(0,0,e,t,s.RGBA,s.UNSIGNED_BYTE,c)})})});for(var u=new Uint8Array(e*t),f=0,d=0;f<c.length;f+=4)u[d++]=c[f];return u}function _(e,t,r,n,a,i,o,s,l,c){void 0===i&&(i=1),void 0===s&&(s=0),void 0===l&&(l=0),void 0===c&&(c=0),U(e,t,r,n,a,i,o,null,s,l,c)}function U(e,t,r,n,o,s,c,u,f,d,h){void 0===s&&(s=1),void 0===f&&(f=0),void 0===d&&(d=0),void 0===h&&(h=0),x(c);var p=[];a(r,function(e,t,r,n){p.push(e,t,r,n)}),p=new Float32Array(p),l(c,function(r){var a=r.gl,l=r.isWebGL2,c=r.getExtension,v=r.withProgram,m=r.withTexture,y=r.withTextureFramebuffer,b=r.handleContextLoss;if(m("rawDistances",function(r,m){e===r._lastWidth&&t===r._lastHeight||a.texImage2D(a.TEXTURE_2D,0,a.RGBA,r._lastWidth=e,r._lastHeight=t,0,a.RGBA,a.UNSIGNED_BYTE,null),v("main","precision highp float;uniform vec4 uGlyphBounds;attribute vec2 aUV;attribute vec4 aLineSegment;varying vec4 vLineSegment;varying vec2 vGlyphXY;void main(){vLineSegment=aLineSegment;vGlyphXY=mix(uGlyphBounds.xy,uGlyphBounds.zw,aUV);gl_Position=vec4(mix(vec2(-1.0),vec2(1.0),aUV),0.0,1.0);}","precision highp float;uniform vec4 uGlyphBounds;uniform float uMaxDistance;uniform float uExponent;varying vec4 vLineSegment;varying vec2 vGlyphXY;float absDistToSegment(vec2 point,vec2 lineA,vec2 lineB){vec2 lineDir=lineB-lineA;float lenSq=dot(lineDir,lineDir);float t=lenSq==0.0 ? 0.0 : clamp(dot(point-lineA,lineDir)/lenSq,0.0,1.0);vec2 linePt=lineA+t*lineDir;return distance(point,linePt);}void main(){vec4 seg=vLineSegment;vec2 p=vGlyphXY;float dist=absDistToSegment(p,seg.xy,seg.zw);float val=pow(1.0-clamp(dist/uMaxDistance,0.0,1.0),uExponent)*0.5;bool crossing=(seg.y>p.y!=seg.w>p.y)&&(p.x<(seg.z-seg.x)*(p.y-seg.y)/(seg.w-seg.y)+seg.x);bool crossingUp=crossing&&vLineSegment.y<vLineSegment.w;gl_FragColor=vec4(crossingUp ? 1.0/255.0 : 0.0,crossing&&!crossingUp ? 1.0/255.0 : 0.0,0.0,val);}",function(i){var u=i.setAttribute,f=i.setUniform,d=!l&&c("ANGLE_instanced_arrays"),h=!l&&c("EXT_blend_minmax");u("aUV",2,a.STATIC_DRAW,0,g),u("aLineSegment",4,a.DYNAMIC_DRAW,1,p),f.apply(void 0,["4f","uGlyphBounds"].concat(n)),f("1f","uMaxDistance",o),f("1f","uExponent",s),y(r,m,function(r){a.enable(a.BLEND),a.colorMask(!0,!0,!0,!0),a.viewport(0,0,e,t),a.scissor(0,0,e,t),a.blendFunc(a.ONE,a.ONE),a.blendEquationSeparate(a.FUNC_ADD,l?a.MAX:h.MAX_EXT),a.clear(a.COLOR_BUFFER_BIT),l?a.drawArraysInstanced(a.TRIANGLES,0,3,p.length/4):d.drawArraysInstancedANGLE(a.TRIANGLES,0,3,p.length/4)})}),v("post",i,"precision highp float;uniform sampler2D tex;varying vec2 vUV;void main(){vec4 color=texture2D(tex,vUV);bool inside=color.r!=color.g;float val=inside ? 1.0-color.a : color.a;gl_FragColor=vec4(val);}",function(r){r.setAttribute("aUV",2,a.STATIC_DRAW,0,g),r.setUniform("1i","tex",m),a.bindFramebuffer(a.FRAMEBUFFER,u),a.disable(a.BLEND),a.colorMask(0===h,1===h,2===h,3===h),a.viewport(f,d,e,t),a.scissor(f,d,e,t),a.drawArrays(a.TRIANGLES,0,3)})}),a.isContextLost())throw b(),new Error("webgl context lost")})}function T(e){var t=e&&e!==m?e.canvas||e:b,r=w.get(t);if(void 0===r){y=!0;try{var n=[97,106,97,61,99,137,118,80,80,118,137,99,61,97,106,97],a=S(4,4,"M8,8L16,8L24,24L16,24Z",[0,0,32,32],24,1,e);r=a&&n.length===a.length&&a.every(function(e,t){return e===n[t]}),r||"bad trial run results"}catch(i){r=!1,i.message}y=!1,w.set(t,r)}return r}var k=Object.freeze({__proto__:null,generate:S,generateIntoCanvas:_,generateIntoFramebuffer:U,isSupported:T});return e.forEachPathCommand=n,e.generate=function(e,t,r,n,a,i){void 0===a&&(a=Math.max(n[2]-n[0],n[3]-n[1])/2),void 0===i&&(i=1);try{return S.apply(k,arguments)}catch(Sn){return f.apply(v,arguments)}},e.generateIntoCanvas=function(e,t,r,n,a,i,o,s,l,c){void 0===a&&(a=Math.max(n[2]-n[0],n[3]-n[1])/2),void 0===i&&(i=1),void 0===s&&(s=0),void 0===l&&(l=0),void 0===c&&(c=0);try{return _.apply(k,arguments)}catch(Sn){return d.apply(v,arguments)}},e.javascript=v,e.pathToLineSegments=a,e.webgl=k,e.webglUtils=u,Object.defineProperty(e,"__esModule",{value:!0}),e}({});return e}const It=/\bvoid\s+main\s*\(\s*\)\s*{/g;function Rt(e){return e.replace(/^[ \t]*#include +<([\w\d./]+)>/gm,function(e,t){let r=C[t];return r?Rt(r):e})}const Dt=[];for(let _n=0;_n<256;_n++)Dt[_n]=(_n<16?"0":"")+_n.toString(16);const Lt=Object.assign||function(){let e=arguments[0];for(let t=1,r=arguments.length;t<r;t++){let r=arguments[t];if(r)for(let t in r)Object.prototype.hasOwnProperty.call(r,t)&&(e[t]=r[t])}return e},Bt=Date.now(),Gt=new WeakMap,jt=new Map;let zt=1e10;function Nt(e,t){const r=function(e){const t=JSON.stringify(e,Ht);let r=Xt.get(t);null==r&&Xt.set(t,r=++Vt);return r}(t);let n=Gt.get(e);if(n||Gt.set(e,n=Object.create(null)),n[r])return new n[r];const a=`_onBeforeCompile${r}`,i=function(n,i){e.onBeforeCompile.call(this,n,i);const o=this.customProgramCacheKey()+"|"+n.vertexShader+"|"+n.fragmentShader;let s=jt[o];if(!s){const e=function(e,{vertexShader:t,fragmentShader:r},n,a){let{vertexDefs:i,vertexMainIntro:o,vertexMainOutro:s,vertexTransform:l,fragmentDefs:c,fragmentMainIntro:u,fragmentMainOutro:f,fragmentColorTransform:d,customRewriter:h,timeUniform:p}=n;i=i||"",o=o||"",s=s||"",c=c||"",u=u||"",f=f||"",(l||h)&&(t=Rt(t));(d||h)&&(r=Rt(r=r.replace(/^[ \t]*#include <((?:tonemapping|encodings|colorspace|fog|premultiplied_alpha|dithering)_fragment)>/gm,"\n//!BEGIN_POST_CHUNK $1\n$&\n//!END_POST_CHUNK\n")));if(h){let e=h({vertexShader:t,fragmentShader:r});t=e.vertexShader,r=e.fragmentShader}if(d){let e=[];r=r.replace(/^\/\/!BEGIN_POST_CHUNK[^]+?^\/\/!END_POST_CHUNK/gm,t=>(e.push(t),"")),f=`${d}\n${e.join("\n")}\n${f}`}if(p){const e=`\nuniform float ${p};\n`;i=e+i,c=e+c}l&&(i=`${i}\nvoid troikaVertexTransform${a}(inout vec3 position, inout vec3 normal, inout vec2 uv) {\n  ${l}\n}\n`,o=`\ntroika_position_${a} = vec3(position);\ntroika_normal_${a} = vec3(normal);\ntroika_uv_${a} = vec2(uv);\ntroikaVertexTransform${a}(troika_position_${a}, troika_normal_${a}, troika_uv_${a});\n${o}\n`,t=(t=`vec3 troika_position_${a};\nvec3 troika_normal_${a};\nvec2 troika_uv_${a};\n${t}\n`).replace(/\b(position|normal|uv)\b/g,(e,t,r,n)=>/\battribute\s+vec[23]\s+$/.test(n.substr(0,r))?t:`troika_${t}_${a}`),e.map&&e.map.channel>0||(t=t.replace(/\bMAP_UV\b/g,`troika_uv_${a}`)));return t=Wt(t,a,i,o,s),r=Wt(r,a,c,u,f),{vertexShader:t,fragmentShader:r}}(this,n,t,r);s=jt[o]=e}n.vertexShader=s.vertexShader,n.fragmentShader=s.fragmentShader,Lt(n.uniforms,this.uniforms),t.timeUniform&&(n.uniforms[t.timeUniform]={get value(){return Date.now()-Bt}}),this[a]&&this[a](n)},o=function(){return s(t.chained?e:e.clone())},s=function(n){const a=Object.create(n,l);return Object.defineProperty(a,"baseMaterial",{value:e}),Object.defineProperty(a,"id",{value:zt++}),a.uuid=function(){const e=4294967295*Math.random()|0,t=4294967295*Math.random()|0,r=4294967295*Math.random()|0,n=4294967295*Math.random()|0;return(Dt[255&e]+Dt[e>>8&255]+Dt[e>>16&255]+Dt[e>>24&255]+"-"+Dt[255&t]+Dt[t>>8&255]+"-"+Dt[t>>16&15|64]+Dt[t>>24&255]+"-"+Dt[63&r|128]+Dt[r>>8&255]+"-"+Dt[r>>16&255]+Dt[r>>24&255]+Dt[255&n]+Dt[n>>8&255]+Dt[n>>16&255]+Dt[n>>24&255]).toUpperCase()}(),a.uniforms=Lt({},n.uniforms,t.uniforms),a.defines=Lt({},n.defines,t.defines),a.defines[`TROIKA_DERIVED_MATERIAL_${r}`]="",a.extensions=Lt({},n.extensions,t.extensions),a._listeners=void 0,a},l={constructor:{value:o},isDerivedMaterial:{value:!0},type:{get:()=>e.type,set:t=>{e.type=t}},isDerivedFrom:{writable:!0,configurable:!0,value:function(e){const t=this.baseMaterial;return e===t||t.isDerivedMaterial&&t.isDerivedFrom(e)||!1}},customProgramCacheKey:{writable:!0,configurable:!0,value:function(){return e.customProgramCacheKey()+"|"+r}},onBeforeCompile:{get:()=>i,set(e){this[a]=e}},copy:{writable:!0,configurable:!0,value:function(t){return e.copy.call(this,t),e.isShaderMaterial||e.isDerivedMaterial||(Lt(this.extensions,t.extensions),Lt(this.defines,t.defines),Lt(this.uniforms,M.clone(t.uniforms))),this}},clone:{writable:!0,configurable:!0,value:function(){const t=new e.constructor;return s(t).copy(this)}},getDepthMaterial:{writable:!0,configurable:!0,value:function(){let r=this._depthMaterial;return r||(r=this._depthMaterial=Nt(e.isDerivedMaterial?e.getDepthMaterial():new k({depthPacking:E}),t),r.defines.IS_DEPTH_MATERIAL="",r.uniforms=this.uniforms),r}},getDistanceMaterial:{writable:!0,configurable:!0,value:function(){let r=this._distanceMaterial;return r||(r=this._distanceMaterial=Nt(e.isDerivedMaterial?e.getDistanceMaterial():new T,t),r.defines.IS_DISTANCE_MATERIAL="",r.uniforms=this.uniforms),r}},dispose:{writable:!0,configurable:!0,value(){const{_depthMaterial:t,_distanceMaterial:r}=this;t&&t.dispose(),r&&r.dispose(),e.dispose.call(this)}}};return n[r]=o,new o}function Wt(e,t,r,n,a){return(n||a||r)&&(e=e.replace(It,`\n${r}\nvoid troikaOrigMain${t}() {`),e+=`\nvoid main() {\n  ${n}\n  troikaOrigMain${t}();\n  ${a}\n}`),e}function Ht(e,t){return"uniforms"===e?void 0:"function"==typeof t?t.toString():t}let Vt=0;const Xt=new Map;const Yt=At({name:"Typr Font Parser",dependencies:[function(){return"undefined"==typeof window&&(self.window=self),function(e){var t={parse:function(e){var r=t._bin,n=new Uint8Array(e);if("ttcf"==r.readASCII(n,0,4)){var a=4;r.readUshort(n,a),a+=2,r.readUshort(n,a),a+=2;var i=r.readUint(n,a);a+=4;for(var o=[],s=0;s<i;s++){var l=r.readUint(n,a);a+=4,o.push(t._readFont(n,l))}return o}return[t._readFont(n,0)]},_readFont:function(e,r){var n=t._bin,a=r;n.readFixed(e,r),r+=4;var i=n.readUshort(e,r);r+=2,n.readUshort(e,r),r+=2,n.readUshort(e,r),r+=2,n.readUshort(e,r),r+=2;for(var o=["cmap","head","hhea","maxp","hmtx","name","OS/2","post","loca","glyf","kern","CFF ","GDEF","GPOS","GSUB","SVG "],s={_data:e,_offset:a},l={},c=0;c<i;c++){var u=n.readASCII(e,r,4);r+=4,n.readUint(e,r),r+=4;var f=n.readUint(e,r);r+=4;var d=n.readUint(e,r);r+=4,l[u]={offset:f,length:d}}for(c=0;c<o.length;c++){var h=o[c];l[h]&&(s[h.trim()]=t[h.trim()].parse(e,l[h].offset,l[h].length,s))}return s},_tabOffset:function(e,r,n){for(var a=t._bin,i=a.readUshort(e,n+4),o=n+12,s=0;s<i;s++){var l=a.readASCII(e,o,4);o+=4,a.readUint(e,o),o+=4;var c=a.readUint(e,o);if(o+=4,a.readUint(e,o),o+=4,l==r)return c}return 0}};t._bin={readFixed:function(e,t){return(e[t]<<8|e[t+1])+(e[t+2]<<8|e[t+3])/65540},readF2dot14:function(e,r){return t._bin.readShort(e,r)/16384},readInt:function(e,r){return t._bin._view(e).getInt32(r)},readInt8:function(e,r){return t._bin._view(e).getInt8(r)},readShort:function(e,r){return t._bin._view(e).getInt16(r)},readUshort:function(e,r){return t._bin._view(e).getUint16(r)},readUshorts:function(e,r,n){for(var a=[],i=0;i<n;i++)a.push(t._bin.readUshort(e,r+2*i));return a},readUint:function(e,r){return t._bin._view(e).getUint32(r)},readUint64:function(e,r){return 4294967296*t._bin.readUint(e,r)+t._bin.readUint(e,r+4)},readASCII:function(e,t,r){for(var n="",a=0;a<r;a++)n+=String.fromCharCode(e[t+a]);return n},readUnicode:function(e,t,r){for(var n="",a=0;a<r;a++){var i=e[t++]<<8|e[t++];n+=String.fromCharCode(i)}return n},_tdec:"undefined"!=typeof window&&window.TextDecoder?new window.TextDecoder:null,readUTF8:function(e,r,n){var a=t._bin._tdec;return a&&0==r&&n==e.length?a.decode(e):t._bin.readASCII(e,r,n)},readBytes:function(e,t,r){for(var n=[],a=0;a<r;a++)n.push(e[t+a]);return n},readASCIIArray:function(e,t,r){for(var n=[],a=0;a<r;a++)n.push(String.fromCharCode(e[t+a]));return n},_view:function(e){return e._dataView||(e._dataView=e.buffer?new DataView(e.buffer,e.byteOffset,e.byteLength):new DataView(new Uint8Array(e).buffer))}},t._lctf={},t._lctf.parse=function(e,r,n,a,i){var o=t._bin,s={},l=r;o.readFixed(e,r),r+=4;var c=o.readUshort(e,r);r+=2;var u=o.readUshort(e,r);r+=2;var f=o.readUshort(e,r);return r+=2,s.scriptList=t._lctf.readScriptList(e,l+c),s.featureList=t._lctf.readFeatureList(e,l+u),s.lookupList=t._lctf.readLookupList(e,l+f,i),s},t._lctf.readLookupList=function(e,r,n){var a=t._bin,i=r,o=[],s=a.readUshort(e,r);r+=2;for(var l=0;l<s;l++){var c=a.readUshort(e,r);r+=2;var u=t._lctf.readLookupTable(e,i+c,n);o.push(u)}return o},t._lctf.readLookupTable=function(e,r,n){var a=t._bin,i=r,o={tabs:[]};o.ltype=a.readUshort(e,r),r+=2,o.flag=a.readUshort(e,r),r+=2;var s=a.readUshort(e,r);r+=2;for(var l=o.ltype,c=0;c<s;c++){var u=a.readUshort(e,r);r+=2;var f=n(e,l,i+u,o);o.tabs.push(f)}return o},t._lctf.numOfOnes=function(e){for(var t=0,r=0;r<32;r++)e>>>r&1&&t++;return t},t._lctf.readClassDef=function(e,r){var n=t._bin,a=[],i=n.readUshort(e,r);if(r+=2,1==i){var o=n.readUshort(e,r);r+=2;var s=n.readUshort(e,r);r+=2;for(var l=0;l<s;l++)a.push(o+l),a.push(o+l),a.push(n.readUshort(e,r)),r+=2}if(2==i){var c=n.readUshort(e,r);for(r+=2,l=0;l<c;l++)a.push(n.readUshort(e,r)),r+=2,a.push(n.readUshort(e,r)),r+=2,a.push(n.readUshort(e,r)),r+=2}return a},t._lctf.getInterval=function(e,t){for(var r=0;r<e.length;r+=3){var n=e[r],a=e[r+1];if(e[r+2],n<=t&&t<=a)return r}return-1},t._lctf.readCoverage=function(e,r){var n=t._bin,a={};a.fmt=n.readUshort(e,r),r+=2;var i=n.readUshort(e,r);return r+=2,1==a.fmt&&(a.tab=n.readUshorts(e,r,i)),2==a.fmt&&(a.tab=n.readUshorts(e,r,3*i)),a},t._lctf.coverageIndex=function(e,r){var n=e.tab;if(1==e.fmt)return n.indexOf(r);if(2==e.fmt){var a=t._lctf.getInterval(n,r);if(-1!=a)return n[a+2]+(r-n[a])}return-1},t._lctf.readFeatureList=function(e,r){var n=t._bin,a=r,i=[],o=n.readUshort(e,r);r+=2;for(var s=0;s<o;s++){var l=n.readASCII(e,r,4);r+=4;var c=n.readUshort(e,r);r+=2;var u=t._lctf.readFeatureTable(e,a+c);u.tag=l.trim(),i.push(u)}return i},t._lctf.readFeatureTable=function(e,r){var n=t._bin,a=r,i={},o=n.readUshort(e,r);r+=2,o>0&&(i.featureParams=a+o);var s=n.readUshort(e,r);r+=2,i.tab=[];for(var l=0;l<s;l++)i.tab.push(n.readUshort(e,r+2*l));return i},t._lctf.readScriptList=function(e,r){var n=t._bin,a=r,i={},o=n.readUshort(e,r);r+=2;for(var s=0;s<o;s++){var l=n.readASCII(e,r,4);r+=4;var c=n.readUshort(e,r);r+=2,i[l.trim()]=t._lctf.readScriptTable(e,a+c)}return i},t._lctf.readScriptTable=function(e,r){var n=t._bin,a=r,i={},o=n.readUshort(e,r);r+=2,o>0&&(i.default=t._lctf.readLangSysTable(e,a+o));var s=n.readUshort(e,r);r+=2;for(var l=0;l<s;l++){var c=n.readASCII(e,r,4);r+=4;var u=n.readUshort(e,r);r+=2,i[c.trim()]=t._lctf.readLangSysTable(e,a+u)}return i},t._lctf.readLangSysTable=function(e,r){var n=t._bin,a={};n.readUshort(e,r),r+=2,a.reqFeature=n.readUshort(e,r),r+=2;var i=n.readUshort(e,r);return r+=2,a.features=n.readUshorts(e,r,i),a},t.CFF={},t.CFF.parse=function(e,r,n){var a=t._bin;(e=new Uint8Array(e.buffer,r,n))[r=0],e[++r],e[++r],e[++r],r++;var i=[];r=t.CFF.readIndex(e,r,i);for(var o=[],s=0;s<i.length-1;s++)o.push(a.readASCII(e,r+i[s],i[s+1]-i[s]));r+=i[i.length-1];var l=[];r=t.CFF.readIndex(e,r,l);var c=[];for(s=0;s<l.length-1;s++)c.push(t.CFF.readDict(e,r+l[s],r+l[s+1]));r+=l[l.length-1];var u=c[0],f=[];r=t.CFF.readIndex(e,r,f);var d=[];for(s=0;s<f.length-1;s++)d.push(a.readASCII(e,r+f[s],f[s+1]-f[s]));if(r+=f[f.length-1],t.CFF.readSubrs(e,r,u),u.CharStrings){r=u.CharStrings,f=[],r=t.CFF.readIndex(e,r,f);var h=[];for(s=0;s<f.length-1;s++)h.push(a.readBytes(e,r+f[s],f[s+1]-f[s]));u.CharStrings=h}if(u.ROS){r=u.FDArray;var p=[];for(r=t.CFF.readIndex(e,r,p),u.FDArray=[],s=0;s<p.length-1;s++){var v=t.CFF.readDict(e,r+p[s],r+p[s+1]);t.CFF._readFDict(e,v,d),u.FDArray.push(v)}r+=p[p.length-1],r=u.FDSelect,u.FDSelect=[];var g=e[r];if(r++,3!=g)throw g;var m=a.readUshort(e,r);for(r+=2,s=0;s<m+1;s++)u.FDSelect.push(a.readUshort(e,r),e[r+2]),r+=3}return u.Encoding&&(u.Encoding=t.CFF.readEncoding(e,u.Encoding,u.CharStrings.length)),u.charset&&(u.charset=t.CFF.readCharset(e,u.charset,u.CharStrings.length)),t.CFF._readFDict(e,u,d),u},t.CFF._readFDict=function(e,r,n){var a;for(var i in r.Private&&(a=r.Private[1],r.Private=t.CFF.readDict(e,a,a+r.Private[0]),r.Private.Subrs&&t.CFF.readSubrs(e,a+r.Private.Subrs,r.Private)),r)-1!=["FamilyName","FontName","FullName","Notice","version","Copyright"].indexOf(i)&&(r[i]=n[r[i]-426+35])},t.CFF.readSubrs=function(e,r,n){var a=t._bin,i=[];r=t.CFF.readIndex(e,r,i);var o,s=i.length;o=s<1240?107:s<33900?1131:32768,n.Bias=o,n.Subrs=[];for(var l=0;l<i.length-1;l++)n.Subrs.push(a.readBytes(e,r+i[l],i[l+1]-i[l]))},t.CFF.tableSE=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27,28,29,30,31,32,33,34,35,36,37,38,39,40,41,42,43,44,45,46,47,48,49,50,51,52,53,54,55,56,57,58,59,60,61,62,63,64,65,66,67,68,69,70,71,72,73,74,75,76,77,78,79,80,81,82,83,84,85,86,87,88,89,90,91,92,93,94,95,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,96,97,98,99,100,101,102,103,104,105,106,107,108,109,110,0,111,112,113,114,0,115,116,117,118,119,120,121,122,0,123,0,124,125,126,127,128,129,130,131,0,132,133,0,134,135,136,137,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,138,0,139,0,0,0,0,140,141,142,143,0,0,0,0,0,144,0,0,0,145,0,0,146,147,148,149,0,0,0,0],t.CFF.glyphByUnicode=function(e,t){for(var r=0;r<e.charset.length;r++)if(e.charset[r]==t)return r;return-1},t.CFF.glyphBySE=function(e,r){return r<0||r>255?-1:t.CFF.glyphByUnicode(e,t.CFF.tableSE[r])},t.CFF.readEncoding=function(e,r,n){t._bin;var a=[".notdef"],i=e[r];if(r++,0!=i)throw"error: unknown encoding format: "+i;var o=e[r];r++;for(var s=0;s<o;s++)a.push(e[r+s]);return a},t.CFF.readCharset=function(e,r,n){var a=t._bin,i=[".notdef"],o=e[r];if(r++,0==o)for(var s=0;s<n;s++){var l=a.readUshort(e,r);r+=2,i.push(l)}else{if(1!=o&&2!=o)throw"error: format: "+o;for(;i.length<n;){l=a.readUshort(e,r),r+=2;var c=0;for(1==o?(c=e[r],r++):(c=a.readUshort(e,r),r+=2),s=0;s<=c;s++)i.push(l),l++}}return i},t.CFF.readIndex=function(e,r,n){var a=t._bin,i=a.readUshort(e,r)+1,o=e[r+=2];if(r++,1==o)for(var s=0;s<i;s++)n.push(e[r+s]);else if(2==o)for(s=0;s<i;s++)n.push(a.readUshort(e,r+2*s));else if(3==o)for(s=0;s<i;s++)n.push(16777215&a.readUint(e,r+3*s-1));else if(1!=i)throw"unsupported offset size: "+o+", count: "+i;return(r+=i*o)-1},t.CFF.getCharString=function(e,r,n){var a=t._bin,i=e[r],o=e[r+1];e[r+2],e[r+3],e[r+4];var s=1,l=null,c=null;i<=20&&(l=i,s=1),12==i&&(l=100*i+o,s=2),21<=i&&i<=27&&(l=i,s=1),28==i&&(c=a.readShort(e,r+1),s=3),29<=i&&i<=31&&(l=i,s=1),32<=i&&i<=246&&(c=i-139,s=1),247<=i&&i<=250&&(c=256*(i-247)+o+108,s=2),251<=i&&i<=254&&(c=256*-(i-251)-o-108,s=2),255==i&&(c=a.readInt(e,r+1)/65535,s=5),n.val=null!=c?c:"o"+l,n.size=s},t.CFF.readCharString=function(e,r,n){for(var a=r+n,i=t._bin,o=[];r<a;){var s=e[r],l=e[r+1];e[r+2],e[r+3],e[r+4];var c=1,u=null,f=null;s<=20&&(u=s,c=1),12==s&&(u=100*s+l,c=2),19!=s&&20!=s||(u=s,c=2),21<=s&&s<=27&&(u=s,c=1),28==s&&(f=i.readShort(e,r+1),c=3),29<=s&&s<=31&&(u=s,c=1),32<=s&&s<=246&&(f=s-139,c=1),247<=s&&s<=250&&(f=256*(s-247)+l+108,c=2),251<=s&&s<=254&&(f=256*-(s-251)-l-108,c=2),255==s&&(f=i.readInt(e,r+1)/65535,c=5),o.push(null!=f?f:"o"+u),r+=c}return o},t.CFF.readDict=function(e,r,n){for(var a=t._bin,i={},o=[];r<n;){var s=e[r],l=e[r+1];e[r+2],e[r+3],e[r+4];var c=1,u=null,f=null;if(28==s&&(f=a.readShort(e,r+1),c=3),29==s&&(f=a.readInt(e,r+1),c=5),32<=s&&s<=246&&(f=s-139,c=1),247<=s&&s<=250&&(f=256*(s-247)+l+108,c=2),251<=s&&s<=254&&(f=256*-(s-251)-l-108,c=2),255==s)throw f=a.readInt(e,r+1)/65535,c=5,"unknown number";if(30==s){var d=[];for(c=1;;){var h=e[r+c];c++;var p=h>>4,v=15&h;if(15!=p&&d.push(p),15!=v&&d.push(v),15==v)break}for(var g="",m=[0,1,2,3,4,5,6,7,8,9,".","e","e-","reserved","-","endOfNumber"],y=0;y<d.length;y++)g+=m[d[y]];f=parseFloat(g)}s<=21&&(u=["version","Notice","FullName","FamilyName","Weight","FontBBox","BlueValues","OtherBlues","FamilyBlues","FamilyOtherBlues","StdHW","StdVW","escape","UniqueID","XUID","charset","Encoding","CharStrings","Private","Subrs","defaultWidthX","nominalWidthX"][s],c=1,12==s&&(u=["Copyright","isFixedPitch","ItalicAngle","UnderlinePosition","UnderlineThickness","PaintType","CharstringType","FontMatrix","StrokeWidth","BlueScale","BlueShift","BlueFuzz","StemSnapH","StemSnapV","ForceBold",0,0,"LanguageGroup","ExpansionFactor","initialRandomSeed","SyntheticBase","PostScript","BaseFontName","BaseFontBlend",0,0,0,0,0,0,"ROS","CIDFontVersion","CIDFontRevision","CIDFontType","CIDCount","UIDBase","FDArray","FDSelect","FontName"][l],c=2)),null!=u?(i[u]=1==o.length?o[0]:o,o=[]):o.push(f),r+=c}return i},t.cmap={},t.cmap.parse=function(e,r,n){e=new Uint8Array(e.buffer,r,n),r=0;var a=t._bin,i={};a.readUshort(e,r),r+=2;var o=a.readUshort(e,r);r+=2;var s=[];i.tables=[];for(var l=0;l<o;l++){var c=a.readUshort(e,r);r+=2;var u=a.readUshort(e,r);r+=2;var f=a.readUint(e,r);r+=4;var d="p"+c+"e"+u,h=s.indexOf(f);if(-1==h){var p;h=i.tables.length,s.push(f);var v=a.readUshort(e,f);0==v?p=t.cmap.parse0(e,f):4==v?p=t.cmap.parse4(e,f):6==v?p=t.cmap.parse6(e,f):12==v&&(p=t.cmap.parse12(e,f)),i.tables.push(p)}if(null!=i[d])throw"multiple tables for one platform+encoding";i[d]=h}return i},t.cmap.parse0=function(e,r){var n=t._bin,a={};a.format=n.readUshort(e,r),r+=2;var i=n.readUshort(e,r);r+=2,n.readUshort(e,r),r+=2,a.map=[];for(var o=0;o<i-6;o++)a.map.push(e[r+o]);return a},t.cmap.parse4=function(e,r){var n=t._bin,a=r,i={};i.format=n.readUshort(e,r),r+=2;var o=n.readUshort(e,r);r+=2,n.readUshort(e,r),r+=2;var s=n.readUshort(e,r);r+=2;var l=s/2;i.searchRange=n.readUshort(e,r),r+=2,i.entrySelector=n.readUshort(e,r),r+=2,i.rangeShift=n.readUshort(e,r),r+=2,i.endCount=n.readUshorts(e,r,l),r+=2*l,r+=2,i.startCount=n.readUshorts(e,r,l),r+=2*l,i.idDelta=[];for(var c=0;c<l;c++)i.idDelta.push(n.readShort(e,r)),r+=2;for(i.idRangeOffset=n.readUshorts(e,r,l),r+=2*l,i.glyphIdArray=[];r<a+o;)i.glyphIdArray.push(n.readUshort(e,r)),r+=2;return i},t.cmap.parse6=function(e,r){var n=t._bin,a={};a.format=n.readUshort(e,r),r+=2,n.readUshort(e,r),r+=2,n.readUshort(e,r),r+=2,a.firstCode=n.readUshort(e,r),r+=2;var i=n.readUshort(e,r);r+=2,a.glyphIdArray=[];for(var o=0;o<i;o++)a.glyphIdArray.push(n.readUshort(e,r)),r+=2;return a},t.cmap.parse12=function(e,r){var n=t._bin,a={};a.format=n.readUshort(e,r),r+=2,r+=2,n.readUint(e,r),r+=4,n.readUint(e,r),r+=4;var i=n.readUint(e,r);r+=4,a.groups=[];for(var o=0;o<i;o++){var s=r+12*o,l=n.readUint(e,s+0),c=n.readUint(e,s+4),u=n.readUint(e,s+8);a.groups.push([l,c,u])}return a},t.glyf={},t.glyf.parse=function(e,t,r,n){for(var a=[],i=0;i<n.maxp.numGlyphs;i++)a.push(null);return a},t.glyf._parseGlyf=function(e,r){var n=t._bin,a=e._data,i=t._tabOffset(a,"glyf",e._offset)+e.loca[r];if(e.loca[r]==e.loca[r+1])return null;var o={};if(o.noc=n.readShort(a,i),i+=2,o.xMin=n.readShort(a,i),i+=2,o.yMin=n.readShort(a,i),i+=2,o.xMax=n.readShort(a,i),i+=2,o.yMax=n.readShort(a,i),i+=2,o.xMin>=o.xMax||o.yMin>=o.yMax)return null;if(o.noc>0){o.endPts=[];for(var s=0;s<o.noc;s++)o.endPts.push(n.readUshort(a,i)),i+=2;var l=n.readUshort(a,i);if(i+=2,a.length-i<l)return null;o.instructions=n.readBytes(a,i,l),i+=l;var c=o.endPts[o.noc-1]+1;for(o.flags=[],s=0;s<c;s++){var u=a[i];if(i++,o.flags.push(u),8&u){var f=a[i];i++;for(var d=0;d<f;d++)o.flags.push(u),s++}}for(o.xs=[],s=0;s<c;s++){var h=!!(2&o.flags[s]),p=!!(16&o.flags[s]);h?(o.xs.push(p?a[i]:-a[i]),i++):p?o.xs.push(0):(o.xs.push(n.readShort(a,i)),i+=2)}for(o.ys=[],s=0;s<c;s++)h=!!(4&o.flags[s]),p=!!(32&o.flags[s]),h?(o.ys.push(p?a[i]:-a[i]),i++):p?o.ys.push(0):(o.ys.push(n.readShort(a,i)),i+=2);var v=0,g=0;for(s=0;s<c;s++)v+=o.xs[s],g+=o.ys[s],o.xs[s]=v,o.ys[s]=g}else{var m;o.parts=[];do{m=n.readUshort(a,i),i+=2;var y={m:{a:1,b:0,c:0,d:1,tx:0,ty:0},p1:-1,p2:-1};if(o.parts.push(y),y.glyphIndex=n.readUshort(a,i),i+=2,1&m){var b=n.readShort(a,i);i+=2;var w=n.readShort(a,i);i+=2}else b=n.readInt8(a,i),i++,w=n.readInt8(a,i),i++;2&m?(y.m.tx=b,y.m.ty=w):(y.p1=b,y.p2=w),8&m?(y.m.a=y.m.d=n.readF2dot14(a,i),i+=2):64&m?(y.m.a=n.readF2dot14(a,i),i+=2,y.m.d=n.readF2dot14(a,i),i+=2):128&m&&(y.m.a=n.readF2dot14(a,i),i+=2,y.m.b=n.readF2dot14(a,i),i+=2,y.m.c=n.readF2dot14(a,i),i+=2,y.m.d=n.readF2dot14(a,i),i+=2)}while(32&m);if(256&m){var x=n.readUshort(a,i);for(i+=2,o.instr=[],s=0;s<x;s++)o.instr.push(a[i]),i++}}return o},t.GDEF={},t.GDEF.parse=function(e,r,n,a){var i=r;r+=4;var o=t._bin.readUshort(e,r);return{glyphClassDef:0===o?null:t._lctf.readClassDef(e,i+o)}},t.GPOS={},t.GPOS.parse=function(e,r,n,a){return t._lctf.parse(e,r,n,a,t.GPOS.subt)},t.GPOS.subt=function(e,r,n,a){var i=t._bin,o=n,s={};if(s.fmt=i.readUshort(e,n),n+=2,1==r||2==r||3==r||7==r||8==r&&s.fmt<=2){var l=i.readUshort(e,n);n+=2,s.coverage=t._lctf.readCoverage(e,l+o)}if(1==r&&1==s.fmt){var c=i.readUshort(e,n);n+=2,0!=c&&(s.pos=t.GPOS.readValueRecord(e,n,c))}else if(2==r&&s.fmt>=1&&s.fmt<=2){c=i.readUshort(e,n),n+=2;var u=i.readUshort(e,n);n+=2;var f=t._lctf.numOfOnes(c),d=t._lctf.numOfOnes(u);if(1==s.fmt){s.pairsets=[];var h=i.readUshort(e,n);n+=2;for(var p=0;p<h;p++){var v=o+i.readUshort(e,n);n+=2;var g=i.readUshort(e,v);v+=2;for(var m=[],y=0;y<g;y++){var b=i.readUshort(e,v);v+=2,0!=c&&(T=t.GPOS.readValueRecord(e,v,c),v+=2*f),0!=u&&(k=t.GPOS.readValueRecord(e,v,u),v+=2*d),m.push({gid2:b,val1:T,val2:k})}s.pairsets.push(m)}}if(2==s.fmt){var w=i.readUshort(e,n);n+=2;var x=i.readUshort(e,n);n+=2;var S=i.readUshort(e,n);n+=2;var _=i.readUshort(e,n);for(n+=2,s.classDef1=t._lctf.readClassDef(e,o+w),s.classDef2=t._lctf.readClassDef(e,o+x),s.matrix=[],p=0;p<S;p++){var U=[];for(y=0;y<_;y++){var T=null,k=null;0!=c&&(T=t.GPOS.readValueRecord(e,n,c),n+=2*f),0!=u&&(k=t.GPOS.readValueRecord(e,n,u),n+=2*d),U.push({val1:T,val2:k})}s.matrix.push(U)}}}else if(4==r&&1==s.fmt)s.markCoverage=t._lctf.readCoverage(e,i.readUshort(e,n)+o),s.baseCoverage=t._lctf.readCoverage(e,i.readUshort(e,n+2)+o),s.markClassCount=i.readUshort(e,n+4),s.markArray=t.GPOS.readMarkArray(e,i.readUshort(e,n+6)+o),s.baseArray=t.GPOS.readBaseArray(e,i.readUshort(e,n+8)+o,s.markClassCount);else if(6==r&&1==s.fmt)s.mark1Coverage=t._lctf.readCoverage(e,i.readUshort(e,n)+o),s.mark2Coverage=t._lctf.readCoverage(e,i.readUshort(e,n+2)+o),s.markClassCount=i.readUshort(e,n+4),s.mark1Array=t.GPOS.readMarkArray(e,i.readUshort(e,n+6)+o),s.mark2Array=t.GPOS.readBaseArray(e,i.readUshort(e,n+8)+o,s.markClassCount);else if(9==r&&1==s.fmt){var E=i.readUshort(e,n);n+=2;var M=i.readUint(e,n);if(n+=4,9==a.ltype)a.ltype=E;else if(a.ltype!=E)throw"invalid extension substitution";return t.GPOS.subt(e,a.ltype,o+M)}return s},t.GPOS.readValueRecord=function(e,r,n){var a=t._bin,i=[];return i.push(1&n?a.readShort(e,r):0),r+=1&n?2:0,i.push(2&n?a.readShort(e,r):0),r+=2&n?2:0,i.push(4&n?a.readShort(e,r):0),r+=4&n?2:0,i.push(8&n?a.readShort(e,r):0),r+=8&n?2:0,i},t.GPOS.readBaseArray=function(e,r,n){var a=t._bin,i=[],o=r,s=a.readUshort(e,r);r+=2;for(var l=0;l<s;l++){for(var c=[],u=0;u<n;u++)c.push(t.GPOS.readAnchorRecord(e,o+a.readUshort(e,r))),r+=2;i.push(c)}return i},t.GPOS.readMarkArray=function(e,r){var n=t._bin,a=[],i=r,o=n.readUshort(e,r);r+=2;for(var s=0;s<o;s++){var l=t.GPOS.readAnchorRecord(e,n.readUshort(e,r+2)+i);l.markClass=n.readUshort(e,r),a.push(l),r+=4}return a},t.GPOS.readAnchorRecord=function(e,r){var n=t._bin,a={};return a.fmt=n.readUshort(e,r),a.x=n.readShort(e,r+2),a.y=n.readShort(e,r+4),a},t.GSUB={},t.GSUB.parse=function(e,r,n,a){return t._lctf.parse(e,r,n,a,t.GSUB.subt)},t.GSUB.subt=function(e,r,n,a){var i=t._bin,o=n,s={};if(s.fmt=i.readUshort(e,n),n+=2,1!=r&&2!=r&&4!=r&&5!=r&&6!=r)return null;if(1==r||2==r||4==r||5==r&&s.fmt<=2||6==r&&s.fmt<=2){var l=i.readUshort(e,n);n+=2,s.coverage=t._lctf.readCoverage(e,o+l)}if(1==r&&s.fmt>=1&&s.fmt<=2){if(1==s.fmt)s.delta=i.readShort(e,n),n+=2;else if(2==s.fmt){var c=i.readUshort(e,n);n+=2,s.newg=i.readUshorts(e,n,c),n+=2*s.newg.length}}else if(2==r&&1==s.fmt){c=i.readUshort(e,n),n+=2,s.seqs=[];for(var u=0;u<c;u++){var f=i.readUshort(e,n)+o;n+=2;var d=i.readUshort(e,f);s.seqs.push(i.readUshorts(e,f+2,d))}}else if(4==r)for(s.vals=[],c=i.readUshort(e,n),n+=2,u=0;u<c;u++){var h=i.readUshort(e,n);n+=2,s.vals.push(t.GSUB.readLigatureSet(e,o+h))}else if(5==r&&2==s.fmt){if(2==s.fmt){var p=i.readUshort(e,n);n+=2,s.cDef=t._lctf.readClassDef(e,o+p),s.scset=[];var v=i.readUshort(e,n);for(n+=2,u=0;u<v;u++){var g=i.readUshort(e,n);n+=2,s.scset.push(0==g?null:t.GSUB.readSubClassSet(e,o+g))}}}else if(6==r&&3==s.fmt){if(3==s.fmt){for(u=0;u<3;u++){c=i.readUshort(e,n),n+=2;for(var m=[],y=0;y<c;y++)m.push(t._lctf.readCoverage(e,o+i.readUshort(e,n+2*y)));n+=2*c,0==u&&(s.backCvg=m),1==u&&(s.inptCvg=m),2==u&&(s.ahedCvg=m)}c=i.readUshort(e,n),n+=2,s.lookupRec=t.GSUB.readSubstLookupRecords(e,n,c)}}else if(7==r&&1==s.fmt){var b=i.readUshort(e,n);n+=2;var w=i.readUint(e,n);if(n+=4,9==a.ltype)a.ltype=b;else if(a.ltype!=b)throw"invalid extension substitution";return t.GSUB.subt(e,a.ltype,o+w)}return s},t.GSUB.readSubClassSet=function(e,r){var n=t._bin.readUshort,a=r,i=[],o=n(e,r);r+=2;for(var s=0;s<o;s++){var l=n(e,r);r+=2,i.push(t.GSUB.readSubClassRule(e,a+l))}return i},t.GSUB.readSubClassRule=function(e,r){var n=t._bin.readUshort,a={},i=n(e,r),o=n(e,r+=2);r+=2,a.input=[];for(var s=0;s<i-1;s++)a.input.push(n(e,r)),r+=2;return a.substLookupRecords=t.GSUB.readSubstLookupRecords(e,r,o),a},t.GSUB.readSubstLookupRecords=function(e,r,n){for(var a=t._bin.readUshort,i=[],o=0;o<n;o++)i.push(a(e,r),a(e,r+2)),r+=4;return i},t.GSUB.readChainSubClassSet=function(e,r){var n=t._bin,a=r,i=[],o=n.readUshort(e,r);r+=2;for(var s=0;s<o;s++){var l=n.readUshort(e,r);r+=2,i.push(t.GSUB.readChainSubClassRule(e,a+l))}return i},t.GSUB.readChainSubClassRule=function(e,r){for(var n=t._bin,a={},i=["backtrack","input","lookahead"],o=0;o<i.length;o++){var s=n.readUshort(e,r);r+=2,1==o&&s--,a[i[o]]=n.readUshorts(e,r,s),r+=2*a[i[o]].length}return s=n.readUshort(e,r),r+=2,a.subst=n.readUshorts(e,r,2*s),r+=2*a.subst.length,a},t.GSUB.readLigatureSet=function(e,r){var n=t._bin,a=r,i=[],o=n.readUshort(e,r);r+=2;for(var s=0;s<o;s++){var l=n.readUshort(e,r);r+=2,i.push(t.GSUB.readLigature(e,a+l))}return i},t.GSUB.readLigature=function(e,r){var n=t._bin,a={chain:[]};a.nglyph=n.readUshort(e,r),r+=2;var i=n.readUshort(e,r);r+=2;for(var o=0;o<i-1;o++)a.chain.push(n.readUshort(e,r)),r+=2;return a},t.head={},t.head.parse=function(e,r,n){var a=t._bin,i={};return a.readFixed(e,r),r+=4,i.fontRevision=a.readFixed(e,r),r+=4,a.readUint(e,r),r+=4,a.readUint(e,r),r+=4,i.flags=a.readUshort(e,r),r+=2,i.unitsPerEm=a.readUshort(e,r),r+=2,i.created=a.readUint64(e,r),r+=8,i.modified=a.readUint64(e,r),r+=8,i.xMin=a.readShort(e,r),r+=2,i.yMin=a.readShort(e,r),r+=2,i.xMax=a.readShort(e,r),r+=2,i.yMax=a.readShort(e,r),r+=2,i.macStyle=a.readUshort(e,r),r+=2,i.lowestRecPPEM=a.readUshort(e,r),r+=2,i.fontDirectionHint=a.readShort(e,r),r+=2,i.indexToLocFormat=a.readShort(e,r),r+=2,i.glyphDataFormat=a.readShort(e,r),r+=2,i},t.hhea={},t.hhea.parse=function(e,r,n){var a=t._bin,i={};return a.readFixed(e,r),r+=4,i.ascender=a.readShort(e,r),r+=2,i.descender=a.readShort(e,r),r+=2,i.lineGap=a.readShort(e,r),r+=2,i.advanceWidthMax=a.readUshort(e,r),r+=2,i.minLeftSideBearing=a.readShort(e,r),r+=2,i.minRightSideBearing=a.readShort(e,r),r+=2,i.xMaxExtent=a.readShort(e,r),r+=2,i.caretSlopeRise=a.readShort(e,r),r+=2,i.caretSlopeRun=a.readShort(e,r),r+=2,i.caretOffset=a.readShort(e,r),r+=2,r+=8,i.metricDataFormat=a.readShort(e,r),r+=2,i.numberOfHMetrics=a.readUshort(e,r),r+=2,i},t.hmtx={},t.hmtx.parse=function(e,r,n,a){for(var i=t._bin,o={aWidth:[],lsBearing:[]},s=0,l=0,c=0;c<a.maxp.numGlyphs;c++)c<a.hhea.numberOfHMetrics&&(s=i.readUshort(e,r),r+=2,l=i.readShort(e,r),r+=2),o.aWidth.push(s),o.lsBearing.push(l);return o},t.kern={},t.kern.parse=function(e,r,n,a){var i=t._bin,o=i.readUshort(e,r);if(r+=2,1==o)return t.kern.parseV1(e,r-2,n,a);var s=i.readUshort(e,r);r+=2;for(var l={glyph1:[],rval:[]},c=0;c<s;c++){r+=2,n=i.readUshort(e,r),r+=2;var u=i.readUshort(e,r);r+=2;var f=u>>>8;if(0!=(f&=15))throw"unknown kern table format: "+f;r=t.kern.readFormat0(e,r,l)}return l},t.kern.parseV1=function(e,r,n,a){var i=t._bin;i.readFixed(e,r),r+=4;var o=i.readUint(e,r);r+=4;for(var s={glyph1:[],rval:[]},l=0;l<o;l++){i.readUint(e,r),r+=4;var c=i.readUshort(e,r);r+=2,i.readUshort(e,r),r+=2;var u=c>>>8;if(0!=(u&=15))throw"unknown kern table format: "+u;r=t.kern.readFormat0(e,r,s)}return s},t.kern.readFormat0=function(e,r,n){var a=t._bin,i=-1,o=a.readUshort(e,r);r+=2,a.readUshort(e,r),r+=2,a.readUshort(e,r),r+=2,a.readUshort(e,r),r+=2;for(var s=0;s<o;s++){var l=a.readUshort(e,r);r+=2;var c=a.readUshort(e,r);r+=2;var u=a.readShort(e,r);r+=2,l!=i&&(n.glyph1.push(l),n.rval.push({glyph2:[],vals:[]}));var f=n.rval[n.rval.length-1];f.glyph2.push(c),f.vals.push(u),i=l}return r},t.loca={},t.loca.parse=function(e,r,n,a){var i=t._bin,o=[],s=a.head.indexToLocFormat,l=a.maxp.numGlyphs+1;if(0==s)for(var c=0;c<l;c++)o.push(i.readUshort(e,r+(c<<1))<<1);if(1==s)for(c=0;c<l;c++)o.push(i.readUint(e,r+(c<<2)));return o},t.maxp={},t.maxp.parse=function(e,r,n){var a=t._bin,i={},o=a.readUint(e,r);return r+=4,i.numGlyphs=a.readUshort(e,r),r+=2,65536==o&&(i.maxPoints=a.readUshort(e,r),r+=2,i.maxContours=a.readUshort(e,r),r+=2,i.maxCompositePoints=a.readUshort(e,r),r+=2,i.maxCompositeContours=a.readUshort(e,r),r+=2,i.maxZones=a.readUshort(e,r),r+=2,i.maxTwilightPoints=a.readUshort(e,r),r+=2,i.maxStorage=a.readUshort(e,r),r+=2,i.maxFunctionDefs=a.readUshort(e,r),r+=2,i.maxInstructionDefs=a.readUshort(e,r),r+=2,i.maxStackElements=a.readUshort(e,r),r+=2,i.maxSizeOfInstructions=a.readUshort(e,r),r+=2,i.maxComponentElements=a.readUshort(e,r),r+=2,i.maxComponentDepth=a.readUshort(e,r),r+=2),i},t.name={},t.name.parse=function(e,r,n){var a=t._bin,i={};a.readUshort(e,r),r+=2;var o=a.readUshort(e,r);r+=2,a.readUshort(e,r);for(var s,l=["copyright","fontFamily","fontSubfamily","ID","fullName","version","postScriptName","trademark","manufacturer","designer","description","urlVendor","urlDesigner","licence","licenceURL","---","typoFamilyName","typoSubfamilyName","compatibleFull","sampleText","postScriptCID","wwsFamilyName","wwsSubfamilyName","lightPalette","darkPalette"],c=r+=2,u=0;u<o;u++){var f=a.readUshort(e,r);r+=2;var d=a.readUshort(e,r);r+=2;var h=a.readUshort(e,r);r+=2;var p=a.readUshort(e,r);r+=2;var v=a.readUshort(e,r);r+=2;var g=a.readUshort(e,r);r+=2;var m,y=l[p],b=c+12*o+g;if(0==f)m=a.readUnicode(e,b,v/2);else if(3==f&&0==d)m=a.readUnicode(e,b,v/2);else if(0==d)m=a.readASCII(e,b,v);else if(1==d)m=a.readUnicode(e,b,v/2);else if(3==d)m=a.readUnicode(e,b,v/2);else{if(1!=f)throw"unknown encoding "+d+", platformID: "+f;m=a.readASCII(e,b,v)}var w="p"+f+","+h.toString(16);null==i[w]&&(i[w]={}),i[w][void 0!==y?y:p]=m,i[w]._lang=h}for(var x in i)if(null!=i[x].postScriptName&&1033==i[x]._lang)return i[x];for(var x in i)if(null!=i[x].postScriptName&&0==i[x]._lang)return i[x];for(var x in i)if(null!=i[x].postScriptName&&3084==i[x]._lang)return i[x];for(var x in i)if(null!=i[x].postScriptName)return i[x];for(var x in i){s=x;break}return i[s]},t["OS/2"]={},t["OS/2"].parse=function(e,r,n){var a=t._bin.readUshort(e,r);r+=2;var i={};if(0==a)t["OS/2"].version0(e,r,i);else if(1==a)t["OS/2"].version1(e,r,i);else if(2==a||3==a||4==a)t["OS/2"].version2(e,r,i);else{if(5!=a)throw"unknown OS/2 table version: "+a;t["OS/2"].version5(e,r,i)}return i},t["OS/2"].version0=function(e,r,n){var a=t._bin;return n.xAvgCharWidth=a.readShort(e,r),r+=2,n.usWeightClass=a.readUshort(e,r),r+=2,n.usWidthClass=a.readUshort(e,r),r+=2,n.fsType=a.readUshort(e,r),r+=2,n.ySubscriptXSize=a.readShort(e,r),r+=2,n.ySubscriptYSize=a.readShort(e,r),r+=2,n.ySubscriptXOffset=a.readShort(e,r),r+=2,n.ySubscriptYOffset=a.readShort(e,r),r+=2,n.ySuperscriptXSize=a.readShort(e,r),r+=2,n.ySuperscriptYSize=a.readShort(e,r),r+=2,n.ySuperscriptXOffset=a.readShort(e,r),r+=2,n.ySuperscriptYOffset=a.readShort(e,r),r+=2,n.yStrikeoutSize=a.readShort(e,r),r+=2,n.yStrikeoutPosition=a.readShort(e,r),r+=2,n.sFamilyClass=a.readShort(e,r),r+=2,n.panose=a.readBytes(e,r,10),r+=10,n.ulUnicodeRange1=a.readUint(e,r),r+=4,n.ulUnicodeRange2=a.readUint(e,r),r+=4,n.ulUnicodeRange3=a.readUint(e,r),r+=4,n.ulUnicodeRange4=a.readUint(e,r),r+=4,n.achVendID=[a.readInt8(e,r),a.readInt8(e,r+1),a.readInt8(e,r+2),a.readInt8(e,r+3)],r+=4,n.fsSelection=a.readUshort(e,r),r+=2,n.usFirstCharIndex=a.readUshort(e,r),r+=2,n.usLastCharIndex=a.readUshort(e,r),r+=2,n.sTypoAscender=a.readShort(e,r),r+=2,n.sTypoDescender=a.readShort(e,r),r+=2,n.sTypoLineGap=a.readShort(e,r),r+=2,n.usWinAscent=a.readUshort(e,r),r+=2,n.usWinDescent=a.readUshort(e,r),r+2},t["OS/2"].version1=function(e,r,n){var a=t._bin;return r=t["OS/2"].version0(e,r,n),n.ulCodePageRange1=a.readUint(e,r),r+=4,n.ulCodePageRange2=a.readUint(e,r),r+4},t["OS/2"].version2=function(e,r,n){var a=t._bin;return r=t["OS/2"].version1(e,r,n),n.sxHeight=a.readShort(e,r),r+=2,n.sCapHeight=a.readShort(e,r),r+=2,n.usDefault=a.readUshort(e,r),r+=2,n.usBreak=a.readUshort(e,r),r+=2,n.usMaxContext=a.readUshort(e,r),r+2},t["OS/2"].version5=function(e,r,n){var a=t._bin;return r=t["OS/2"].version2(e,r,n),n.usLowerOpticalPointSize=a.readUshort(e,r),r+=2,n.usUpperOpticalPointSize=a.readUshort(e,r),r+2},t.post={},t.post.parse=function(e,r,n){var a=t._bin,i={};return i.version=a.readFixed(e,r),r+=4,i.italicAngle=a.readFixed(e,r),r+=4,i.underlinePosition=a.readShort(e,r),r+=2,i.underlineThickness=a.readShort(e,r),r+=2,i},null==t&&(t={}),null==t.U&&(t.U={}),t.U.codeToGlyph=function(e,t){var r=e.cmap,n=-1;if(null!=r.p0e4?n=r.p0e4:null!=r.p3e1?n=r.p3e1:null!=r.p1e0?n=r.p1e0:null!=r.p0e3&&(n=r.p0e3),-1==n)throw"no familiar platform and encoding!";var a=r.tables[n];if(0==a.format)return t>=a.map.length?0:a.map[t];if(4==a.format){for(var i=-1,o=0;o<a.endCount.length;o++)if(t<=a.endCount[o]){i=o;break}return-1==i||a.startCount[i]>t?0:65535&(0!=a.idRangeOffset[i]?a.glyphIdArray[t-a.startCount[i]+(a.idRangeOffset[i]>>1)-(a.idRangeOffset.length-i)]:t+a.idDelta[i])}if(12==a.format){if(t>a.groups[a.groups.length-1][1])return 0;for(o=0;o<a.groups.length;o++){var s=a.groups[o];if(s[0]<=t&&t<=s[1])return s[2]+(t-s[0])}return 0}throw"unknown cmap table format "+a.format},t.U.glyphToPath=function(e,r){var n={cmds:[],crds:[]};if(e.SVG&&e.SVG.entries[r]){var a=e.SVG.entries[r];return null==a?n:("string"==typeof a&&(a=t.SVG.toPath(a),e.SVG.entries[r]=a),a)}if(e.CFF){var i={x:0,y:0,stack:[],nStems:0,haveWidth:!1,width:e.CFF.Private?e.CFF.Private.defaultWidthX:0,open:!1},o=e.CFF,s=e.CFF.Private;if(o.ROS){for(var l=0;o.FDSelect[l+2]<=r;)l+=2;s=o.FDArray[o.FDSelect[l+1]].Private}t.U._drawCFF(e.CFF.CharStrings[r],i,o,s,n)}else e.glyf&&t.U._drawGlyf(r,e,n);return n},t.U._drawGlyf=function(e,r,n){var a=r.glyf[e];null==a&&(a=r.glyf[e]=t.glyf._parseGlyf(r,e)),null!=a&&(a.noc>-1?t.U._simpleGlyph(a,n):t.U._compoGlyph(a,r,n))},t.U._simpleGlyph=function(e,r){for(var n=0;n<e.noc;n++){for(var a=0==n?0:e.endPts[n-1]+1,i=e.endPts[n],o=a;o<=i;o++){var s=o==a?i:o-1,l=o==i?a:o+1,c=1&e.flags[o],u=1&e.flags[s],f=1&e.flags[l],d=e.xs[o],h=e.ys[o];if(o==a)if(c){if(!u){t.U.P.moveTo(r,d,h);continue}t.U.P.moveTo(r,e.xs[s],e.ys[s])}else u?t.U.P.moveTo(r,e.xs[s],e.ys[s]):t.U.P.moveTo(r,(e.xs[s]+d)/2,(e.ys[s]+h)/2);c?u&&t.U.P.lineTo(r,d,h):f?t.U.P.qcurveTo(r,d,h,e.xs[l],e.ys[l]):t.U.P.qcurveTo(r,d,h,(d+e.xs[l])/2,(h+e.ys[l])/2)}t.U.P.closePath(r)}},t.U._compoGlyph=function(e,r,n){for(var a=0;a<e.parts.length;a++){var i={cmds:[],crds:[]},o=e.parts[a];t.U._drawGlyf(o.glyphIndex,r,i);for(var s=o.m,l=0;l<i.crds.length;l+=2){var c=i.crds[l],u=i.crds[l+1];n.crds.push(c*s.a+u*s.b+s.tx),n.crds.push(c*s.c+u*s.d+s.ty)}for(l=0;l<i.cmds.length;l++)n.cmds.push(i.cmds[l])}},t.U._getGlyphClass=function(e,r){var n=t._lctf.getInterval(r,e);return-1==n?0:r[n+2]},t.U._applySubs=function(e,r,n,a){for(var i=e.length-r-1,o=0;o<n.tabs.length;o++)if(null!=n.tabs[o]){var s,l=n.tabs[o];if(!l.coverage||-1!=(s=t._lctf.coverageIndex(l.coverage,e[r])))if(1==n.ltype)e[r],1==l.fmt?e[r]=e[r]+l.delta:e[r]=l.newg[s];else if(4==n.ltype)for(var c=l.vals[s],u=0;u<c.length;u++){var f=c[u],d=f.chain.length;if(!(d>i)){for(var h=!0,p=0,v=0;v<d;v++){for(;-1==e[r+p+(1+v)];)p++;f.chain[v]!=e[r+p+(1+v)]&&(h=!1)}if(h){for(e[r]=f.nglyph,v=0;v<d+p;v++)e[r+v+1]=-1;break}}}else if(5==n.ltype&&2==l.fmt)for(var g=t._lctf.getInterval(l.cDef,e[r]),m=l.cDef[g+2],y=l.scset[m],b=0;b<y.length;b++){var w=y[b],x=w.input;if(!(x.length>i)){for(h=!0,v=0;v<x.length;v++){var S=t._lctf.getInterval(l.cDef,e[r+1+v]);if(-1==g&&l.cDef[S+2]!=x[v]){h=!1;break}}if(h){var _=w.substLookupRecords;for(u=0;u<_.length;u+=2)_[u],_[u+1]}}}else if(6==n.ltype&&3==l.fmt){if(!t.U._glsCovered(e,l.backCvg,r-l.backCvg.length))continue;if(!t.U._glsCovered(e,l.inptCvg,r))continue;if(!t.U._glsCovered(e,l.ahedCvg,r+l.inptCvg.length))continue;var U=l.lookupRec;for(b=0;b<U.length;b+=2){g=U[b];var T=a[U[b+1]];t.U._applySubs(e,r+g,T,a)}}}},t.U._glsCovered=function(e,r,n){for(var a=0;a<r.length;a++)if(-1==t._lctf.coverageIndex(r[a],e[n+a]))return!1;return!0},t.U.glyphsToPath=function(e,r,n){for(var a={cmds:[],crds:[]},i=0,o=0;o<r.length;o++){var s=r[o];if(-1!=s){for(var l=o<r.length-1&&-1!=r[o+1]?r[o+1]:0,c=t.U.glyphToPath(e,s),u=0;u<c.crds.length;u+=2)a.crds.push(c.crds[u]+i),a.crds.push(c.crds[u+1]);for(n&&a.cmds.push(n),u=0;u<c.cmds.length;u++)a.cmds.push(c.cmds[u]);n&&a.cmds.push("X"),i+=e.hmtx.aWidth[s],o<r.length-1&&(i+=t.U.getPairAdjustment(e,s,l))}}return a},t.U.P={},t.U.P.moveTo=function(e,t,r){e.cmds.push("M"),e.crds.push(t,r)},t.U.P.lineTo=function(e,t,r){e.cmds.push("L"),e.crds.push(t,r)},t.U.P.curveTo=function(e,t,r,n,a,i,o){e.cmds.push("C"),e.crds.push(t,r,n,a,i,o)},t.U.P.qcurveTo=function(e,t,r,n,a){e.cmds.push("Q"),e.crds.push(t,r,n,a)},t.U.P.closePath=function(e){e.cmds.push("Z")},t.U._drawCFF=function(e,r,n,a,i){for(var o=r.stack,s=r.nStems,l=r.haveWidth,c=r.width,u=r.open,f=0,d=r.x,h=r.y,p=0,v=0,g=0,m=0,y=0,b=0,w=0,x=0,S=0,_=0,U={val:0,size:0};f<e.length;){t.CFF.getCharString(e,f,U);var T=U.val;if(f+=U.size,"o1"==T||"o18"==T)o.length%2!=0&&!l&&(c=o.shift()+a.nominalWidthX),s+=o.length>>1,o.length=0,l=!0;else if("o3"==T||"o23"==T)o.length%2!=0&&!l&&(c=o.shift()+a.nominalWidthX),s+=o.length>>1,o.length=0,l=!0;else if("o4"==T)o.length>1&&!l&&(c=o.shift()+a.nominalWidthX,l=!0),u&&t.U.P.closePath(i),h+=o.pop(),t.U.P.moveTo(i,d,h),u=!0;else if("o5"==T)for(;o.length>0;)d+=o.shift(),h+=o.shift(),t.U.P.lineTo(i,d,h);else if("o6"==T||"o7"==T)for(var k=o.length,E="o6"==T,M=0;M<k;M++){var C=o.shift();E?d+=C:h+=C,E=!E,t.U.P.lineTo(i,d,h)}else if("o8"==T||"o24"==T){k=o.length;for(var A=0;A+6<=k;)p=d+o.shift(),v=h+o.shift(),g=p+o.shift(),m=v+o.shift(),d=g+o.shift(),h=m+o.shift(),t.U.P.curveTo(i,p,v,g,m,d,h),A+=6;"o24"==T&&(d+=o.shift(),h+=o.shift(),t.U.P.lineTo(i,d,h))}else{if("o11"==T)break;if("o1234"==T||"o1235"==T||"o1236"==T||"o1237"==T)"o1234"==T&&(v=h,g=(p=d+o.shift())+o.shift(),_=m=v+o.shift(),b=m,x=h,d=(w=(y=(S=g+o.shift())+o.shift())+o.shift())+o.shift(),t.U.P.curveTo(i,p,v,g,m,S,_),t.U.P.curveTo(i,y,b,w,x,d,h)),"o1235"==T&&(p=d+o.shift(),v=h+o.shift(),g=p+o.shift(),m=v+o.shift(),S=g+o.shift(),_=m+o.shift(),y=S+o.shift(),b=_+o.shift(),w=y+o.shift(),x=b+o.shift(),d=w+o.shift(),h=x+o.shift(),o.shift(),t.U.P.curveTo(i,p,v,g,m,S,_),t.U.P.curveTo(i,y,b,w,x,d,h)),"o1236"==T&&(p=d+o.shift(),v=h+o.shift(),g=p+o.shift(),_=m=v+o.shift(),b=m,w=(y=(S=g+o.shift())+o.shift())+o.shift(),x=b+o.shift(),d=w+o.shift(),t.U.P.curveTo(i,p,v,g,m,S,_),t.U.P.curveTo(i,y,b,w,x,d,h)),"o1237"==T&&(p=d+o.shift(),v=h+o.shift(),g=p+o.shift(),m=v+o.shift(),S=g+o.shift(),_=m+o.shift(),y=S+o.shift(),b=_+o.shift(),w=y+o.shift(),x=b+o.shift(),Math.abs(w-d)>Math.abs(x-h)?d=w+o.shift():h=x+o.shift(),t.U.P.curveTo(i,p,v,g,m,S,_),t.U.P.curveTo(i,y,b,w,x,d,h));else if("o14"==T){if(o.length>0&&!l&&(c=o.shift()+n.nominalWidthX,l=!0),4==o.length){var F=o.shift(),P=o.shift(),O=o.shift(),I=o.shift(),R=t.CFF.glyphBySE(n,O),D=t.CFF.glyphBySE(n,I);t.U._drawCFF(n.CharStrings[R],r,n,a,i),r.x=F,r.y=P,t.U._drawCFF(n.CharStrings[D],r,n,a,i)}u&&(t.U.P.closePath(i),u=!1)}else if("o19"==T||"o20"==T)o.length%2!=0&&!l&&(c=o.shift()+a.nominalWidthX),s+=o.length>>1,o.length=0,l=!0,f+=s+7>>3;else if("o21"==T)o.length>2&&!l&&(c=o.shift()+a.nominalWidthX,l=!0),h+=o.pop(),d+=o.pop(),u&&t.U.P.closePath(i),t.U.P.moveTo(i,d,h),u=!0;else if("o22"==T)o.length>1&&!l&&(c=o.shift()+a.nominalWidthX,l=!0),d+=o.pop(),u&&t.U.P.closePath(i),t.U.P.moveTo(i,d,h),u=!0;else if("o25"==T){for(;o.length>6;)d+=o.shift(),h+=o.shift(),t.U.P.lineTo(i,d,h);p=d+o.shift(),v=h+o.shift(),g=p+o.shift(),m=v+o.shift(),d=g+o.shift(),h=m+o.shift(),t.U.P.curveTo(i,p,v,g,m,d,h)}else if("o26"==T)for(o.length%2&&(d+=o.shift());o.length>0;)p=d,v=h+o.shift(),d=g=p+o.shift(),h=(m=v+o.shift())+o.shift(),t.U.P.curveTo(i,p,v,g,m,d,h);else if("o27"==T)for(o.length%2&&(h+=o.shift());o.length>0;)v=h,g=(p=d+o.shift())+o.shift(),m=v+o.shift(),d=g+o.shift(),h=m,t.U.P.curveTo(i,p,v,g,m,d,h);else if("o10"==T||"o29"==T){var L="o10"==T?a:n;if(0==o.length);else{var B=o.pop(),G=L.Subrs[B+L.Bias];r.x=d,r.y=h,r.nStems=s,r.haveWidth=l,r.width=c,r.open=u,t.U._drawCFF(G,r,n,a,i),d=r.x,h=r.y,s=r.nStems,l=r.haveWidth,c=r.width,u=r.open}}else if("o30"==T||"o31"==T){var j=o.length,z=(A=0,"o31"==T);for(A+=j-(k=-3&j);A<k;)z?(v=h,g=(p=d+o.shift())+o.shift(),h=(m=v+o.shift())+o.shift(),k-A==5?(d=g+o.shift(),A++):d=g,z=!1):(p=d,v=h+o.shift(),g=p+o.shift(),m=v+o.shift(),d=g+o.shift(),k-A==5?(h=m+o.shift(),A++):h=m,z=!0),t.U.P.curveTo(i,p,v,g,m,d,h),A+=4}else{if("o"==(T+"").charAt(0))throw T;o.push(T)}}}r.x=d,r.y=h,r.nStems=s,r.haveWidth=l,r.width=c,r.open=u};var r=t,n={Typr:r};return e.Typr=r,e.default=n,Object.defineProperty(e,"__esModule",{value:!0}),e}({}).Typr},function(){return function(e){var t=Uint8Array,r=Uint16Array,n=Uint32Array,a=new t([0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0,0,0,0]),i=new t([0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13,0,0]),o=new t([16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15]),s=function(e,t){for(var a=new r(31),i=0;i<31;++i)a[i]=t+=1<<e[i-1];var o=new n(a[30]);for(i=1;i<30;++i)for(var s=a[i];s<a[i+1];++s)o[s]=s-a[i]<<5|i;return[a,o]},l=s(a,2),c=l[0],u=l[1];c[28]=258,u[258]=28;for(var f=s(i,0)[0],d=new r(32768),h=0;h<32768;++h){var p=(43690&h)>>>1|(21845&h)<<1;p=(61680&(p=(52428&p)>>>2|(13107&p)<<2))>>>4|(3855&p)<<4,d[h]=((65280&p)>>>8|(255&p)<<8)>>>1}var v=function(e,t,n){for(var a=e.length,i=0,o=new r(t);i<a;++i)++o[e[i]-1];var s,l=new r(t);for(i=0;i<t;++i)l[i]=l[i-1]+o[i-1]<<1;s=new r(1<<t);var c=15-t;for(i=0;i<a;++i)if(e[i])for(var u=i<<4|e[i],f=t-e[i],h=l[e[i]-1]++<<f,p=h|(1<<f)-1;h<=p;++h)s[d[h]>>>c]=u;return s},g=new t(288);for(h=0;h<144;++h)g[h]=8;for(h=144;h<256;++h)g[h]=9;for(h=256;h<280;++h)g[h]=7;for(h=280;h<288;++h)g[h]=8;var m=new t(32);for(h=0;h<32;++h)m[h]=5;var y=v(g,9),b=v(m,5),w=function(e){for(var t=e[0],r=1;r<e.length;++r)e[r]>t&&(t=e[r]);return t},x=function(e,t,r){var n=t/8|0;return(e[n]|e[n+1]<<8)>>(7&t)&r},S=function(e,t){var r=t/8|0;return(e[r]|e[r+1]<<8|e[r+2]<<16)>>(7&t)},_=["unexpected EOF","invalid block type","invalid length/literal","invalid distance","stream finished","no stream handler",,"no callback","invalid UTF-8 data","extra field too long","date not in range 1980-2099","filename too long","stream finishing","invalid zip data"],U=function(e,t,r){var n=new Error(t||_[e]);if(n.code=e,Error.captureStackTrace&&Error.captureStackTrace(n,U),!r)throw n;return n},T=new t(0),k="undefined"!=typeof TextDecoder&&new TextDecoder;try{k.decode(T,{stream:!0})}catch(E){}return e.convert_streams=function(e){var s=new DataView(e),l=0;function u(){var e=s.getUint16(l);return l+=2,e}function d(){var e=s.getUint32(l);return l+=4,e}function h(e){P.setUint16(O,e),O+=2}function p(e){P.setUint32(O,e),O+=4}for(var g={signature:d(),flavor:d(),length:d(),numTables:u(),reserved:u(),totalSfntSize:d(),majorVersion:u(),minorVersion:u(),metaOffset:d(),metaLength:d(),metaOrigLength:d(),privOffset:d(),privLength:d()},m=0;Math.pow(2,m)<=g.numTables;)m++;m--;for(var _=16*Math.pow(2,m),T=16*g.numTables-_,k=12,E=[],M=0;M<g.numTables;M++)E.push({tag:d(),offset:d(),compLength:d(),origLength:d(),origChecksum:d()}),k+=16;var C,A=new Uint8Array(12+16*E.length+E.reduce(function(e,t){return e+t.origLength+4},0)),F=A.buffer,P=new DataView(F),O=0;return p(g.flavor),h(g.numTables),h(_),h(m),h(T),E.forEach(function(e){p(e.tag),p(e.origChecksum),p(k),p(e.origLength),e.outOffset=k,(k+=e.origLength)%4!=0&&(k+=4-k%4)}),E.forEach(function(s){var l=e.slice(s.offset,s.offset+s.compLength);if(s.compLength!=s.origLength){var u=new Uint8Array(s.origLength);(function(e,s,l){var u=e.length;if(!u||l&&!l.l&&u<5)return s||new t(0);var d=!s||l,h=!l||l.i;l||(l={}),s||(s=new t(3*u));var p,g=function(e){var r=s.length;if(e>r){var n=new t(Math.max(2*r,e));n.set(s),s=n}},m=l.f||0,_=l.p||0,T=l.b||0,k=l.l,E=l.d,M=l.m,C=l.n,A=8*u;do{if(!k){l.f=m=x(e,_,1);var F=x(e,_+1,3);if(_+=3,!F){var P=e[(W=((p=_)/8|0)+(7&p&&1)+4)-4]|e[W-3]<<8,O=W+P;if(O>u){h&&U(0);break}d&&g(T+P),s.set(e.subarray(W,O),T),l.b=T+=P,l.p=_=8*O;continue}if(1==F)k=y,E=b,M=9,C=5;else if(2==F){var I=x(e,_,31)+257,R=x(e,_+10,15)+4,D=I+x(e,_+5,31)+1;_+=14;for(var L=new t(D),B=new t(19),G=0;G<R;++G)B[o[G]]=x(e,_+3*G,7);_+=3*R;var j=w(B),z=(1<<j)-1,N=v(B,j);for(G=0;G<D;){var W,H=N[x(e,_,z)];if(_+=15&H,(W=H>>>4)<16)L[G++]=W;else{var V=0,X=0;for(16==W?(X=3+x(e,_,3),_+=2,V=L[G-1]):17==W?(X=3+x(e,_,7),_+=3):18==W&&(X=11+x(e,_,127),_+=7);X--;)L[G++]=V}}var Y=L.subarray(0,I),q=L.subarray(I);M=w(Y),C=w(q),k=v(Y,M),E=v(q,C)}else U(1);if(_>A){h&&U(0);break}}d&&g(T+131072);for(var $=(1<<M)-1,Z=(1<<C)-1,K=_;;K=_){var Q=(V=k[S(e,_)&$])>>>4;if((_+=15&V)>A){h&&U(0);break}if(V||U(2),Q<256)s[T++]=Q;else{if(256==Q){K=_,k=null;break}var J=Q-254;if(Q>264){var ee=a[G=Q-257];J=x(e,_,(1<<ee)-1)+c[G],_+=ee}var te=E[S(e,_)&Z],re=te>>>4;if(te||U(3),_+=15&te,q=f[re],re>3&&(ee=i[re],q+=S(e,_)&(1<<ee)-1,_+=ee),_>A){h&&U(0);break}d&&g(T+131072);for(var ne=T+J;T<ne;T+=4)s[T]=s[T-q],s[T+1]=s[T+1-q],s[T+2]=s[T+2-q],s[T+3]=s[T+3-q];T=ne}}l.l=k,l.p=K,l.b=T,k&&(m=1,l.m=M,l.d=E,l.n=C)}while(!m);T==s.length||function(e,a,i){(null==i||i>e.length)&&(i=e.length);var o=new(e instanceof r?r:e instanceof n?n:t)(i-0);o.set(e.subarray(0,i))}(s,0,T)})(new Uint8Array(l,2),u)}else u=new Uint8Array(l);A.set(u,s.outOffset);var d=0;(k=s.outOffset+s.origLength)%4!=0&&(d=4-k%4),A.set(new Uint8Array(d).buffer,s.outOffset+s.origLength),C=k+d}),F.slice(0,C)},Object.defineProperty(e,"__esModule",{value:!0}),e}({}).convert_streams},function(e,t){const r={M:2,L:2,Q:4,C:6,Z:0},n={C:"18g,ca,368,1kz",D:"17k,6,2,2+4,5+c,2+6,2+1,10+1,9+f,j+11,2+1,a,2,2+1,15+2,3,j+2,6+3,2+8,2,2,2+1,w+a,4+e,3+3,2,3+2,3+5,23+w,2f+4,3,2+9,2,b,2+3,3,1k+9,6+1,3+1,2+2,2+d,30g,p+y,1,1+1g,f+x,2,sd2+1d,jf3+4,f+3,2+4,2+2,b+3,42,2,4+2,2+1,2,3,t+1,9f+w,2,el+2,2+g,d+2,2l,2+1,5,3+1,2+1,2,3,6,16wm+1v",R:"17m+3,2,2,6+3,m,15+2,2+2,h+h,13,3+8,2,2,3+1,2,p+1,x,5+4,5,a,2,2,3,u,c+2,g+1,5,2+1,4+1,5j,6+1,2,b,2+2,f,2+1,1s+2,2,3+1,7,1ez0,2,2+1,4+4,b,4,3,b,42,2+2,4,3,2+1,2,o+3,ae,ep,x,2o+2,3+1,3,5+1,6",L:"x9u,jff,a,fd,jv",T:"4t,gj+33,7o+4,1+1,7c+18,2,2+1,2+1,2,21+a,2,1b+k,h,2u+6,3+5,3+1,2+3,y,2,v+q,2k+a,1n+8,a,p+3,2+8,2+2,2+4,18+2,3c+e,2+v,1k,2,5+7,5,4+6,b+1,u,1n,5+3,9,l+1,r,3+1,1m,5+1,5+1,3+2,4,v+1,4,c+1,1m,5+4,2+1,5,l+1,n+5,2,1n,3,2+3,9,8+1,c+1,v,1q,d,1f,4,1m+2,6+2,2+3,8+1,c+1,u,1n,3,7,6+1,l+1,t+1,1m+1,5+3,9,l+1,u,21,8+2,2,2j,3+6,d+7,2r,3+8,c+5,23+1,s,2,2,1k+d,2+4,2+1,6+a,2+z,a,2v+3,2+5,2+1,3+1,q+1,5+2,h+3,e,3+1,7,g,jk+2,qb+2,u+2,u+1,v+1,1t+1,2+6,9,3+a,a,1a+2,3c+1,z,3b+2,5+1,a,7+2,64+1,3,1n,2+6,2,2,3+7,7+9,3,1d+d,1,1+1,1s+3,1d,2+4,2,6,15+8,d+1,x+3,3+1,2+2,1l,2+1,4,2+2,1n+7,3+1,49+2,2+c,2+6,5,7,4+1,5j+1l,2+4,ek,3+1,r+4,1e+4,6+5,2p+c,1+3,1,1+2,1+b,2db+2,3y,2p+v,ff+3,30+1,n9x,1+2,2+9,x+1,29+1,7l,4,5,q+1,6,48+1,r+h,e,13+7,q+a,1b+2,1d,3+3,3+1,14,1w+5,3+1,3+1,d,9,1c,1g,2+2,3+1,6+1,2,17+1,9,6n,3,5,fn5,ki+f,h+f,5s,6y+2,ea,6b,46+4,1af+2,2+1,6+3,15+2,5,4m+1,fy+3,as+1,4a+a,4x,1j+e,1l+2,1e+3,3+1,1y+2,11+4,2+7,1r,d+1,1h+8,b+3,3,2o+2,3,2+1,7,4h,4+7,m+1,1m+1,4,12+6,4+4,5g+7,3+2,2,o,2d+5,2,5+1,2+1,6n+3,7+1,2+1,s+1,2e+7,3,2+1,2z,2,3+5,2,2u+2,3+3,2+4,78+8,2+1,75+1,2,5,41+3,3+1,5,x+9,15+5,3+3,9,a+5,3+2,1b+c,2+1,bb+6,2+5,2,2b+l,3+6,2+1,2+1,3f+5,4,2+1,2+6,2,21+1,4,2,9o+1,470+8,at4+4,1o+6,t5,1s+3,2a,f5l+1,2+3,43o+2,a+7,1+7,3+6,v+3,45+2,1j0+1i,5+1d,9,f,n+4,2+e,11t+6,2+g,3+6,2+1,2+4,7a+6,c6+3,15t+6,32+6,1,gzau,v+2n,3l+6n"};let a;function i(e){if(!a){const e={R:2,L:1,D:4,C:16,U:32,T:8};a=new Map;for(let t in n){let r=0;n[t].split(",").forEach(n=>{let[i,o]=n.split("+");i=parseInt(i,36),o=o?parseInt(o,36):0,a.set(r+=i,e[t]);for(let s=o;s--;)a.set(++r,e[t])})}}return a.get(e)||32}const o=[null,"isol","init","fina","medi"];function s(e){const t=new Uint8Array(e.length);let r=32,n=1,a=-1;for(let o=0;o<e.length;o++){const s=e.codePointAt(o);let l=0|i(s),c=1;8&l||(21&r?22&l?(c=3,1!==n&&3!==n||t[a]++):33&l&&(2!==n&&4!==n||t[a]--):34&r&&(2!==n&&4!==n||t[a]--),n=t[o]=c,r=l,a=o,s>65535&&o++)}return t}function l(t,r){const n=t.GDEF&&t.GDEF.glyphClassDef;return n?e.U._getGlyphClass(r,n):0}function c(...e){for(let t=0;t<e.length;t++)if("number"==typeof e[t])return e[t]}function u(t){const n=Object.create(null),a=t["OS/2"],i=t.hhea,u=t.head.unitsPerEm,f=c(a&&a.sTypoAscender,i&&i.ascender,u),d={unitsPerEm:u,ascender:f,descender:c(a&&a.sTypoDescender,i&&i.descender,0),capHeight:c(a&&a.sCapHeight,f),xHeight:c(a&&a.sxHeight,f),lineGap:c(a&&a.sTypoLineGap,i&&i.lineGap),supportsCodePoint:r=>e.U.codeToGlyph(t,r)>0,forEachGlyph(a,i,c,u){let f=0;const h=1/d.unitsPerEm*i,p=function(t,r){const n=[];for(let i=0;i<r.length;i++){const a=r.codePointAt(i);a>65535&&i++,n.push(e.U.codeToGlyph(t,a))}const a=t.GSUB;if(a){const{lookupList:t,featureList:i}=a;let l;const c=/^(rlig|liga|mset|isol|init|fina|medi|half|pres|blws|ccmp)$/,u=[];i.forEach(a=>{if(c.test(a.tag))for(let i=0;i<a.tab.length;i++){if(u[a.tab[i]])continue;u[a.tab[i]]=!0;const c=t[a.tab[i]],f=/^(isol|init|fina|medi)$/.test(a.tag);f&&!l&&(l=s(r));for(let r=0;r<n.length;r++)l&&f&&o[l[r]]!==a.tag||e.U._applySubs(n,r,c,t)}})}return n}(t,a);let v=0;const g=function(t,r){const n=new Int16Array(3*r.length);let a=0;for(;a<r.length;a++){const c=r[a];if(-1===c)continue;n[3*a+2]=t.hmtx.aWidth[c];const u=t.GPOS;if(u){const f=u.lookupList;for(let u=0;u<f.length;u++){const d=f[u];for(let u=0;u<d.tabs.length;u++){const f=d.tabs[u];if(1===d.ltype){if(-1!==e._lctf.coverageIndex(f.coverage,c)&&f.pos){s(f.pos,a);break}}else if(2===d.ltype){let t=null,n=i();if(-1!==n){const i=e._lctf.coverageIndex(f.coverage,r[n]);if(-1!==i){if(1===f.fmt){const e=f.pairsets[i];for(let r=0;r<e.length;r++)e[r].gid2===c&&(t=e[r])}else if(2===f.fmt){const a=e.U._getGlyphClass(r[n],f.classDef1),i=e.U._getGlyphClass(c,f.classDef2);t=f.matrix[a][i]}if(t){t.val1&&s(t.val1,n),t.val2&&s(t.val2,a);break}}}}else if(4===d.ltype){const t=e._lctf.coverageIndex(f.markCoverage,c);if(-1!==t){const s=i(o),l=-1===s?-1:e._lctf.coverageIndex(f.baseCoverage,r[s]);if(-1!==l){const e=f.markArray[t],r=f.baseArray[l][e.markClass];n[3*a]=r.x-e.x+n[3*s]-n[3*s+2],n[3*a+1]=r.y-e.y+n[3*s+1];break}}}else if(6===d.ltype){const o=e._lctf.coverageIndex(f.mark1Coverage,c);if(-1!==o){const s=i();if(-1!==s){const i=r[s];if(3===l(t,i)){const t=e._lctf.coverageIndex(f.mark2Coverage,i);if(-1!==t){const e=f.mark1Array[o],r=f.mark2Array[t][e.markClass];n[3*a]=r.x-e.x+n[3*s]-n[3*s+2],n[3*a+1]=r.y-e.y+n[3*s+1];break}}}}}}}}else if(t.kern&&!t.cff){const e=i();if(-1!==e){const a=t.kern.glyph1.indexOf(r[e]);if(-1!==a){const r=t.kern.rval[a].glyph2.indexOf(c);-1!==r&&(n[3*e+2]+=t.kern.rval[a].vals[r])}}}}return n;function i(e){for(let t=a-1;t>=0;t--)if(-1!==r[t]&&(!e||e(r[t])))return t;return-1}function o(e){return 1===l(t,e)}function s(e,t){for(let r=0;r<3;r++)n[3*t+r]+=e[r]||0}}(t,p);return p.forEach((o,s)=>{if(-1!==o){let a=n[o];if(!a){const{cmds:i,crds:s}=e.U.glyphToPath(t,o);let l,c,u,f,d="",h=0;for(let e=0,t=i.length;e<t;e++){const t=r[i[e]];d+=i[e];for(let e=1;e<=t;e++)d+=(e>1?",":"")+s[h++]}if(s.length){l=c=1/0,u=f=-1/0;for(let e=0,t=s.length;e<t;e+=2){let t=s[e],r=s[e+1];t<l&&(l=t),r<c&&(c=r),t>u&&(u=t),r>f&&(f=r)}}else l=u=c=f=0;a=n[o]={index:o,advanceWidth:t.hmtx.aWidth[o],xMin:l,yMin:c,xMax:u,yMax:f,path:d}}u.call(null,a,f+g[3*s]*h,g[3*s+1]*h,v),f+=g[3*s+2]*h,c&&(f+=c*i)}v+=a.codePointAt(v)>65535?2:1}),f}};return d}return function(r){const n=new Uint8Array(r,0,4),a=e._bin.readASCII(n,0,4);if("wOFF"===a)r=t(r);else if("wOF2"===a)throw new Error("woff2 fonts not supported");return u(e.parse(r)[0])}}],init:(e,t,r)=>r(e(),t())});const qt=At({name:"FontResolver",dependencies:[function(e,t){const r=Object.create(null),n=Object.create(null);function a(t,a){let i=r[t];i?a(i):n[t]?n[t].push(a):(n[t]=[a],function(t,r){const n=e=>{};try{const a=new XMLHttpRequest;a.open("get",t,!0),a.responseType="arraybuffer",a.onload=function(){if(a.status>=400)new Error(a.statusText);else if(a.status>0)try{const n=e(a.response);n.src=t,r(n)}catch(Sn){}},a.onerror=n,a.send()}catch(a){}}(t,e=>{e.src=t,r[t]=e,n[t].forEach(t=>t(e)),delete n[t]}))}return function(e,n,{lang:i,fonts:o=[],style:s="normal",weight:l="normal",unicodeFontsURL:c}={}){const u=new Uint8Array(e.length),f=[];e.length||v();const d=new Map,h=[];if("italic"!==s&&(s="normal"),"number"!=typeof l&&(l="bold"===l?700:400),o&&!Array.isArray(o)&&(o=[o]),(o=o.slice().filter(e=>!e.lang||e.lang.test(i)).reverse()).length){const t=1,n=2;let i=0;!function s(l=0){for(let c=l,p=e.length;c<p;c++){const l=e.codePointAt(c);if(i===t&&f[u[c-1]].supportsCodePoint(l)||c>0&&/\s/.test(e[c]))u[c]=u[c-1],i===n&&(h[h.length-1][1]=c);else for(let e=u[c],p=o.length;e<=p;e++)if(e===p){(i===n?h[h.length-1]:h[h.length]=[c,c])[1]=c,i=n}else{u[c]=e;const{src:n,unicodeRange:h}=o[e];if(!h||g(l,h)){const e=r[n];if(!e)return void a(n,()=>{s(c)});if(e.supportsCodePoint(l)){let r=d.get(e);"number"!=typeof r&&(r=f.length,f.push(e),d.set(e,r)),u[c]=r,i=t;break}}}l>65535&&c+1<p&&(u[c+1]=u[c],c++,i===n&&(h[h.length-1][1]=c))}p()}()}else h.push([0,e.length-1]),p();function p(){if(h.length){const r=h.map(t=>e.substring(t[0],t[1]+1)).join("\n");t.getFontsForString(r,{lang:i||void 0,style:s,weight:l,dataUrl:c}).then(({fontUrls:e,chars:t})=>{const r=f.length;let n=0;h.forEach(e=>{for(let a=0,i=e[1]-e[0];a<=i;a++)u[e[0]+a]=t[n++]+r;n++});let i=0;e.forEach((t,n)=>{a(t,t=>{f[n+r]=t,++i===e.length&&v()})})})}else v()}function v(){n({chars:u,fonts:f})}function g(e,t){for(let r=0;r<t.length;r++){const[n,a=n]=t[r];if(n<=e&&e<=a)return!0}return!1}}},Yt,function(){return function(e){var t=function(){this.buckets=new Map};t.prototype.add=function(e){var t=e>>5;this.buckets.set(t,(this.buckets.get(t)||0)|1<<(31&e))},t.prototype.has=function(e){var t=this.buckets.get(e>>5);return void 0!==t&&!!(t&1<<(31&e))},t.prototype.serialize=function(){var e=[];return this.buckets.forEach(function(t,r){e.push((+r).toString(36)+":"+t.toString(36))}),e.join(",")},t.prototype.deserialize=function(e){var t=this;this.buckets.clear(),e.split(",").forEach(function(e){var r=e.split(":");t.buckets.set(parseInt(r[0],36),parseInt(r[1],36))})};var r=Math.pow(2,8),n=r-1,a=~n;function i(e,t){var r=e&n,a=t.codePointAt(r/6|0);return!!((a=(a||48)-48)&1<<r%6)}function o(e,t){!function(e,t){var r;(r=e,r.replace(/U\+/gi,"").replace(/^,+|,+$/g,"").split(/,+/).map(function(e){return e.split("-").map(function(e){return parseInt(e.trim(),16)})})).forEach(function(e){var r=e[0],n=e[1];void 0===n&&(n=r),t(r,n)})}(e,function(e,r){for(var n=e;n<=r;n++)t(n)})}var s={},l={},c=new WeakMap,u="https://cdn.jsdelivr.net/gh/lojjic/unicode-font-resolver@v1.0.1/packages/data";function f(e){var r=c.get(e);return r||(r=new t,o(e.ranges,function(e){return r.add(e)}),c.set(e,r)),r}var d,h=new Map;function p(e,t,r){return e[t]?t:e[r]?r:function(e){for(var t in e)return t}(e)}function v(e,t){var r=t;if(!e.includes(r)){r=1/0;for(var n=0;n<e.length;n++)Math.abs(e[n]-t)<Math.abs(r-t)&&(r=e[n])}return r}function g(e){return d||(d=new Set,o("9-D,20,85,A0,1680,2000-200A,2028-202F,205F,3000",function(e){d.add(e)})),d.has(e)}return e.CodePointSet=t,e.clearCache=function(){s={},l={}},e.getFontsForString=function(e,t){void 0===t&&(t={});var n,o=t.lang;void 0===o&&(o=new RegExp("\\p{Script=Hangul}","u").test(n=e)?"ko":new RegExp("\\p{Script=Hiragana}|\\p{Script=Katakana}","u").test(n)?"ja":"en");var c=t.category;void 0===c&&(c="sans-serif");var d=t.style;void 0===d&&(d="normal");var m=t.weight;void 0===m&&(m=400);var y=(t.dataUrl||u).replace(/\/$/g,""),b=new Map,w=new Uint8Array(e.length),x={},S={},_=new Array(e.length),U=new Map,T=!1;function k(e){var t=h.get(e);return t||(t=fetch(y+"/"+e).then(function(e){if(!e.ok)throw new Error(e.statusText);return e.json().then(function(e){if(!Array.isArray(e)||1!==e[0])throw new Error("Incorrect schema version; need 1, got "+e[0]);return e[1]})}).catch(function(t){if(y!==u)return T||(T=!0),y=u,h.delete(e),k(e);throw t}),h.set(e,t)),t}for(var E=function(t){var n=e.codePointAt(t),i=function(e){var t,n=(t=e,t&a).toString(16),i=function(e){return(e&a)+r-1}(e).toString(16);return"codepoint-index/plane"+(e>>16)+"/"+n+"-"+i+".json"}(n);_[t]=i,s[i]||U.has(i)||U.set(i,k(i).then(function(e){s[i]=e})),n>65535&&(t++,M=t)},M=0;M<e.length;M++)E(M);return Promise.all(U.values()).then(function(){U.clear();for(var t=function(t){var n=e.codePointAt(t),a=null,c=s[_[t]],u=void 0;for(var f in c){var d=S[f];if(void 0===d&&(d=S[f]=new RegExp(f).test(o||"en")),d){for(var h in u=f,c[f])if(i(n,c[f][h])){a=h;break}break}}if(!a)e:for(var p in c)if(p!==u)for(var v in c[p])if(i(n,c[p][v])){a=v;break e}a||(a="latin"),_[t]=a,l[a]||U.has(a)||U.set(a,k("font-meta/"+a+".json").then(function(e){l[a]=e})),n>65535&&(t++,r=t)},r=0;r<e.length;r++)t(r);return Promise.all(U.values())}).then(function(){for(var t,r=null,n=0;n<e.length;n++){var a=e.codePointAt(n);if(r&&(g(a)||f(r).has(a)))w[n]=w[n-1];else{r=l[_[n]];var i=x[r.id];if(!i){var o=r.typeforms,s=p(o,c,"sans-serif"),u=p(o[s],d,"normal"),h=v(null===(t=o[s])||void 0===t?void 0:t[u],m);i=x[r.id]=y+"/font-files/"+r.id+"/"+s+"."+u+"."+h+".woff"}var S=b.get(i);null==S&&(S=b.size,b.set(i,S)),w[n]=S}a>65535&&(n++,w[n]=w[n-1])}return{fontUrls:Array.from(b.keys()),chars:w}})},Object.defineProperty(e,"__esModule",{value:!0}),e}({})}],init:(e,t,r)=>e(t,r())});const $t=()=>(self.performance||Date).now(),Zt=Ot();let Kt;const Qt=[];let Jt=0;function er(){const e=$t();for(;Qt.length&&$t()-e<5;)Qt.shift()();Jt=Qt.length?setTimeout(er,0):0}const tr=(...e)=>new Promise((t,r)=>{Qt.push(()=>{const n=$t();try{Zt.webgl.generateIntoCanvas(...e),t({timing:$t()-n})}catch(a){r(a)}}),Jt||(Jt=setTimeout(er,0))}),rr=4,nr=2e3,ar={};let ir=0;function or(e,t,r,n,a,i,o,s,l,c){const u="TroikaTextSDFGenerator_JS_"+ir++%rr;let f=ar[u];return f||(f=ar[u]={workerModule:At({name:u,workerId:u,dependencies:[Ot,$t],init(e,t){const r=e().javascript.generate;return function(...e){const n=t();return{textureData:r(...e),timing:t()-n}}},getTransferables:e=>[e.textureData.buffer]}),requests:0,idleTimer:null}),f.requests++,clearTimeout(f.idleTimer),f.workerModule(e,t,r,n,a,i).then(({textureData:r,timing:n})=>{const a=$t(),i=new Uint8Array(4*r.length);for(let e=0;e<r.length;e++)i[4*e+c]=r[e];return Zt.webglUtils.renderImageData(o,i,s,l,e,t,1<<3-c),n+=$t()-a,0===--f.requests&&(f.idleTimer=setTimeout(()=>{!function(e){Mt[e]&&Mt[e].forEach(function(e){e()}),Et[e]&&(Et[e].terminate(),delete Et[e])}(u)},nr)),{timing:n}})}const sr=Zt.webglUtils.resizeWebGLCanvasWithoutClearing,lr={unicodeFontsURL:null,sdfGlyphSize:64,sdfMargin:1/16,sdfExponent:9,textureWidth:2048},cr=new F;function ur(){return(self.performance||Date).now()}const fr=Object.create(null);function dr(e,t){e=function(e,t){for(let r in t)t.hasOwnProperty(r)&&(e[r]=t[r]);return e}({},e);const r=ur(),n=[];if(e.font&&n.push({label:"user",src:vr(e.font)}),e.font=n,e.text=""+e.text,e.sdfGlyphSize=e.sdfGlyphSize||lr.sdfGlyphSize,e.unicodeFontsURL=e.unicodeFontsURL||lr.unicodeFontsURL,null!=e.colorRanges){let t={};for(let r in e.colorRanges)if(e.colorRanges.hasOwnProperty(r)){let n=e.colorRanges[r];"number"!=typeof n&&(n=cr.set(n).getHex()),t[r]=n}e.colorRanges=t}Object.freeze(e);const{textureWidth:a,sdfExponent:i}=lr,{sdfGlyphSize:o}=e,s=a/o*4;let l=fr[o];if(!l){const e=document.createElement("canvas");e.width=a,e.height=256*o/s,l=fr[o]={glyphCount:0,sdfGlyphSize:o,sdfCanvas:e,sdfTexture:new L(e,void 0,void 0,void 0,S,S),contextLost:!1,glyphsByFont:new Map},l.sdfTexture.generateMipmaps=!1,function(e){const t=e.sdfCanvas;t.addEventListener("webglcontextlost",t=>{t.preventDefault(),e.contextLost=!0}),t.addEventListener("webglcontextrestored",t=>{e.contextLost=!1;const r=[];e.glyphsByFont.forEach(t=>{t.forEach(t=>{r.push(hr(t,e,!0))})}),Promise.all(r).then(()=>{gr(e),e.sdfTexture.needsUpdate=!0})})}(l)}const{sdfTexture:c,sdfCanvas:u}=l;yr(e).then(n=>{const{glyphIds:f,glyphFontIndices:d,fontData:h,glyphPositions:p,fontSize:v,timings:g}=n,m=[],y=new Float32Array(4*f.length);let b=0,w=0;const x=ur(),S=h.map(e=>{let t=l.glyphsByFont.get(e.src);return t||l.glyphsByFont.set(e.src,t=new Map),t});f.forEach((e,t)=>{const r=d[t],{src:a,unitsPerEm:i}=h[r];let s=S[r].get(e);if(!s){const{path:t,pathBounds:i}=n.glyphData[a][e],c=Math.max(i[2]-i[0],i[3]-i[1])/o*(lr.sdfMargin*o+.5),u=l.glyphCount++,f=[i[0]-c,i[1]-c,i[2]+c,i[3]+c];S[r].set(e,s={path:t,atlasIndex:u,sdfViewBox:f}),m.push(s)}const{sdfViewBox:c}=s,u=p[w++],g=p[w++],x=v/i;y[b++]=u+c[0]*x,y[b++]=g+c[1]*x,y[b++]=u+c[2]*x,y[b++]=g+c[3]*x,f[t]=s.atlasIndex}),g.quads=(g.quads||0)+(ur()-x);const _=ur();g.sdf={};const U=u.height,T=Math.ceil(l.glyphCount/s),k=Math.pow(2,Math.ceil(Math.log2(T*o)));k>U&&(sr(u,a,k),c.dispose()),Promise.all(m.map(t=>hr(t,l,e.gpuAccelerateSDF).then(({timing:e})=>{g.sdf[t.atlasIndex]=e}))).then(()=>{m.length&&!l.contextLost&&(gr(l),c.needsUpdate=!0),g.sdfTotal=ur()-_,g.total=ur()-r,t(Object.freeze({parameters:e,sdfTexture:c,sdfGlyphSize:o,sdfExponent:i,glyphBounds:y,glyphAtlasIndices:f,glyphColors:n.glyphColors,caretPositions:n.caretPositions,chunkedBounds:n.chunkedBounds,ascender:n.ascender,descender:n.descender,lineHeight:n.lineHeight,capHeight:n.capHeight,xHeight:n.xHeight,topBaseline:n.topBaseline,blockBounds:n.blockBounds,visibleBounds:n.visibleBounds,timings:n.timings}))})}),Promise.resolve().then(()=>{var e;l.contextLost||(e=u)._warm||(Zt.webgl.isSupported(e),e._warm=!0)})}function hr({path:e,atlasIndex:t,sdfViewBox:r},{sdfGlyphSize:n,sdfCanvas:a,contextLost:i},o){if(i)return Promise.resolve({timing:-1});const{textureWidth:s,sdfExponent:l}=lr,c=Math.max(r[2]-r[0],r[3]-r[1]),u=Math.floor(t/4);return function(e,t,r,n,a,i,o,s,l,c,u=!0){return u?tr(e,t,r,n,a,i,o,s,l,c).then(null,u=>(Kt||(Kt=!0),or(e,t,r,n,a,i,o,s,l,c))):or(e,t,r,n,a,i,o,s,l,c)}(n,n,e,r,c,l,a,u%(s/n)*n,Math.floor(u/(s/n))*n,t%4,o)}let pr;function vr(e){return pr||(pr="undefined"==typeof document?{}:document.createElement("a")),pr.href=e,pr.href}function gr(e){if("function"!=typeof createImageBitmap){const{sdfCanvas:t,sdfTexture:r}=e,{width:n,height:a}=t,i=e.sdfCanvas.getContext("webgl");let o=r.image.data;o&&o.length===n*a*4||(o=new Uint8Array(n*a*4),r.image={width:n,height:a,data:o},r.flipY=!1,r.isDataTexture=!0),i.readPixels(0,0,n,a,i.RGBA,i.UNSIGNED_BYTE,o)}}const mr=At({name:"Typesetter",dependencies:[function(e,t){const r=1/0,n=/[\u00AD\u034F\u061C\u115F-\u1160\u17B4-\u17B5\u180B-\u180E\u200B-\u200F\u202A-\u202E\u2060-\u206F\u3164\uFE00-\uFE0F\uFEFF\uFFA0\uFFF0-\uFFF8]/,a="[^\\S\\u00A0]",i=new RegExp(`${a}|[\\-\\u007C\\u00AD\\u2010\\u2012-\\u2014\\u2027\\u2056\\u2E17\\u2E40]`);function o({text:o="",font:f,lang:d,sdfGlyphSize:h=64,fontSize:p=400,fontWeight:v=1,fontStyle:g="normal",letterSpacing:m=0,lineHeight:y="normal",maxWidth:b=r,direction:w,textAlign:x="left",textIndent:S=0,whiteSpace:_="normal",overflowWrap:U="normal",anchorX:T=0,anchorY:k=0,metricsOnly:E=!1,unicodeFontsURL:M,preResolvedFonts:C=null,includeCaretPositions:A=!1,chunkedBoundsSize:F=8192,colorRanges:P=null},O){const I=c(),R={fontLoad:0,typesetting:0};o.indexOf("\r")>-1&&(o=o.replace(/\r\n/g,"\n").replace(/\r/g,"\n")),p=+p,m=+m,b=+b,y=y||"normal",S=+S,function({text:t,lang:r,fonts:n,style:a,weight:i,preResolvedFonts:o,unicodeFontsURL:s},l){const c=({chars:e,fonts:t})=>{let r,n;const a=[];for(let i=0;i<e.length;i++)e[i]!==n?(n=e[i],a.push(r={start:i,end:i,fontObj:t[e[i]]})):r.end=i;l(a)};o?c(o):e(t,c,{lang:r,fonts:n,style:a,weight:i,unicodeFontsURL:s})}({text:o,lang:d,style:g,weight:v,fonts:"string"==typeof f?[{src:f}]:f,unicodeFontsURL:M,preResolvedFonts:C},e=>{R.fontLoad=c()-I;const f=isFinite(b);let d=null,h=null,v=null,g=null,M=null,C=null,D=null,L=null,B=0,G=0,j="nowrap"!==_;const z=new Map,N=c();let W=S,H=0,V=new u;const X=[V];e.forEach(e=>{const{fontObj:t}=e,{ascender:r,descender:s,unitsPerEm:l,lineGap:c,capHeight:d,xHeight:h}=t;let v=z.get(t);if(!v){const e=p/l,n="normal"===y?(r-s+c)*e:y*p,a=(n-(r-s)*e)/2,i=Math.min(n,(r-s)*e),o=(r+s)/2*e+i/2;v={index:z.size,src:t.src,fontObj:t,fontSizeMult:e,unitsPerEm:l,ascender:r*e,descender:s*e,capHeight:d*e,xHeight:h*e,lineHeight:n,baseline:-a-r*e,caretTop:o,caretBottom:o-i},z.set(t,v)}const{fontSizeMult:g}=v,w=o.slice(e.start,e.end+1);let x,_;t.forEachGlyph(w,p,m,(t,r,s,l)=>{r+=H,l+=e.start,x=r,_=t;const c=o.charAt(l),d=t.advanceWidth*g,h=V.count;let y;if("isEmpty"in t||(t.isWhitespace=!!c&&new RegExp(a).test(c),t.canBreakAfter=!!c&&i.test(c),t.isEmpty=t.xMin===t.xMax||t.yMin===t.yMax||n.test(c)),t.isWhitespace||t.isEmpty||G++,j&&f&&!t.isWhitespace&&r+d+W>b&&h){if(V.glyphAt(h-1).glyphObj.canBreakAfter)y=new u,W=-r;else for(let e=h;e--;){if(0===e&&"break-word"===U){y=new u,W=-r;break}if(V.glyphAt(e).glyphObj.canBreakAfter){y=V.splitAt(e+1);const t=y.glyphAt(0).x;W-=t;for(let e=y.count;e--;)y.glyphAt(e).x-=t;break}}y&&(V.isSoftWrapped=!0,V=y,X.push(V),B=b)}let w=V.glyphAt(V.count);w.glyphObj=t,w.x=r+W,w.y=s,w.width=d,w.charIndex=l,w.fontData=v,"\n"===c&&(V=new u,X.push(V),W=-(r+d+m*p)+S)}),H=x+_.advanceWidth*g+m*p});let Y=0;X.forEach(e=>{let t=!0;for(let r=e.count;r--;){const n=e.glyphAt(r);t&&!n.glyphObj.isWhitespace&&(e.width=n.x+n.width,e.width>B&&(B=e.width),t=!1);let{lineHeight:a,capHeight:i,xHeight:o,baseline:s}=n.fontData;a>e.lineHeight&&(e.lineHeight=a);const l=s-e.baseline;l<0&&(e.baseline+=l,e.cap+=l,e.ex+=l),e.cap=Math.max(e.cap,e.baseline+i),e.ex=Math.max(e.ex,e.baseline+o)}e.baseline-=Y,e.cap-=Y,e.ex-=Y,Y+=e.lineHeight});let q=0,$=0;if(T&&("number"==typeof T?q=-T:"string"==typeof T&&(q=-B*("left"===T?0:"center"===T?.5:"right"===T?1:s(T)))),k&&("number"==typeof k?$=-k:"string"==typeof k&&($="top"===k?0:"top-baseline"===k?-X[0].baseline:"top-cap"===k?-X[0].cap:"top-ex"===k?-X[0].ex:"middle"===k?Y/2:"bottom"===k?Y:"bottom-baseline"===k?-X[X.length-1].baseline:s(k)*Y)),!E){const e=t.getEmbeddingLevels(o,w);d=new Uint16Array(G),h=new Uint8Array(G),v=new Float32Array(2*G),g={},D=[r,r,-1/0,-1/0],L=[],A&&(C=new Float32Array(4*o.length)),P&&(M=new Uint8Array(3*G));let n,a,i=0,s=-1,c=-1;if(X.forEach((u,f)=>{let{count:p,width:m}=u;if(p>0){let f=0;for(let e=p;e--&&u.glyphAt(e).glyphObj.isWhitespace;)f++;let y=0,b=0;if("center"===x)y=(B-m)/2;else if("right"===x)y=B-m;else if("justify"===x&&u.isSoftWrapped){let e=0;for(let t=p-f;t--;)u.glyphAt(t).glyphObj.isWhitespace&&e++;b=(B-m)/e}if(b||y){let e=0;for(let t=0;t<p;t++){let r=u.glyphAt(t);const n=r.glyphObj;r.x+=y+e,0!==b&&n.isWhitespace&&t<p-f&&(e+=b,r.width+=b)}}const w=t.getReorderSegments(o,e,u.glyphAt(0).charIndex,u.glyphAt(u.count-1).charIndex);for(let e=0;e<w.length;e++){const[t,r]=w[e];let n=1/0,a=-1/0;for(let e=0;e<p;e++)if(u.glyphAt(e).charIndex>=t){let t=e,i=e;for(;i<p;i++){let e=u.glyphAt(i);if(e.charIndex>r)break;i<p-f&&(n=Math.min(n,e.x),a=Math.max(a,e.x+e.width))}for(let e=t;e<i;e++){const t=u.glyphAt(e);t.x=a-(t.x+t.width-n)}break}}let S;const _=e=>S=e;for(let m=0;m<p;m++){const f=u.glyphAt(m);S=f.glyphObj;const p=S.index,y=1&e.levels[f.charIndex];if(y){const e=t.getMirroredCharacter(o[f.charIndex]);e&&f.fontData.fontObj.forEachGlyph(e,0,0,_)}if(A){const{charIndex:e,fontData:t}=f,r=f.x+q,n=f.x+f.width+q;C[4*e]=y?n:r,C[4*e+1]=y?r:n,C[4*e+2]=u.baseline+t.caretBottom+$,C[4*e+3]=u.baseline+t.caretTop+$;const a=e-s;a>1&&l(C,s,a),s=e}if(P){const{charIndex:e}=f;for(;e>c;)c++,P.hasOwnProperty(c)&&(a=P[c])}if(!S.isWhitespace&&!S.isEmpty){const e=i++,{fontSizeMult:t,src:o,index:s}=f.fontData,l=g[o]||(g[o]={});l[p]||(l[p]={path:S.path,pathBounds:[S.xMin,S.yMin,S.xMax,S.yMax]});const c=f.x+q,m=f.y+u.baseline+$;v[2*e]=c,v[2*e+1]=m;const y=c+S.xMin*t,b=m+S.yMin*t,w=c+S.xMax*t,x=m+S.yMax*t;y<D[0]&&(D[0]=y),b<D[1]&&(D[1]=b),w>D[2]&&(D[2]=w),x>D[3]&&(D[3]=x),e%F===0&&(n={start:e,end:e,rect:[r,r,-1/0,-1/0]},L.push(n)),n.end++;const _=n.rect;if(y<_[0]&&(_[0]=y),b<_[1]&&(_[1]=b),w>_[2]&&(_[2]=w),x>_[3]&&(_[3]=x),d[e]=p,h[e]=s,P){const t=3*e;M[t]=a>>16&255,M[t+1]=a>>8&255,M[t+2]=255&a}}}}}),C){const e=o.length-s;e>1&&l(C,s,e)}}const Z=[];z.forEach(({index:e,src:t,unitsPerEm:r,ascender:n,descender:a,lineHeight:i,capHeight:o,xHeight:s})=>{Z[e]={src:t,unitsPerEm:r,ascender:n,descender:a,lineHeight:i,capHeight:o,xHeight:s}}),R.typesetting=c()-N,O({glyphIds:d,glyphFontIndices:h,glyphPositions:v,glyphData:g,fontData:Z,caretPositions:C,glyphColors:M,chunkedBounds:L,fontSize:p,topBaseline:$+X[0].baseline,blockBounds:[q,$-Y,q+B,$],visibleBounds:D,timings:R})})}function s(e){let t=e.match(/^([\d.]+)%$/),r=t?parseFloat(t[1]):NaN;return isNaN(r)?0:r/100}function l(e,t,r){const n=e[4*t],a=e[4*t+1],i=e[4*t+2],o=e[4*t+3],s=(a-n)/r;for(let l=0;l<r;l++){const r=4*(t+l);e[r]=n+s*l,e[r+1]=n+s*(l+1),e[r+2]=i,e[r+3]=o}}function c(){return(self.performance||Date).now()}function u(){this.data=[]}const f=["glyphObj","x","y","width","charIndex","fontData"];return u.prototype={width:0,lineHeight:0,baseline:0,cap:0,ex:0,isSoftWrapped:!1,get count(){return Math.ceil(this.data.length/f.length)},glyphAt(e){let t=u.flyweight;return t.data=this.data,t.index=e,t},splitAt(e){let t=new u;return t.data=this.data.splice(e*f.length),t}},u.flyweight=f.reduce((e,t,r,n)=>(Object.defineProperty(e,t,{get(){return this.data[this.index*f.length+r]},set(e){this.data[this.index*f.length+r]=e}}),e),{data:null,index:0}),{typeset:o,measure:function(e,t){o({...e,metricsOnly:!0},e=>{const[r,n,a,i]=e.blockBounds;t({width:a-r,height:i-n})})}}},qt,function(){var e=function(e){var t={R:"13k,1a,2,3,3,2+1j,ch+16,a+1,5+2,2+n,5,a,4,6+16,4+3,h+1b,4mo,179q,2+9,2+11,2i9+7y,2+68,4,3+4,5+13,4+3,2+4k,3+29,8+cf,1t+7z,w+17,3+3m,1t+3z,16o1+5r,8+30,8+mc,29+1r,29+4v,75+73",EN:"1c+9,3d+1,6,187+9,513,4+5,7+9,sf+j,175h+9,qw+q,161f+1d,4xt+a,25i+9",ES:"17,2,6dp+1,f+1,av,16vr,mx+1,4o,2",ET:"z+2,3h+3,b+1,ym,3e+1,2o,p4+1,8,6u,7c,g6,1wc,1n9+4,30+1b,2n,6d,qhx+1,h0m,a+1,49+2,63+1,4+1,6bb+3,12jj",AN:"16o+5,2j+9,2+1,35,ed,1ff2+9,87+u",CS:"18,2+1,b,2u,12k,55v,l,17v0,2,3,53,2+1,b",B:"a,3,f+2,2v,690",S:"9,2,k",WS:"c,k,4f4,1vk+a,u,1j,335",ON:"x+1,4+4,h+5,r+5,r+3,z,5+3,2+1,2+1,5,2+2,3+4,o,w,ci+1,8+d,3+d,6+8,2+g,39+1,9,6+1,2,33,b8,3+1,3c+1,7+1,5r,b,7h+3,sa+5,2,3i+6,jg+3,ur+9,2v,ij+1,9g+9,7+a,8m,4+1,49+x,14u,2+2,c+2,e+2,e+2,e+1,i+n,e+e,2+p,u+2,e+2,36+1,2+3,2+1,b,2+2,6+5,2,2,2,h+1,5+4,6+3,3+f,16+2,5+3l,3+81,1y+p,2+40,q+a,m+13,2r+ch,2+9e,75+hf,3+v,2+2w,6e+5,f+6,75+2a,1a+p,2+2g,d+5x,r+b,6+3,4+o,g,6+1,6+2,2k+1,4,2j,5h+z,1m+1,1e+f,t+2,1f+e,d+3,4o+3,2s+1,w,535+1r,h3l+1i,93+2,2s,b+1,3l+x,2v,4g+3,21+3,kz+1,g5v+1,5a,j+9,n+v,2,3,2+8,2+1,3+2,2,3,46+1,4+4,h+5,r+5,r+a,3h+2,4+6,b+4,78,1r+24,4+c,4,1hb,ey+6,103+j,16j+c,1ux+7,5+g,fsh,jdq+1t,4,57+2e,p1,1m,1m,1m,1m,4kt+1,7j+17,5+2r,d+e,3+e,2+e,2+10,m+4,w,1n+5,1q,4z+5,4b+rb,9+c,4+c,4+37,d+2g,8+b,l+b,5+1j,9+9,7+13,9+t,3+1,27+3c,2+29,2+3q,d+d,3+4,4+2,6+6,a+o,8+6,a+2,e+6,16+42,2+1i",BN:"0+8,6+d,2s+5,2+p,e,4m9,1kt+2,2b+5,5+5,17q9+v,7k,6p+8,6+1,119d+3,440+7,96s+1,1ekf+1,1ekf+1,1ekf+1,1ekf+1,1ekf+1,1ekf+1,1ekf+1,1ekf+1,1ekf+1,1ekf+1,1ekf+1,1ekf+75,6p+2rz,1ben+1,1ekf+1,1ekf+1",NSM:"lc+33,7o+6,7c+18,2,2+1,2+1,2,21+a,1d+k,h,2u+6,3+5,3+1,2+3,10,v+q,2k+a,1n+8,a,p+3,2+8,2+2,2+4,18+2,3c+e,2+v,1k,2,5+7,5,4+6,b+1,u,1n,5+3,9,l+1,r,3+1,1m,5+1,5+1,3+2,4,v+1,4,c+1,1m,5+4,2+1,5,l+1,n+5,2,1n,3,2+3,9,8+1,c+1,v,1q,d,1f,4,1m+2,6+2,2+3,8+1,c+1,u,1n,g+1,l+1,t+1,1m+1,5+3,9,l+1,u,21,8+2,2,2j,3+6,d+7,2r,3+8,c+5,23+1,s,2,2,1k+d,2+4,2+1,6+a,2+z,a,2v+3,2+5,2+1,3+1,q+1,5+2,h+3,e,3+1,7,g,jk+2,qb+2,u+2,u+1,v+1,1t+1,2+6,9,3+a,a,1a+2,3c+1,z,3b+2,5+1,a,7+2,64+1,3,1n,2+6,2,2,3+7,7+9,3,1d+g,1s+3,1d,2+4,2,6,15+8,d+1,x+3,3+1,2+2,1l,2+1,4,2+2,1n+7,3+1,49+2,2+c,2+6,5,7,4+1,5j+1l,2+4,k1+w,2db+2,3y,2p+v,ff+3,30+1,n9x+3,2+9,x+1,29+1,7l,4,5,q+1,6,48+1,r+h,e,13+7,q+a,1b+2,1d,3+3,3+1,14,1w+5,3+1,3+1,d,9,1c,1g,2+2,3+1,6+1,2,17+1,9,6n,3,5,fn5,ki+f,h+f,r2,6b,46+4,1af+2,2+1,6+3,15+2,5,4m+1,fy+3,as+1,4a+a,4x,1j+e,1l+2,1e+3,3+1,1y+2,11+4,2+7,1r,d+1,1h+8,b+3,3,2o+2,3,2+1,7,4h,4+7,m+1,1m+1,4,12+6,4+4,5g+7,3+2,2,o,2d+5,2,5+1,2+1,6n+3,7+1,2+1,s+1,2e+7,3,2+1,2z,2,3+5,2,2u+2,3+3,2+4,78+8,2+1,75+1,2,5,41+3,3+1,5,x+5,3+1,15+5,3+3,9,a+5,3+2,1b+c,2+1,bb+6,2+5,2d+l,3+6,2+1,2+1,3f+5,4,2+1,2+6,2,21+1,4,2,9o+1,f0c+4,1o+6,t5,1s+3,2a,f5l+1,43t+2,i+7,3+6,v+3,45+2,1j0+1i,5+1d,9,f,n+4,2+e,11t+6,2+g,3+6,2+1,2+4,7a+6,c6+3,15t+6,32+6,gzhy+6n",AL:"16w,3,2,e+1b,z+2,2+2s,g+1,8+1,b+m,2+t,s+2i,c+e,4h+f,1d+1e,1bwe+dp,3+3z,x+c,2+1,35+3y,2rm+z,5+7,b+5,dt+l,c+u,17nl+27,1t+27,4x+6n,3+d",LRO:"6ct",RLO:"6cu",LRE:"6cq",RLE:"6cr",PDF:"6cs",LRI:"6ee",RLI:"6ef",FSI:"6eg",PDI:"6eh"},r={},n={};r.L=1,n[1]="L",Object.keys(t).forEach(function(e,t){r[e]=1<<t+1,n[r[e]]=e}),Object.freeze(r);var a=r.LRI|r.RLI|r.FSI,i=r.L|r.R|r.AL,o=r.B|r.S|r.WS|r.ON|r.FSI|r.LRI|r.RLI|r.PDI,s=r.BN|r.RLE|r.LRE|r.RLO|r.LRO|r.PDF,l=r.S|r.WS|r.B|a|r.PDI|s,c=null;function u(e){return function(){if(!c){c=new Map;var e=function(e){if(t.hasOwnProperty(e)){var n=0;t[e].split(",").forEach(function(t){var a=t.split("+"),i=a[0],o=a[1];i=parseInt(i,36),o=o?parseInt(o,36):0,c.set(n+=i,r[e]);for(var s=0;s<o;s++)c.set(++n,r[e])})}};for(var n in t)e(n)}}(),c.get(e.codePointAt(0))||r.L}var f,d,h,p="14>1,1e>2,u>2,2wt>1,1>1,1ge>1,1wp>1,1j>1,f>1,hm>1,1>1,u>1,u6>1,1>1,+5,28>1,w>1,1>1,+3,b8>1,1>1,+3,1>3,-1>-1,3>1,1>1,+2,1s>1,1>1,x>1,th>1,1>1,+2,db>1,1>1,+3,3>1,1>1,+2,14qm>1,1>1,+1,4q>1,1e>2,u>2,2>1,+1",v="6f1>-6dx,6dy>-6dx,6ec>-6ed,6ee>-6ed,6ww>2jj,-2ji>2jj,14r4>-1e7l,1e7m>-1e7l,1e7m>-1e5c,1e5d>-1e5b,1e5c>-14qx,14qy>-14qx,14vn>-1ecg,1ech>-1ecg,1edu>-1ecg,1eci>-1ecg,1eda>-1ecg,1eci>-1ecg,1eci>-168q,168r>-168q,168s>-14ye,14yf>-14ye";function g(e,t){var r,n=0,a=new Map,i=t&&new Map;return e.split(",").forEach(function e(o){if(-1!==o.indexOf("+"))for(var s=+o;s--;)e(r);else{r=o;var l=o.split(">"),c=l[0],u=l[1];c=String.fromCodePoint(n+=parseInt(c,36)),u=String.fromCodePoint(n+=parseInt(u,36)),a.set(c,u),t&&i.set(u,c)}}),{map:a,reverseMap:i}}function m(){if(!f){var e=g(p,!0),t=e.map,r=e.reverseMap;f=t,d=r,h=g(v,!1).map}}function y(e){return m(),f.get(e)||null}function b(e){return m(),d.get(e)||null}function w(e){return m(),h.get(e)||null}var x=r.L,S=r.R,_=r.EN,U=r.ES,T=r.ET,k=r.AN,E=r.CS,M=r.B,C=r.S,A=r.ON,F=r.BN,P=r.NSM,O=r.AL,I=r.LRO,R=r.RLO,D=r.LRE,L=r.RLE,B=r.PDF,G=r.LRI,j=r.RLI,z=r.FSI,N=r.PDI;var W;function H(e){return function(){if(!W){var e=g("14>1,j>2,t>2,u>2,1a>g,2v3>1,1>1,1ge>1,1wd>1,b>1,1j>1,f>1,ai>3,-2>3,+1,8>1k0,-1jq>1y7,-1y6>1hf,-1he>1h6,-1h5>1ha,-1h8>1qi,-1pu>1,6>3u,-3s>7,6>1,1>1,f>1,1>1,+2,3>1,1>1,+13,4>1,1>1,6>1eo,-1ee>1,3>1mg,-1me>1mk,-1mj>1mi,-1mg>1mi,-1md>1,1>1,+2,1>10k,-103>1,1>1,4>1,5>1,1>1,+10,3>1,1>8,-7>8,+1,-6>7,+1,a>1,1>1,u>1,u6>1,1>1,+5,26>1,1>1,2>1,2>2,8>1,7>1,4>1,1>1,+5,b8>1,1>1,+3,1>3,-2>1,2>1,1>1,+2,c>1,3>1,1>1,+2,h>1,3>1,a>1,1>1,2>1,3>1,1>1,d>1,f>1,3>1,1a>1,1>1,6>1,7>1,13>1,k>1,1>1,+19,4>1,1>1,+2,2>1,1>1,+18,m>1,a>1,1>1,lk>1,1>1,4>1,2>1,f>1,3>1,1>1,+3,db>1,1>1,+3,3>1,1>1,+2,14qm>1,1>1,+1,6>1,4j>1,j>2,t>2,u>2,2>1,+1",!0),t=e.map;e.reverseMap.forEach(function(e,r){t.set(r,e)}),W=t}}(),W.get(e)||null}function V(e,t,r,n){var a=e.length;r=Math.max(0,null==r?0:+r),n=Math.min(a-1,null==n?a-1:+n);var i=[];return t.paragraphs.forEach(function(a){var o=Math.max(r,a.start),s=Math.min(n,a.end);if(o<s){for(var c=t.levels.slice(o,s+1),f=s;f>=o&&u(e[f])&l;f--)c[f]=a.level;for(var d=a.level,h=1/0,p=0;p<c.length;p++){var v=c[p];v>d&&(d=v),v<h&&(h=1|v)}for(var g=d;g>=h;g--)for(var m=0;m<c.length;m++)if(c[m]>=g){for(var y=m;m+1<c.length&&c[m+1]>=g;)m++;m>y&&i.push([y+o,m+o])}}}),i}function X(e,t,r,n){for(var a=V(e,t,r,n),i=[],o=0;o<e.length;o++)i[o]=o;return a.forEach(function(e){for(var t=e[0],r=e[1],n=i.slice(t,r+1),a=n.length;a--;)i[r-a]=n[a]}),i}return e.closingToOpeningBracket=b,e.getBidiCharType=u,e.getBidiCharTypeName=function(e){return n[u(e)]},e.getCanonicalBracket=w,e.getEmbeddingLevels=function(e,t){for(var r=new Uint32Array(e.length),n=0;n<e.length;n++)r[n]=u(e[n]);var c=new Map;function f(e,t){var n=r[e];r[e]=t,c.set(n,c.get(n)-1),n&o&&c.set(o,c.get(o)-1),c.set(t,(c.get(t)||0)+1),t&o&&c.set(o,(c.get(o)||0)+1)}for(var d=new Uint8Array(e.length),h=new Map,p=[],v=null,g=0;g<e.length;g++)v||p.push(v={start:g,end:e.length-1,level:"rtl"===t?1:"ltr"===t?0:zt(g,!1)}),r[g]&M&&(v.end=g,v=null);for(var m=L|D|R|I|a|N|B|M,W=function(e){return e+(1&e?1:2)},H=function(e){return e+(1&e?2:1)},V=0;V<p.length;V++){var X=[{_level:(v=p[V]).level,_override:0,_isolate:0}],Y=void 0,q=0,$=0,Z=0;c.clear();for(var K=v.start;K<=v.end;K++){var Q=r[K];if(Y=X[X.length-1],c.set(Q,(c.get(Q)||0)+1),Q&o&&c.set(o,(c.get(o)||0)+1),Q&m)if(Q&(L|D)){d[K]=Y._level;var J=(Q===L?H:W)(Y._level);J<=125&&!q&&!$?X.push({_level:J,_override:0,_isolate:0}):q||$++}else if(Q&(R|I)){d[K]=Y._level;var ee=(Q===R?H:W)(Y._level);ee<=125&&!q&&!$?X.push({_level:ee,_override:Q&R?S:x,_isolate:0}):q||$++}else if(Q&a){Q&z&&(Q=1===zt(K+1,!0)?j:G),d[K]=Y._level,Y._override&&f(K,Y._override);var te=(Q===j?H:W)(Y._level);te<=125&&0===q&&0===$?(Z++,X.push({_level:te,_override:0,_isolate:1,_isolInitIndex:K})):q++}else if(Q&N){if(q>0)q--;else if(Z>0){for($=0;!X[X.length-1]._isolate;)X.pop();var re=X[X.length-1]._isolInitIndex;null!=re&&(h.set(re,K),h.set(K,re)),X.pop(),Z--}Y=X[X.length-1],d[K]=Y._level,Y._override&&f(K,Y._override)}else Q&B?(0===q&&($>0?$--:!Y._isolate&&X.length>1&&(X.pop(),Y=X[X.length-1])),d[K]=Y._level):Q&M&&(d[K]=v.level);else d[K]=Y._level,Y._override&&Q!==F&&f(K,Y._override)}for(var ne=[],ae=null,ie=v.start;ie<=v.end;ie++){var oe=r[ie];if(!(oe&s)){var se=d[ie],le=oe&a,ce=oe===N;ae&&se===ae._level?(ae._end=ie,ae._endsWithIsolInit=le):ne.push(ae={_start:ie,_end:ie,_level:se,_startsWithPDI:ce,_endsWithIsolInit:le})}}for(var ue=[],fe=0;fe<ne.length;fe++){var de=ne[fe];if(!de._startsWithPDI||de._startsWithPDI&&!h.has(de._start)){for(var he=[ae=de],pe=void 0;ae&&ae._endsWithIsolInit&&null!=(pe=h.get(ae._end));)for(var ve=fe+1;ve<ne.length;ve++)if(ne[ve]._start===pe){he.push(ae=ne[ve]);break}for(var ge=[],me=0;me<he.length;me++)for(var ye=he[me],be=ye._start;be<=ye._end;be++)ge.push(be);for(var we=d[ge[0]],xe=v.level,Se=ge[0]-1;Se>=0;Se--)if(!(r[Se]&s)){xe=d[Se];break}var _e=ge[ge.length-1],Ue=d[_e],Te=v.level;if(!(r[_e]&a))for(var ke=_e+1;ke<=v.end;ke++)if(!(r[ke]&s)){Te=d[ke];break}ue.push({_seqIndices:ge,_sosType:Math.max(xe,we)%2?S:x,_eosType:Math.max(Te,Ue)%2?S:x})}}for(var Ee=0;Ee<ue.length;Ee++){var Me=ue[Ee],Ce=Me._seqIndices,Ae=Me._sosType,Fe=Me._eosType,Pe=1&d[Ce[0]]?S:x;if(c.get(P))for(var Oe=0;Oe<Ce.length;Oe++){var Ie=Ce[Oe];if(r[Ie]&P){for(var Re=Ae,De=Oe-1;De>=0;De--)if(!(r[Ce[De]]&s)){Re=r[Ce[De]];break}f(Ie,Re&(a|N)?A:Re)}}if(c.get(_))for(var Le=0;Le<Ce.length;Le++){var Be=Ce[Le];if(r[Be]&_)for(var Ge=Le-1;Ge>=-1;Ge--){var je=-1===Ge?Ae:r[Ce[Ge]];if(je&i){je===O&&f(Be,k);break}}}if(c.get(O))for(var ze=0;ze<Ce.length;ze++){var Ne=Ce[ze];r[Ne]&O&&f(Ne,S)}if(c.get(U)||c.get(E))for(var We=1;We<Ce.length-1;We++){var He=Ce[We];if(r[He]&(U|E)){for(var Ve=0,Xe=0,Ye=We-1;Ye>=0&&(Ve=r[Ce[Ye]])&s;Ye--);for(var qe=We+1;qe<Ce.length&&(Xe=r[Ce[qe]])&s;qe++);Ve===Xe&&(r[He]===U?Ve===_:Ve&(_|k))&&f(He,Ve)}}if(c.get(_))for(var $e=0;$e<Ce.length;$e++){var Ze=Ce[$e];if(r[Ze]&_){for(var Ke=$e-1;Ke>=0&&r[Ce[Ke]]&(T|s);Ke--)f(Ce[Ke],_);for($e++;$e<Ce.length&&r[Ce[$e]]&(T|s|_);$e++)r[Ce[$e]]!==_&&f(Ce[$e],_)}}if(c.get(T)||c.get(U)||c.get(E))for(var Qe=0;Qe<Ce.length;Qe++){var Je=Ce[Qe];if(r[Je]&(T|U|E)){f(Je,A);for(var et=Qe-1;et>=0&&r[Ce[et]]&s;et--)f(Ce[et],A);for(var tt=Qe+1;tt<Ce.length&&r[Ce[tt]]&s;tt++)f(Ce[tt],A)}}if(c.get(_))for(var rt=0,nt=Ae;rt<Ce.length;rt++){var at=Ce[rt],it=r[at];it&_?nt===x&&f(at,x):it&i&&(nt=it)}if(c.get(o)){for(var ot=S|_|k,st=ot|x,lt=[],ct=[],ut=0;ut<Ce.length;ut++)if(r[Ce[ut]]&o){var ft=e[Ce[ut]],dt=void 0;if(null!==y(ft)){if(!(ct.length<63))break;ct.push({char:ft,seqIndex:ut})}else if(null!==(dt=b(ft)))for(var ht=ct.length-1;ht>=0;ht--){var pt=ct[ht].char;if(pt===dt||pt===b(w(ft))||y(w(pt))===ft){lt.push([ct[ht].seqIndex,ut]),ct.length=ht;break}}}lt.sort(function(e,t){return e[0]-t[0]});for(var vt=0;vt<lt.length;vt++){for(var gt=lt[vt],mt=gt[0],yt=gt[1],bt=!1,wt=0,xt=mt+1;xt<yt;xt++){var St=Ce[xt];if(r[St]&st){bt=!0;var _t=r[St]&ot?S:x;if(_t===Pe){wt=_t;break}}}if(bt&&!wt){wt=Ae;for(var Ut=mt-1;Ut>=0;Ut--){var Tt=Ce[Ut];if(r[Tt]&st){var kt=r[Tt]&ot?S:x;wt=kt!==Pe?kt:Pe;break}}}if(wt){if(r[Ce[mt]]=r[Ce[yt]]=wt,wt!==Pe)for(var Et=mt+1;Et<Ce.length;Et++)if(!(r[Ce[Et]]&s)){u(e[Ce[Et]])&P&&(r[Ce[Et]]=wt);break}if(wt!==Pe)for(var Mt=yt+1;Mt<Ce.length;Mt++)if(!(r[Ce[Mt]]&s)){u(e[Ce[Mt]])&P&&(r[Ce[Mt]]=wt);break}}}for(var Ct=0;Ct<Ce.length;Ct++)if(r[Ce[Ct]]&o){for(var At=Ct,Ft=Ct,Pt=Ae,Ot=Ct-1;Ot>=0;Ot--){if(!(r[Ce[Ot]]&s)){Pt=r[Ce[Ot]]&ot?S:x;break}At=Ot}for(var It=Fe,Rt=Ct+1;Rt<Ce.length;Rt++){if(!(r[Ce[Rt]]&(o|s))){It=r[Ce[Rt]]&ot?S:x;break}Ft=Rt}for(var Dt=At;Dt<=Ft;Dt++)r[Ce[Dt]]=Pt===It?Pt:Pe;Ct=Ft}}}for(var Lt=v.start;Lt<=v.end;Lt++){var Bt=d[Lt],Gt=r[Lt];if(1&Bt?Gt&(x|_|k)&&d[Lt]++:Gt&S?d[Lt]++:Gt&(k|_)&&(d[Lt]+=2),Gt&s&&(d[Lt]=0===Lt?v.level:d[Lt-1]),Lt===v.end||u(e[Lt])&(C|M))for(var jt=Lt;jt>=0&&u(e[jt])&l;jt--)d[jt]=v.level}}return{levels:d,paragraphs:p};function zt(t,n){for(var i=t;i<e.length;i++){var o=r[i];if(o&(S|O))return 1;if(o&(M|x)||n&&o===N)return 0;if(o&a){var s=Nt(i);i=-1===s?e.length:s}}return 0}function Nt(t){for(var n=1,i=t+1;i<e.length;i++){var o=r[i];if(o&M)break;if(o&N){if(0===--n)return i}else o&a&&n++}return-1}},e.getMirroredCharacter=H,e.getMirroredCharactersMap=function(e,t,r,n){var a=e.length;r=Math.max(0,null==r?0:+r),n=Math.min(a-1,null==n?a-1:+n);for(var i=new Map,o=r;o<=n;o++)if(1&t[o]){var s=H(e[o]);null!==s&&i.set(o,s)}return i},e.getReorderSegments=V,e.getReorderedIndices=X,e.getReorderedString=function(e,t,r,n){var a=X(e,t,r,n),i=[].concat(e);return a.forEach(function(r,n){i[n]=(1&t.levels[r]?H(e[r]):null)||e[r]}),i.join("")},e.openingToClosingBracket=y,Object.defineProperty(e,"__esModule",{value:!0}),e}({});return e}],init:(e,t,r)=>e(t,r())}),yr=At({name:"Typesetter",dependencies:[mr],init:e=>function(t){return new Promise(r=>{e.typeset(t,r)})},getTransferables(e){const t=[];for(let r in e)e[r]&&e[r].buffer&&t.push(e[r].buffer);return t}});yr.onMainThread;const br={};const wr="aTroikaGlyphIndex";class xr extends O{constructor(){super(),this.detail=1,this.curveRadius=0,this.groups=[{start:0,count:1/0,materialIndex:0},{start:0,count:1/0,materialIndex:1}],this.boundingSphere=new I,this.boundingBox=new R}computeBoundingSphere(){}computeBoundingBox(){}set detail(e){if(e!==this._detail){this._detail=e,("number"!=typeof e||e<1)&&(e=1);let t=function(e){let t=br[e];return t||(t=br[e]=new j(1,1,e,e).translate(.5,.5,0)),t}(e);["position","normal","uv"].forEach(e=>{this.attributes[e]=t.attributes[e].clone()}),this.setIndex(t.getIndex().clone())}}get detail(){return this._detail}set curveRadius(e){e!==this._curveRadius&&(this._curveRadius=e,this._updateBounds())}get curveRadius(){return this._curveRadius}updateGlyphs(e,t,r,n,a){this.updateAttributeData("aTroikaGlyphBounds",e,4),this.updateAttributeData(wr,t,1),this.updateAttributeData("aTroikaGlyphColor",a,3),this._blockBounds=r,this._chunkedBounds=n,this.instanceCount=t.length,this._updateBounds()}_updateBounds(){const e=this._blockBounds;if(e){const{curveRadius:t,boundingBox:r}=this;if(t){const{PI:n,floor:a,min:i,max:o,sin:s,cos:l}=Math,c=n/2,u=2*n,f=Math.abs(t),d=e[0]/f,h=e[2]/f,p=a((d+c)/u)!==a((h+c)/u)?-f:i(s(d)*f,s(h)*f),v=a((d-c)/u)!==a((h-c)/u)?f:o(s(d)*f,s(h)*f),g=a((d+n)/u)!==a((h+n)/u)?2*f:o(f-l(d)*f,f-l(h)*f);r.min.set(p,e[1],t<0?-g:0),r.max.set(v,e[3],t<0?0:g)}else r.min.set(e[0],e[1],0),r.max.set(e[2],e[3],0);r.getBoundingSphere(this.boundingSphere)}}applyClipRect(e){let t=this.getAttribute(wr).count,r=this._chunkedBounds;if(r)for(let n=r.length;n--;){t=r[n].end;let a=r[n].rect;if(a[1]<e.w&&a[3]>e.y&&a[0]<e.z&&a[2]>e.x)break}this.instanceCount=t}updateAttributeData(e,t,r){const n=this.getAttribute(e);t?n&&n.array.length===t.length?(n.array.set(t),n.needsUpdate=!0):(this.setAttribute(e,new D(t,r)),delete this._maxInstanceCount,this.dispose()):n&&this.deleteAttribute(e)}}const Sr=new A({color:16777215,side:s,transparent:!0}),_r=8421504,Ur=new P,Tr=new u,kr=new u,Er=[],Mr=new u,Cr="+x+y";function Ar(e){return Array.isArray(e)?e[0]:e}let Fr=()=>{const e=new a(new j(1,1),Sr);return Fr=()=>e,e},Pr=()=>{const e=new a(new j(1,1,32,1),Sr);return Pr=()=>e,e};const Or={type:"syncstart"},Ir={type:"synccomplete"},Rr=["font","fontSize","fontStyle","fontWeight","lang","letterSpacing","lineHeight","maxWidth","overflowWrap","text","direction","textAlign","textIndent","whiteSpace","anchorX","anchorY","colorRanges","sdfGlyphSize"],Dr=Rr.concat("material","color","depthOffset","clipRect","curveRadius","orientation","glyphGeometryDetail");let Lr=class extends a{constructor(){super(new xr,null),this.text="",this.anchorX=0,this.anchorY=0,this.curveRadius=0,this.direction="auto",this.font=null,this.unicodeFontsURL=null,this.fontSize=.1,this.fontWeight="normal",this.fontStyle="normal",this.lang=null,this.letterSpacing=0,this.lineHeight="normal",this.maxWidth=1/0,this.overflowWrap="normal",this.textAlign="left",this.textIndent=0,this.whiteSpace="normal",this.material=null,this.color=null,this.colorRanges=null,this.outlineWidth=0,this.outlineColor=0,this.outlineOpacity=1,this.outlineBlur=0,this.outlineOffsetX=0,this.outlineOffsetY=0,this.strokeWidth=0,this.strokeColor=_r,this.strokeOpacity=1,this.fillOpacity=1,this.depthOffset=0,this.clipRect=null,this.orientation=Cr,this.glyphGeometryDetail=1,this.sdfGlyphSize=null,this.gpuAccelerateSDF=!0,this.debugSDF=!1}sync(e){this._needsSync&&(this._needsSync=!1,this._isSyncing?(this._queuedSyncs||(this._queuedSyncs=[])).push(e):(this._isSyncing=!0,this.dispatchEvent(Or),dr({text:this.text,font:this.font,lang:this.lang,fontSize:this.fontSize||.1,fontWeight:this.fontWeight||"normal",fontStyle:this.fontStyle||"normal",letterSpacing:this.letterSpacing||0,lineHeight:this.lineHeight||"normal",maxWidth:this.maxWidth,direction:this.direction||"auto",textAlign:this.textAlign,textIndent:this.textIndent,whiteSpace:this.whiteSpace,overflowWrap:this.overflowWrap,anchorX:this.anchorX,anchorY:this.anchorY,colorRanges:this.colorRanges,includeCaretPositions:!0,sdfGlyphSize:this.sdfGlyphSize,gpuAccelerateSDF:this.gpuAccelerateSDF,unicodeFontsURL:this.unicodeFontsURL},t=>{this._isSyncing=!1,this._textRenderInfo=t,this.geometry.updateGlyphs(t.glyphBounds,t.glyphAtlasIndices,t.blockBounds,t.chunkedBounds,t.glyphColors);const r=this._queuedSyncs;r&&(this._queuedSyncs=null,this._needsSync=!0,this.sync(()=>{r.forEach(e=>e&&e())})),this.dispatchEvent(Ir),e&&e()})))}onBeforeRender(e,t,r,n,a,i){this.sync(),a.isTroikaTextMaterial&&this._prepareForRender(a)}dispose(){this.geometry.dispose()}get textRenderInfo(){return this._textRenderInfo||null}createDerivedMaterial(e){return function(e){const t=Nt(e,{chained:!0,extensions:{derivatives:!0},uniforms:{uTroikaSDFTexture:{value:null},uTroikaSDFTextureSize:{value:new v},uTroikaSDFGlyphSize:{value:0},uTroikaSDFExponent:{value:0},uTroikaTotalBounds:{value:new G(0,0,0,0)},uTroikaClipRect:{value:new G(0,0,0,0)},uTroikaEdgeOffset:{value:0},uTroikaFillOpacity:{value:1},uTroikaPositionOffset:{value:new v},uTroikaCurveRadius:{value:0},uTroikaBlurRadius:{value:0},uTroikaStrokeWidth:{value:0},uTroikaStrokeColor:{value:new F},uTroikaStrokeOpacity:{value:1},uTroikaOrient:{value:new B},uTroikaUseGlyphColors:{value:!0},uTroikaSDFDebug:{value:!1}},vertexDefs:"\nuniform vec2 uTroikaSDFTextureSize;\nuniform float uTroikaSDFGlyphSize;\nuniform vec4 uTroikaTotalBounds;\nuniform vec4 uTroikaClipRect;\nuniform mat3 uTroikaOrient;\nuniform bool uTroikaUseGlyphColors;\nuniform float uTroikaEdgeOffset;\nuniform float uTroikaBlurRadius;\nuniform vec2 uTroikaPositionOffset;\nuniform float uTroikaCurveRadius;\nattribute vec4 aTroikaGlyphBounds;\nattribute float aTroikaGlyphIndex;\nattribute vec3 aTroikaGlyphColor;\nvarying vec2 vTroikaGlyphUV;\nvarying vec4 vTroikaTextureUVBounds;\nvarying float vTroikaTextureChannel;\nvarying vec3 vTroikaGlyphColor;\nvarying vec2 vTroikaGlyphDimensions;\n",vertexTransform:"\nvec4 bounds = aTroikaGlyphBounds;\nbounds.xz += uTroikaPositionOffset.x;\nbounds.yw -= uTroikaPositionOffset.y;\n\nvec4 outlineBounds = vec4(\n  bounds.xy - uTroikaEdgeOffset - uTroikaBlurRadius,\n  bounds.zw + uTroikaEdgeOffset + uTroikaBlurRadius\n);\nvec4 clippedBounds = vec4(\n  clamp(outlineBounds.xy, uTroikaClipRect.xy, uTroikaClipRect.zw),\n  clamp(outlineBounds.zw, uTroikaClipRect.xy, uTroikaClipRect.zw)\n);\n\nvec2 clippedXY = (mix(clippedBounds.xy, clippedBounds.zw, position.xy) - bounds.xy) / (bounds.zw - bounds.xy);\n\nposition.xy = mix(bounds.xy, bounds.zw, clippedXY);\n\nuv = (position.xy - uTroikaTotalBounds.xy) / (uTroikaTotalBounds.zw - uTroikaTotalBounds.xy);\n\nfloat rad = uTroikaCurveRadius;\nif (rad != 0.0) {\n  float angle = position.x / rad;\n  position.xz = vec2(sin(angle) * rad, rad - cos(angle) * rad);\n  normal.xz = vec2(sin(angle), cos(angle));\n}\n  \nposition = uTroikaOrient * position;\nnormal = uTroikaOrient * normal;\n\nvTroikaGlyphUV = clippedXY.xy;\nvTroikaGlyphDimensions = vec2(bounds[2] - bounds[0], bounds[3] - bounds[1]);\n\n\nfloat txCols = uTroikaSDFTextureSize.x / uTroikaSDFGlyphSize;\nvec2 txUvPerSquare = uTroikaSDFGlyphSize / uTroikaSDFTextureSize;\nvec2 txStartUV = txUvPerSquare * vec2(\n  mod(floor(aTroikaGlyphIndex / 4.0), txCols),\n  floor(floor(aTroikaGlyphIndex / 4.0) / txCols)\n);\nvTroikaTextureUVBounds = vec4(txStartUV, vec2(txStartUV) + txUvPerSquare);\nvTroikaTextureChannel = mod(aTroikaGlyphIndex, 4.0);\n",fragmentDefs:"\nuniform sampler2D uTroikaSDFTexture;\nuniform vec2 uTroikaSDFTextureSize;\nuniform float uTroikaSDFGlyphSize;\nuniform float uTroikaSDFExponent;\nuniform float uTroikaEdgeOffset;\nuniform float uTroikaFillOpacity;\nuniform float uTroikaBlurRadius;\nuniform vec3 uTroikaStrokeColor;\nuniform float uTroikaStrokeWidth;\nuniform float uTroikaStrokeOpacity;\nuniform bool uTroikaSDFDebug;\nvarying vec2 vTroikaGlyphUV;\nvarying vec4 vTroikaTextureUVBounds;\nvarying float vTroikaTextureChannel;\nvarying vec2 vTroikaGlyphDimensions;\n\nfloat troikaSdfValueToSignedDistance(float alpha) {\n  // Inverse of exponential encoding in webgl-sdf-generator\n  \n  float maxDimension = max(vTroikaGlyphDimensions.x, vTroikaGlyphDimensions.y);\n  float absDist = (1.0 - pow(2.0 * (alpha > 0.5 ? 1.0 - alpha : alpha), 1.0 / uTroikaSDFExponent)) * maxDimension;\n  float signedDist = absDist * (alpha > 0.5 ? -1.0 : 1.0);\n  return signedDist;\n}\n\nfloat troikaGlyphUvToSdfValue(vec2 glyphUV) {\n  vec2 textureUV = mix(vTroikaTextureUVBounds.xy, vTroikaTextureUVBounds.zw, glyphUV);\n  vec4 rgba = texture2D(uTroikaSDFTexture, textureUV);\n  float ch = floor(vTroikaTextureChannel + 0.5); //NOTE: can't use round() in WebGL1\n  return ch == 0.0 ? rgba.r : ch == 1.0 ? rgba.g : ch == 2.0 ? rgba.b : rgba.a;\n}\n\nfloat troikaGlyphUvToDistance(vec2 uv) {\n  return troikaSdfValueToSignedDistance(troikaGlyphUvToSdfValue(uv));\n}\n\nfloat troikaGetAADist() {\n  \n  #if defined(GL_OES_standard_derivatives) || __VERSION__ >= 300\n  return length(fwidth(vTroikaGlyphUV * vTroikaGlyphDimensions)) * 0.5;\n  #else\n  return vTroikaGlyphDimensions.x / 64.0;\n  #endif\n}\n\nfloat troikaGetFragDistValue() {\n  vec2 clampedGlyphUV = clamp(vTroikaGlyphUV, 0.5 / uTroikaSDFGlyphSize, 1.0 - 0.5 / uTroikaSDFGlyphSize);\n  float distance = troikaGlyphUvToDistance(clampedGlyphUV);\n \n  // Extrapolate distance when outside bounds:\n  distance += clampedGlyphUV == vTroikaGlyphUV ? 0.0 : \n    length((vTroikaGlyphUV - clampedGlyphUV) * vTroikaGlyphDimensions);\n\n  \n\n  return distance;\n}\n\nfloat troikaGetEdgeAlpha(float distance, float distanceOffset, float aaDist) {\n  #if defined(IS_DEPTH_MATERIAL) || defined(IS_DISTANCE_MATERIAL)\n  float alpha = step(-distanceOffset, -distance);\n  #else\n\n  float alpha = smoothstep(\n    distanceOffset + aaDist,\n    distanceOffset - aaDist,\n    distance\n  );\n  #endif\n\n  return alpha;\n}\n",fragmentColorTransform:"\nfloat aaDist = troikaGetAADist();\nfloat fragDistance = troikaGetFragDistValue();\nfloat edgeAlpha = uTroikaSDFDebug ?\n  troikaGlyphUvToSdfValue(vTroikaGlyphUV) :\n  troikaGetEdgeAlpha(fragDistance, uTroikaEdgeOffset, max(aaDist, uTroikaBlurRadius));\n\n#if !defined(IS_DEPTH_MATERIAL) && !defined(IS_DISTANCE_MATERIAL)\nvec4 fillRGBA = gl_FragColor;\nfillRGBA.a *= uTroikaFillOpacity;\nvec4 strokeRGBA = uTroikaStrokeWidth == 0.0 ? fillRGBA : vec4(uTroikaStrokeColor, uTroikaStrokeOpacity);\nif (fillRGBA.a == 0.0) fillRGBA.rgb = strokeRGBA.rgb;\ngl_FragColor = mix(fillRGBA, strokeRGBA, smoothstep(\n  -uTroikaStrokeWidth - aaDist,\n  -uTroikaStrokeWidth + aaDist,\n  fragDistance\n));\ngl_FragColor.a *= edgeAlpha;\n#endif\n\nif (edgeAlpha == 0.0) {\n  discard;\n}\n",customRewriter({vertexShader:e,fragmentShader:t}){let r=/\buniform\s+vec3\s+diffuse\b/;return r.test(t)&&(t=t.replace(r,"varying vec3 vTroikaGlyphColor").replace(/\bdiffuse\b/g,"vTroikaGlyphColor"),r.test(e)||(e=e.replace(It,"uniform vec3 diffuse;\n$&\nvTroikaGlyphColor = uTroikaUseGlyphColors ? aTroikaGlyphColor / 255.0 : diffuse;\n"))),{vertexShader:e,fragmentShader:t}}});return t.transparent=!0,t.forceSinglePass=!0,Object.defineProperties(t,{isTroikaTextMaterial:{value:!0},shadowSide:{get(){return this.side},set(){}}}),t}(e)}get material(){let e=this._derivedMaterial;const t=this._baseMaterial||this._defaultMaterial||(this._defaultMaterial=Sr.clone());if(e&&e.isDerivedFrom(t)||(e=this._derivedMaterial=this.createDerivedMaterial(t),t.addEventListener("dispose",function r(){t.removeEventListener("dispose",r),e.dispose()})),this.hasOutline()){let t=e._outlineMtl;return t||(t=e._outlineMtl=Object.create(e,{id:{value:e.id+.1}}),t.isTextOutlineMaterial=!0,t.depthWrite=!1,t.map=null,e.addEventListener("dispose",function r(){e.removeEventListener("dispose",r),t.dispose()})),[t,e]}return e}set material(e){e&&e.isTroikaTextMaterial?(this._derivedMaterial=e,this._baseMaterial=e.baseMaterial):this._baseMaterial=e}hasOutline(){return!!(this.outlineWidth||this.outlineBlur||this.outlineOffsetX||this.outlineOffsetY)}get glyphGeometryDetail(){return this.geometry.detail}set glyphGeometryDetail(e){this.geometry.detail=e}get curveRadius(){return this.geometry.curveRadius}set curveRadius(e){this.geometry.curveRadius=e}get customDepthMaterial(){return Ar(this.material).getDepthMaterial()}set customDepthMaterial(e){}get customDistanceMaterial(){return Ar(this.material).getDistanceMaterial()}set customDistanceMaterial(e){}_prepareForRender(e){const t=e.isTextOutlineMaterial,r=e.uniforms,n=this.textRenderInfo;if(n){const{sdfTexture:e,blockBounds:a}=n;r.uTroikaSDFTexture.value=e,r.uTroikaSDFTextureSize.value.set(e.image.width,e.image.height),r.uTroikaSDFGlyphSize.value=n.sdfGlyphSize,r.uTroikaSDFExponent.value=n.sdfExponent,r.uTroikaTotalBounds.value.fromArray(a),r.uTroikaUseGlyphColors.value=!t&&!!n.glyphColors;let i,o,s,l=0,c=0,u=0,f=0,d=0;if(t){let{outlineWidth:e,outlineOffsetX:t,outlineOffsetY:r,outlineBlur:n,outlineOpacity:a}=this;l=this._parsePercent(e)||0,c=Math.max(0,this._parsePercent(n)||0),i=a,f=this._parsePercent(t)||0,d=this._parsePercent(r)||0}else u=Math.max(0,this._parsePercent(this.strokeWidth)||0),u&&(s=this.strokeColor,r.uTroikaStrokeColor.value.set(null==s?_r:s),o=this.strokeOpacity,null==o&&(o=1)),i=this.fillOpacity;r.uTroikaEdgeOffset.value=l,r.uTroikaPositionOffset.value.set(f,d),r.uTroikaBlurRadius.value=c,r.uTroikaStrokeWidth.value=u,r.uTroikaStrokeOpacity.value=o,r.uTroikaFillOpacity.value=null==i?1:i,r.uTroikaCurveRadius.value=this.curveRadius||0;let h=this.clipRect;if(h&&Array.isArray(h)&&4===h.length)r.uTroikaClipRect.value.fromArray(h);else{const e=100*(this.fontSize||.1);r.uTroikaClipRect.value.set(a[0]-e,a[1]-e,a[2]+e,a[3]+e)}this.geometry.applyClipRect(r.uTroikaClipRect.value)}r.uTroikaSDFDebug.value=!!this.debugSDF,e.polygonOffset=!!this.depthOffset,e.polygonOffsetFactor=e.polygonOffsetUnits=this.depthOffset||0;const a=t?this.outlineColor||0:this.color;if(null==a)delete e.color;else{const t=e.hasOwnProperty("color")?e.color:e.color=new F;a===t._input&&"object"!=typeof a||t.set(t._input=a)}let i=this.orientation||Cr;if(i!==e._orientation){let t=r.uTroikaOrient.value;i=i.replace(/[^-+xyz]/g,"");let n=i!==Cr&&i.match(/^([-+])([xyz])([-+])([xyz])$/);if(n){let[,e,r,a,i]=n;Tr.set(0,0,0)[r]="-"===e?1:-1,kr.set(0,0,0)[i]="-"===a?-1:1,Ur.lookAt(Mr,Tr.cross(kr),kr),t.setFromMatrix4(Ur)}else t.identity();e._orientation=i}}_parsePercent(e){if("string"==typeof e){let t=e.match(/^(-?[\d.]+)%$/),r=t?parseFloat(t[1]):NaN;e=(isNaN(r)?0:r/100)*this.fontSize}return e}localPositionToTextCoords(e,t=new v){t.copy(e);const r=this.curveRadius;return r&&(t.x=Math.atan2(e.x,Math.abs(r)-Math.abs(e.z))*Math.abs(r)),t}worldPositionToTextCoords(e,t=new v){return Tr.copy(e),this.localPositionToTextCoords(this.worldToLocal(Tr),t)}raycast(e,t){const{textRenderInfo:r,curveRadius:n}=this;if(r){const a=r.blockBounds,i=n?Pr():Fr(),o=i.geometry,{position:s,uv:l}=o.attributes;for(let e=0;e<l.count;e++){let t=a[0]+l.getX(e)*(a[2]-a[0]);const r=a[1]+l.getY(e)*(a[3]-a[1]);let i=0;n&&(i=n-Math.cos(t/n)*n,t=Math.sin(t/n)*n),s.setXYZ(e,t,r,i)}o.boundingSphere=this.geometry.boundingSphere,o.boundingBox=this.geometry.boundingBox,i.matrixWorld=this.matrixWorld,i.material.side=this.material.side,Er.length=0,i.raycast(e,Er);for(let e=0;e<Er.length;e++)Er[e].object=this,t.push(Er[e])}}copy(e){const t=this.geometry;return super.copy(e),this.geometry=t,Dr.forEach(t=>{this[t]=e[t]}),this}clone(){return(new this.constructor).copy(this)}};Rr.forEach(e=>{const t="_private_"+e;Object.defineProperty(Lr.prototype,e,{get(){return this[t]},set(e){e!==this[t]&&(this[t]=e,this._needsSync=!0)}})}),new R,new F;const Br=r.forwardRef(({sdfGlyphSize:e=64,anchorX:t="center",anchorY:n="middle",font:a,fontSize:i=1,children:o,characters:s,onSync:l,...c},u)=>{const f=de(({invalidate:e})=>e),[d]=r.useState(()=>new Lr),[h,p]=r.useMemo(()=>{const e=[];let t="";return r.Children.forEach(o,r=>{"string"==typeof r||"number"==typeof r?t+=r:e.push(r)}),[e,t]},[o]);return he(()=>new Promise(e=>function({font:e,characters:t,sdfGlyphSize:r},n){dr({font:e,sdfGlyphSize:r,text:Array.isArray(t)?t.join("\n"):""+t},n)}({font:a,characters:s},e)),["troika-text",a,s]),r.useLayoutEffect(()=>{d.sync(()=>{f(),l&&l(d)})}),r.useEffect(()=>()=>d.dispose(),[d]),r.createElement("primitive",Oe({object:d,ref:u,font:a,text:p,anchorX:t,anchorY:n,fontSize:i,sdfGlyphSize:e},c),h)});function Gr(e,t,r,n){const a=class extends o{constructor(n={}){const a=Object.entries(e);super({uniforms:a.reduce((e,[t,r])=>({...e,...M.clone({[t]:{value:r}})}),{}),vertexShader:t,fragmentShader:r}),this.key="",a.forEach(([e])=>Object.defineProperty(this,e,{get:()=>this.uniforms[e].value,set:t=>this.uniforms[e].value=t})),Object.assign(this,n)}};return a.key=z.generateUUID(),a}const jr=(()=>parseInt(n.replace(/\D+/g,"")))();const zr=r.forwardRef(({envMap:e,resolution:t=256,frames:n=1/0,makeDefault:a,children:i,...o},s)=>{const l=de(({set:e})=>e),c=de(({camera:e})=>e),u=de(({size:e})=>e),f=r.useRef(null);r.useImperativeHandle(s,()=>f.current,[]);const d=r.useRef(null),h=function(e,t,n){const a=de(e=>e.size),i=de(e=>e.viewport),o="number"==typeof e?e:a.width*i.dpr,s=a.height*i.dpr,l=("number"==typeof e?n:e)||{},{samples:c=0,depth:u,...f}=l,d=r.useMemo(()=>{const e=new N(o,s,{minFilter:S,magFilter:S,type:b,...f});return u&&(e.depthTexture=new W(o,s,w)),e.samples=c,e},[]);return r.useLayoutEffect(()=>{d.setSize(o,s),c&&(d.samples=c)},[c,d,o,s]),r.useEffect(()=>()=>d.dispose(),[]),d}(t);r.useLayoutEffect(()=>{o.manual||(f.current.aspect=u.width/u.height)},[u,o]),r.useLayoutEffect(()=>{f.current.updateProjectionMatrix()});let p=0,v=null;const g="function"==typeof i;return pe(t=>{g&&(n===1/0||p<n)&&(d.current.visible=!1,t.gl.setRenderTarget(h),v=t.scene.background,e&&(t.scene.background=e),t.gl.render(t.scene,f.current),t.scene.background=v,t.gl.setRenderTarget(null),d.current.visible=!0,p++)}),r.useLayoutEffect(()=>{if(a){const e=c;return l(()=>({camera:f.current})),()=>l(()=>({camera:e}))}},[f,a,l]),r.createElement(r.Fragment,null,r.createElement("perspectiveCamera",Oe({ref:f},o),!g&&i),r.createElement("group",{ref:d},g&&i(h.texture)))}),Nr=r.forwardRef(({makeDefault:e,camera:t,regress:n,domElement:a,enableDamping:i=!0,keyEvents:o=!1,onChange:s,onStart:l,onEnd:c,...u},f)=>{const d=de(e=>e.invalidate),h=de(e=>e.camera),p=de(e=>e.gl),v=de(e=>e.events),g=de(e=>e.setEvents),m=de(e=>e.set),y=de(e=>e.get),b=de(e=>e.performance),w=t||h,x=a||v.connected||p.domElement,S=r.useMemo(()=>new yt(w),[w]);return pe(()=>{S.enabled&&S.update()},-1),r.useEffect(()=>(o&&S.connect(!0===o?x:o),S.connect(x),()=>{S.dispose()}),[o,x,n,S,d]),r.useEffect(()=>{const e=e=>{d(),n&&b.regress(),s&&s(e)},t=e=>{l&&l(e)},r=e=>{c&&c(e)};return S.addEventListener("change",e),S.addEventListener("start",t),S.addEventListener("end",r),()=>{S.removeEventListener("start",t),S.removeEventListener("end",r),S.removeEventListener("change",e)}},[s,l,c,S,d,g]),r.useEffect(()=>{if(e){const e=y().controls;return m({controls:S}),()=>m({controls:e})}},[e,S]),r.createElement("primitive",Oe({ref:f,object:S,enableDamping:i},u))}),Wr=Gr({cellSize:.5,sectionSize:1,fadeDistance:100,fadeStrength:1,fadeFrom:1,cellThickness:.5,sectionThickness:1,cellColor:new F,sectionColor:new F,infiniteGrid:!1,followCamera:!1,worldCamProjPosition:new u,worldPlanePosition:new u},"\n    varying vec3 localPosition;\n    varying vec4 worldPosition;\n\n    uniform vec3 worldCamProjPosition;\n    uniform vec3 worldPlanePosition;\n    uniform float fadeDistance;\n    uniform bool infiniteGrid;\n    uniform bool followCamera;\n\n    void main() {\n      localPosition = position.xzy;\n      if (infiniteGrid) localPosition *= 1.0 + fadeDistance;\n      \n      worldPosition = modelMatrix * vec4(localPosition, 1.0);\n      if (followCamera) {\n        worldPosition.xyz += (worldCamProjPosition - worldPlanePosition);\n        localPosition = (inverse(modelMatrix) * worldPosition).xyz;\n      }\n\n      gl_Position = projectionMatrix * viewMatrix * worldPosition;\n    }\n  ",`\n    varying vec3 localPosition;\n    varying vec4 worldPosition;\n\n    uniform vec3 worldCamProjPosition;\n    uniform float cellSize;\n    uniform float sectionSize;\n    uniform vec3 cellColor;\n    uniform vec3 sectionColor;\n    uniform float fadeDistance;\n    uniform float fadeStrength;\n    uniform float fadeFrom;\n    uniform float cellThickness;\n    uniform float sectionThickness;\n\n    float getGrid(float size, float thickness) {\n      vec2 r = localPosition.xz / size;\n      vec2 grid = abs(fract(r - 0.5) - 0.5) / fwidth(r);\n      float line = min(grid.x, grid.y) + 1.0 - thickness;\n      return 1.0 - min(line, 1.0);\n    }\n\n    void main() {\n      float g1 = getGrid(cellSize, cellThickness);\n      float g2 = getGrid(sectionSize, sectionThickness);\n\n      vec3 from = worldCamProjPosition*vec3(fadeFrom);\n      float dist = distance(from, worldPosition.xyz);\n      float d = 1.0 - min(dist / fadeDistance, 1.0);\n      vec3 color = mix(cellColor, sectionColor, min(1.0, sectionThickness * g2));\n\n      gl_FragColor = vec4(color, (g1 + g2) * pow(d, fadeStrength));\n      gl_FragColor.a = mix(0.75 * gl_FragColor.a, gl_FragColor.a, g2);\n      if (gl_FragColor.a <= 0.0) discard;\n\n      #include <tonemapping_fragment>\n      #include <${jr>=154?"colorspace_fragment":"encodings_fragment"}>\n    }\n  `),Hr=r.forwardRef(({args:e,cellColor:t="#000000",sectionColor:n="#2080ff",cellSize:a=.5,sectionSize:i=1,followCamera:o=!1,infiniteGrid:s=!1,fadeDistance:l=100,fadeStrength:c=1,fadeFrom:f=1,cellThickness:d=.5,sectionThickness:h=1,side:p=H,...v},g)=>{ve({GridMaterial:Wr});const y=r.useRef(null);r.useImperativeHandle(g,()=>y.current,[]);const b=new m,w=new u(0,1,0),x=new u(0,0,0);pe(e=>{b.setFromNormalAndCoplanarPoint(w,x).applyMatrix4(y.current.matrixWorld);const t=y.current.material,r=t.uniforms.worldCamProjPosition,n=t.uniforms.worldPlanePosition;b.projectPoint(e.camera.position,r.value),n.value.set(0,0,0).applyMatrix4(y.current.matrixWorld)});const S={cellSize:a,sectionSize:i,cellColor:t,sectionColor:n,cellThickness:d,sectionThickness:h},_={fadeDistance:l,fadeStrength:c,fadeFrom:f,infiniteGrid:s,followCamera:o};return r.createElement("mesh",Oe({ref:y,frustumCulled:!1},v),r.createElement("gridMaterial",Oe({transparent:!0,"extensions-derivatives":!0,side:p},S,_)),r.createElement("planeGeometry",{args:e}))}),Vr=(e,t,r)=>{let n;switch(e){case te:n=new Uint8ClampedArray(t*r*4);break;case b:n=new Uint16Array(t*r*4);break;case ee:n=new Uint32Array(t*r*4);break;case J:n=new Int8Array(t*r*4);break;case Q:n=new Int16Array(t*r*4);break;case K:n=new Int32Array(t*r*4);break;case w:n=new Float32Array(t*r*4);break;default:throw new Error("Unsupported data type")}return n};let Xr;class Yr{_renderer;_rendererIsDisposable=!1;_material;_scene;_camera;_quad;_renderTarget;_width;_height;_type;_colorSpace;_supportsReadPixels=!0;constructor(e){this._width=e.width,this._height=e.height,this._type=e.type,this._colorSpace=e.colorSpace;const t={format:_,depthBuffer:!1,stencilBuffer:!1,type:this._type,colorSpace:this._colorSpace,anisotropy:void 0!==e.renderTargetOptions?.anisotropy?e.renderTargetOptions?.anisotropy:1,generateMipmaps:void 0!==e.renderTargetOptions?.generateMipmaps&&e.renderTargetOptions?.generateMipmaps,magFilter:void 0!==e.renderTargetOptions?.magFilter?e.renderTargetOptions?.magFilter:S,minFilter:void 0!==e.renderTargetOptions?.minFilter?e.renderTargetOptions?.minFilter:S,samples:void 0!==e.renderTargetOptions?.samples?e.renderTargetOptions?.samples:void 0,wrapS:void 0!==e.renderTargetOptions?.wrapS?e.renderTargetOptions?.wrapS:V,wrapT:void 0!==e.renderTargetOptions?.wrapT?e.renderTargetOptions?.wrapT:V};if(this._material=e.material,e.renderer?this._renderer=e.renderer:(this._renderer=Yr.instantiateRenderer(),this._rendererIsDisposable=!0),this._scene=new X,this._camera=new f,this._camera.position.set(0,0,10),this._camera.left=-.5,this._camera.right=.5,this._camera.top=.5,this._camera.bottom=-.5,this._camera.updateProjectionMatrix(),!((e,t,r,n)=>{if(void 0!==Xr)return Xr;const i=new N(1,1,n);t.setRenderTarget(i);const o=new a(new j,new A({color:16777215}));t.render(o,r),t.setRenderTarget(null);const s=Vr(e,i.width,i.height);return t.readRenderTargetPixels(i,0,0,i.width,i.height,s),i.dispose(),o.geometry.dispose(),o.material.dispose(),Xr=0!==s[0],Xr})(this._type,this._renderer,this._camera,t)){let e;if(this._type===b)e=this._renderer.extensions.has("EXT_color_buffer_float")?w:void 0;void 0!==e?this._type=e:this._supportsReadPixels=!1}this._quad=new a(new j,this._material),this._quad.geometry.computeBoundingBox(),this._scene.add(this._quad),this._renderTarget=new N(this.width,this.height,t),this._renderTarget.texture.mapping=void 0!==e.renderTargetOptions?.mapping?e.renderTargetOptions?.mapping:Y}static instantiateRenderer(){const e=new q;return e.setSize(128,128),e}render=()=>{this._renderer.setRenderTarget(this._renderTarget);try{this._renderer.render(this._scene,this._camera)}catch(Sn){throw this._renderer.setRenderTarget(null),Sn}this._renderer.setRenderTarget(null)};toArray(){if(!this._supportsReadPixels)throw new Error("Can't read pixels in this browser");const e=Vr(this._type,this._width,this._height);return this._renderer.readRenderTargetPixels(this._renderTarget,0,0,this._width,this._height,e),e}toDataTexture(e){const t=new $(this.toArray(),this.width,this.height,_,this._type,e?.mapping||Y,e?.wrapS||V,e?.wrapT||V,e?.magFilter||S,e?.minFilter||S,e?.anisotropy||1,Z);return t.generateMipmaps=void 0!==e?.generateMipmaps&&e?.generateMipmaps,t}disposeOnDemandRenderer(){this._renderer.setRenderTarget(null),this._rendererIsDisposable&&(this._renderer.dispose(),this._renderer.forceContextLoss())}dispose(e){this.disposeOnDemandRenderer(),e&&this.renderTarget.dispose(),this.material instanceof o&&Object.values(this.material.uniforms).forEach(e=>{e.value instanceof L&&e.value.dispose()}),Object.values(this.material).forEach(e=>{e instanceof L&&e.dispose()}),this.material.dispose(),this._quad.geometry.dispose()}get width(){return this._width}set width(e){this._width=e,this._renderTarget.setSize(this._width,this._height)}get height(){return this._height}set height(e){this._height=e,this._renderTarget.setSize(this._width,this._height)}get renderer(){return this._renderer}get renderTarget(){return this._renderTarget}set renderTarget(e){this._renderTarget=e,this._width=e.width,this._height=e.height}get material(){return this._material}get type(){return this._type}get colorSpace(){return this._colorSpace}}class qr extends Error{}class $r extends Error{}const Zr=(e,t,r)=>{const n=new RegExp(`${t}="([^"]*)"`,"i").exec(e);if(n)return n[1];const a=new RegExp(`<${t}[^>]*>([\\s\\S]*?)</${t}>`,"i").exec(e);if(a){const e=a[1].match(/<rdf:li>([^<]*)<\/rdf:li>/g);return e&&3===e.length?e.map(e=>e.replace(/<\/?rdf:li>/g,"")):a[1].trim()}if(void 0!==r)return r;throw new Error(`Can't find ${t} in gainmap metadata`)};class Kr{options;constructor(e){this.options={debug:!(!e||void 0===e.debug)&&e.debug,extractFII:!e||void 0===e.extractFII||e.extractFII,extractNonFII:!e||void 0===e.extractNonFII||e.extractNonFII}}extract(e){return new Promise((t,r)=>{this.options.debug;const n=new DataView(e.buffer);if(65496!==n.getUint16(0))return void r(new Error("Not a valid jpeg"));const a=n.byteLength;let i,o=2,s=0;for(;o<a;){if(++s>250)return void r(new Error(`Found no marker after ${s} loops `));if(255!==n.getUint8(o))return void r(new Error(`Not a valid marker at offset 0x${o.toString(16)}, found: 0x${n.getUint8(o).toString(16)}`));if(i=n.getUint8(o+1),226===i){const e=o+4;if(1297106432===n.getUint32(e)){const a=e+4;let i;if(18761===n.getUint16(a))i=!1;else{if(19789!==n.getUint16(a))return void r(new Error("No valid endianness marker found in TIFF header"));i=!0}if(42!==n.getUint16(a+2,!i))return void r(new Error("Not valid TIFF data! (no 0x002A marker)"));const o=n.getUint32(a+4,!i);if(o<8)return void r(new Error("Not valid TIFF data! (First offset less than 8)"));const s=a+o,l=n.getUint16(s,!i),c=s+2;let u=0;for(let e=c;e<c+12*l;e+=12)45057===n.getUint16(e,!i)&&(u=n.getUint32(e+8,!i));const f=s+2+12*l+4,d=[];for(let e=f;e<f+16*u;e+=16){const t={MPType:n.getUint32(e,!i),size:n.getUint32(e+4,!i),dataOffset:n.getUint32(e+8,!i),dependantImages:n.getUint32(e+12,!i),start:-1,end:-1,isFII:!1};t.dataOffset?(t.start=a+t.dataOffset,t.isFII=!1):(t.start=0,t.isFII=!0),t.end=t.start+t.size,d.push(t)}if(this.options.extractNonFII&&d.length){const e=new Blob([n]),r=[];for(const t of d){if(t.isFII&&!this.options.extractFII)continue;const n=e.slice(t.start,t.end+1,"image/jpeg");r.push(n)}t(r)}}}o+=2+n.getUint16(o+2)}})}}const Qr=async e=>{const t=(e=>{let t;t="undefined"!=typeof TextDecoder?(new TextDecoder).decode(e):e.toString();let r=t.indexOf("<x:xmpmeta");for(;-1!==r;){const e=t.indexOf("x:xmpmeta>",r),n=t.slice(r,e+10);try{const e=Zr(n,"hdrgm:GainMapMin","0"),t=Zr(n,"hdrgm:GainMapMax"),r=Zr(n,"hdrgm:Gamma","1"),a=Zr(n,"hdrgm:OffsetSDR","0.015625"),i=Zr(n,"hdrgm:OffsetHDR","0.015625"),o=/hdrgm:HDRCapacityMin="([^"]*)"/.exec(n),s=o?o[1]:"0",l=/hdrgm:HDRCapacityMax="([^"]*)"/.exec(n);if(!l)throw new Error("Incomplete gainmap metadata");const c=l[1];return{gainMapMin:Array.isArray(e)?e.map(e=>parseFloat(e)):[parseFloat(e),parseFloat(e),parseFloat(e)],gainMapMax:Array.isArray(t)?t.map(e=>parseFloat(e)):[parseFloat(t),parseFloat(t),parseFloat(t)],gamma:Array.isArray(r)?r.map(e=>parseFloat(e)):[parseFloat(r),parseFloat(r),parseFloat(r)],offsetSdr:Array.isArray(a)?a.map(e=>parseFloat(e)):[parseFloat(a),parseFloat(a),parseFloat(a)],offsetHdr:Array.isArray(i)?i.map(e=>parseFloat(e)):[parseFloat(i),parseFloat(i),parseFloat(i)],hdrCapacityMin:parseFloat(s),hdrCapacityMax:parseFloat(c)}}catch(Sn){}r=t.indexOf("<x:xmpmeta",e)}})(e);if(!t)throw new $r("Gain map XMP metadata not found");const r=new Kr({extractFII:!0,extractNonFII:!0}),n=await r.extract(e);if(2!==n.length)throw new qr("Gain map recovery image not found");return{sdr:new Uint8Array(await n[0].arrayBuffer()),gainMap:new Uint8Array(await n[1].arrayBuffer()),metadata:t}},Jr=e=>new Promise((t,r)=>{const n=document.createElement("img");n.onload=()=>{t(n)},n.onerror=e=>{r(e)},n.src=URL.createObjectURL(e)});class en extends re{_renderer;_renderTargetOptions;_internalLoadingManager;_config;constructor(e,t){super(t),this._config=e,e.renderer&&(this._renderer=e.renderer),this._internalLoadingManager=new ne}setRenderer(e){return this._renderer=e,this}setRenderTargetOptions(e){return this._renderTargetOptions=e,this}prepareQuadRenderer(){this._renderer;const e=this._config.createMaterial({gainMapMax:[1,1,1],gainMapMin:[0,0,0],gamma:[1,1,1],offsetHdr:[1,1,1],offsetSdr:[1,1,1],hdrCapacityMax:1,hdrCapacityMin:0,maxDisplayBoost:1,gainMap:new L,sdr:new L});return this._config.createQuadRenderer({width:16,height:16,type:b,colorSpace:Z,material:e,renderer:this._renderer,renderTargetOptions:this._renderTargetOptions})}async processImages(e,t,r){const n=t?new Blob([t],{type:"image/jpeg"}):void 0,a=new Blob([e],{type:"image/jpeg"});let i,o,s=!1;if("undefined"==typeof createImageBitmap){const e=await Promise.all([n?Jr(n):Promise.resolve(void 0),Jr(a)]);o=e[0],i=e[1],s="flipY"===r}else{const e=await Promise.all([n?createImageBitmap(n,{imageOrientation:r||"flipY"}):Promise.resolve(void 0),createImageBitmap(a,{imageOrientation:r||"flipY"})]);o=e[0],i=e[1]}return{sdrImage:i,gainMapImage:o,needsFlip:s}}createTextures(e,t,r){const n=new L(t||new ImageData(2,2),Y,V,V,S,ae,_,te,1,Z);n.flipY=r,n.needsUpdate=!0;const a=new L(e,Y,V,V,S,ae,_,te,1,ie);return a.flipY=r,a.needsUpdate=!0,{gainMap:n,sdr:a}}updateQuadRenderer(e,t,r,n,a){e.width=t.width,e.height=t.height,e.material.gainMap=r,e.material.sdr=n,e.material.gainMapMin=a.gainMapMin,e.material.gainMapMax=a.gainMapMax,e.material.offsetHdr=a.offsetHdr,e.material.offsetSdr=a.offsetSdr,e.material.gamma=a.gamma,e.material.hdrCapacityMin=a.hdrCapacityMin,e.material.hdrCapacityMax=a.hdrCapacityMax,e.material.maxDisplayBoost=Math.pow(2,a.hdrCapacityMax),e.material.needsUpdate=!0}}class tn extends o{_maxDisplayBoost;_hdrCapacityMin;_hdrCapacityMax;constructor({gamma:e,offsetHdr:t,offsetSdr:r,gainMapMin:n,gainMapMax:a,maxDisplayBoost:i,hdrCapacityMin:o,hdrCapacityMax:s,sdr:l,gainMap:c}){super({name:"GainMapDecoderMaterial",vertexShader:"\nvarying vec2 vUv;\n\nvoid main() {\n  vUv = uv;\n  gl_Position = projectionMatrix * modelViewMatrix * vec4(position, 1.0);\n}\n",fragmentShader:"\n// min half float value\n#define HALF_FLOAT_MIN vec3( -65504, -65504, -65504 )\n// max half float value\n#define HALF_FLOAT_MAX vec3( 65504, 65504, 65504 )\n\nuniform sampler2D sdr;\nuniform sampler2D gainMap;\nuniform vec3 gamma;\nuniform vec3 offsetHdr;\nuniform vec3 offsetSdr;\nuniform vec3 gainMapMin;\nuniform vec3 gainMapMax;\nuniform float weightFactor;\n\nvarying vec2 vUv;\n\nvoid main() {\n  vec3 rgb = texture2D( sdr, vUv ).rgb;\n  vec3 recovery = texture2D( gainMap, vUv ).rgb;\n  vec3 logRecovery = pow( recovery, gamma );\n  vec3 logBoost = gainMapMin * ( 1.0 - logRecovery ) + gainMapMax * logRecovery;\n  vec3 hdrColor = (rgb + offsetSdr) * exp2( logBoost * weightFactor ) - offsetHdr;\n  vec3 clampedHdrColor = max( HALF_FLOAT_MIN, min( HALF_FLOAT_MAX, hdrColor ));\n  gl_FragColor = vec4( clampedHdrColor , 1.0 );\n}\n",uniforms:{sdr:{value:l},gainMap:{value:c},gamma:{value:new u(1/e[0],1/e[1],1/e[2])},offsetHdr:{value:(new u).fromArray(t)},offsetSdr:{value:(new u).fromArray(r)},gainMapMin:{value:(new u).fromArray(n)},gainMapMax:{value:(new u).fromArray(a)},weightFactor:{value:(Math.log2(i)-o)/(s-o)}},blending:se,depthTest:!1,depthWrite:!1}),this._maxDisplayBoost=i,this._hdrCapacityMin=o,this._hdrCapacityMax=s,this.needsUpdate=!0,this.uniformsNeedUpdate=!0}get sdr(){return this.uniforms.sdr.value}set sdr(e){this.uniforms.sdr.value=e}get gainMap(){return this.uniforms.gainMap.value}set gainMap(e){this.uniforms.gainMap.value=e}get offsetHdr(){return this.uniforms.offsetHdr.value.toArray()}set offsetHdr(e){this.uniforms.offsetHdr.value.fromArray(e)}get offsetSdr(){return this.uniforms.offsetSdr.value.toArray()}set offsetSdr(e){this.uniforms.offsetSdr.value.fromArray(e)}get gainMapMin(){return this.uniforms.gainMapMin.value.toArray()}set gainMapMin(e){this.uniforms.gainMapMin.value.fromArray(e)}get gainMapMax(){return this.uniforms.gainMapMax.value.toArray()}set gainMapMax(e){this.uniforms.gainMapMax.value.fromArray(e)}get gamma(){const e=this.uniforms.gamma.value;return[1/e.x,1/e.y,1/e.z]}set gamma(e){const t=this.uniforms.gamma.value;t.x=1/e[0],t.y=1/e[1],t.z=1/e[2]}get hdrCapacityMin(){return this._hdrCapacityMin}set hdrCapacityMin(e){this._hdrCapacityMin=e,this.calculateWeight()}get hdrCapacityMax(){return this._hdrCapacityMax}set hdrCapacityMax(e){this._hdrCapacityMax=e,this.calculateWeight()}get maxDisplayBoost(){return this._maxDisplayBoost}set maxDisplayBoost(e){this._maxDisplayBoost=Math.max(1,Math.min(65504,e)),this.calculateWeight()}calculateWeight(){const e=(Math.log2(this._maxDisplayBoost)-this._hdrCapacityMin)/(this._hdrCapacityMax-this._hdrCapacityMin);this.uniforms.weightFactor.value=Math.max(0,Math.min(1,e))}}class rn extends en{constructor(e,t){super({renderer:e,createMaterial:e=>new tn(e),createQuadRenderer:e=>new Yr(e)},t)}async render(e,t,r,n){const{sdrImage:a,gainMapImage:i,needsFlip:o}=await this.processImages(r,n,"flipY"),{gainMap:s,sdr:l}=this.createTextures(a,i,o);this.updateQuadRenderer(e,a,s,l,t),e.render()}}class nn extends rn{load([e,t,r],n,a,i){const o=this.prepareQuadRenderer();let s,l,c;const u=async()=>{if(s&&l&&c){try{await this.render(o,c,s,l)}catch(a){return this.manager.itemError(e),this.manager.itemError(t),this.manager.itemError(r),"function"==typeof i&&i(a),void o.disposeOnDemandRenderer()}"function"==typeof n&&n(o),this.manager.itemEnd(e),this.manager.itemEnd(t),this.manager.itemEnd(r),o.disposeOnDemandRenderer()}};let f=!0,d=0,h=0,p=!0,v=0,g=0,m=!0,y=0,b=0;const w=()=>{if("function"==typeof a){a(new ProgressEvent("progress",{lengthComputable:f&&p&&m,loaded:h+g+b,total:d+v+y}))}};this.manager.itemStart(e),this.manager.itemStart(t),this.manager.itemStart(r);const x=new oe(this._internalLoadingManager);x.setResponseType("arraybuffer"),x.setRequestHeader(this.requestHeader),x.setPath(this.path),x.setWithCredentials(this.withCredentials),x.load(e,async e=>{if("string"==typeof e)throw new Error("Invalid sdr buffer");s=e,await u()},e=>{f=e.lengthComputable,h=e.loaded,d=e.total,w()},t=>{this.manager.itemError(e),"function"==typeof i&&i(t)});const S=new oe(this._internalLoadingManager);S.setResponseType("arraybuffer"),S.setRequestHeader(this.requestHeader),S.setPath(this.path),S.setWithCredentials(this.withCredentials),S.load(t,async e=>{if("string"==typeof e)throw new Error("Invalid gainmap buffer");l=e,await u()},e=>{p=e.lengthComputable,g=e.loaded,v=e.total,w()},e=>{this.manager.itemError(t),"function"==typeof i&&i(e)});const _=new oe(this._internalLoadingManager);return _.setRequestHeader(this.requestHeader),_.setPath(this.path),_.setWithCredentials(this.withCredentials),_.load(r,async e=>{if("string"!=typeof e)throw new Error("Invalid metadata string");c=JSON.parse(e),await u()},e=>{m=e.lengthComputable,b=e.loaded,y=e.total,w()},e=>{this.manager.itemError(r),"function"==typeof i&&i(e)}),o}}class an extends rn{load(e,t,r,n){const a=this.prepareQuadRenderer(),i=new oe(this._internalLoadingManager);return i.setResponseType("arraybuffer"),i.setRequestHeader(this.requestHeader),i.setPath(this.path),i.setWithCredentials(this.withCredentials),this.manager.itemStart(e),i.load(e,async r=>{if("string"==typeof r)throw new Error("Invalid buffer, received [string], was expecting [ArrayBuffer]");const i=new Uint8Array(r);let o,s,l;try{const e=await Qr(i);o=e.sdr,s=e.gainMap,l=e.metadata}catch(Sn){if(!(Sn instanceof $r||Sn instanceof qr))throw Sn;l={gainMapMin:[0,0,0],gainMapMax:[1,1,1],gamma:[1,1,1],hdrCapacityMin:0,hdrCapacityMax:1,offsetHdr:[0,0,0],offsetSdr:[0,0,0]},o=i}try{await this.render(a,l,o.buffer,s?.buffer)}catch(c){return this.manager.itemError(e),"function"==typeof n&&n(c),void a.disposeOnDemandRenderer()}"function"==typeof t&&t(a),this.manager.itemEnd(e),a.disposeOnDemandRenderer()},r,t=>{this.manager.itemError(e),"function"==typeof n&&n(t)}),a}}const on={apartment:"lebombo_1k.hdr",city:"potsdamer_platz_1k.hdr",dawn:"kiara_1_dawn_1k.hdr",forest:"forest_slope_1k.hdr",lobby:"st_fagans_interior_1k.hdr",night:"dikhololo_night_1k.hdr",park:"rooitou_park_1k.hdr",studio:"studio_small_03_1k.hdr",sunset:"venice_sunset_1k.hdr",warehouse:"empty_warehouse_01_1k.hdr"},sn="https://raw.githack.com/pmndrs/drei-assets/456060a26bbeb8fdf79326f224b6d99b8bcce736/hdri/",ln=e=>Array.isArray(e),cn=["/px.png","/nx.png","/py.png","/ny.png","/pz.png","/nz.png"];function un({files:e=cn,path:t="",preset:n,encoding:a,extensions:i}={}){let o=null,s=!1;n&&(hn(n),e=on[n],t=sn),s=ln(e);const{extension:l,isCubemap:c}=pn(e);if(o=vn(l),!o)throw new Error("useEnvironment: Unrecognized file extension: "+e);const u=de(e=>e.gl);r.useLayoutEffect(()=>{"webp"!==l&&"jpg"!==l&&"jpeg"!==l||u.domElement.addEventListener("webglcontextlost",function(){ge.clear(o,s?[e]:e)},{once:!0})},[e,u.domElement]);const f=ge(o,s?[e]:e,e=>{"webp"!==l&&"jpg"!==l&&"jpeg"!==l||e.setRenderer(u),null==e.setPath||e.setPath(t),i&&i(e)});let d=s?f[0]:f;var h;"jpg"!==l&&"jpeg"!==l&&"webp"!==l||(d=null==(h=d.renderTarget)?void 0:h.texture);return d.mapping=c?le:ce,"colorSpace"in d?d.colorSpace=(null!=a?a:c)?"srgb":"srgb-linear":d.encoding=(null!=a?a:c)?3001:3e3,d}const fn={files:cn,path:"",preset:void 0,extensions:void 0};un.preload=e=>{const t={...fn,...e};let{files:r,path:n=""}=t;const{preset:a,extensions:i}=t;a&&(hn(a),r=on[a],n=sn);const{extension:o}=pn(r);if("webp"===o||"jpg"===o||"jpeg"===o)throw new Error("useEnvironment: Preloading gainmaps is not supported");const s=vn(o);if(!s)throw new Error("useEnvironment: Unrecognized file extension: "+r);ge.preload(s,ln(r)?[r]:r,e=>{null==e.setPath||e.setPath(n),i&&i(e)})};const dn={files:cn,preset:void 0};function hn(e){if(!(e in on))throw new Error("Preset must be one of: "+Object.keys(on).join(", "))}function pn(e){var t;const r=ln(e)&&6===e.length,n=ln(e)&&3===e.length&&e.some(e=>e.endsWith("json")),a=ln(e)?e[0]:e;return{extension:r?"cube":n?"webp":a.startsWith("data:application/exr")?"exr":a.startsWith("data:application/hdr")?"hdr":a.startsWith("data:image/jpeg")?"jpg":null==(t=a.split(".").pop())||null==(t=t.split("?"))||null==(t=t.shift())?void 0:t.toLowerCase(),isCubemap:r,isGainmap:n}}function vn(e){return"cube"===e?ue:"hdr"===e?bt:"exr"===e?xt:"jpg"===e||"jpeg"===e?an:"webp"===e?nn:null}un.clear=e=>{const t={...dn,...e};let{files:r}=t;const{preset:n}=t;n&&(hn(n),r=on[n]);const{extension:a}=pn(r),i=vn(a);if(!i)throw new Error("useEnvironment: Unrecognized file extension: "+r);ge.clear(i,ln(r)?[r]:r)};function gn(e,t,r,n,a={}){var i,o,s,l;a={backgroundBlurriness:0,backgroundIntensity:1,backgroundRotation:[0,0,0],environmentIntensity:1,environmentRotation:[0,0,0],...a};const c=(e=>{return(t=e).current&&t.current.isScene?e.current:e;var t})(t||r),u=c.background,f=c.environment,d={backgroundBlurriness:c.backgroundBlurriness,backgroundIntensity:c.backgroundIntensity,backgroundRotation:null!==(i=null==(o=c.backgroundRotation)||null==o.clone?void 0:o.clone())&&void 0!==i?i:[0,0,0],environmentIntensity:c.environmentIntensity,environmentRotation:null!==(s=null==(l=c.environmentRotation)||null==l.clone?void 0:l.clone())&&void 0!==s?s:[0,0,0]};return"only"!==e&&(c.environment=n),e&&(c.background=n),ye(c,a),()=>{"only"!==e&&(c.environment=f),e&&(c.background=u),ye(c,d)}}function mn({scene:e,background:t=!1,map:n,...a}){const i=de(e=>e.scene);return r.useLayoutEffect(()=>{if(n)return gn(t,e,i,n,a)}),null}function yn({background:e=!1,scene:t,blur:n,backgroundBlurriness:a,backgroundIntensity:i,backgroundRotation:o,environmentIntensity:s,environmentRotation:l,...c}){const u=un(c),f=de(e=>e.scene);return r.useLayoutEffect(()=>gn(e,t,f,u,{backgroundBlurriness:null!=n?n:a,backgroundIntensity:i,backgroundRotation:o,environmentIntensity:s,environmentRotation:l})),r.useEffect(()=>()=>{u.dispose()},[u]),null}function bn({children:e,near:t=.1,far:n=1e3,resolution:a=256,frames:i=1,map:o,background:s=!1,blur:l,backgroundBlurriness:c,backgroundIntensity:u,backgroundRotation:f,environmentIntensity:d,environmentRotation:h,scene:p,files:v,path:g,preset:m,extensions:y}){const w=de(e=>e.gl),x=de(e=>e.scene),S=r.useRef(null),[_]=r.useState(()=>new X),U=r.useMemo(()=>{const e=new fe(a);return e.texture.type=b,e},[a]);r.useEffect(()=>()=>{U.dispose()},[U]),r.useLayoutEffect(()=>{if(1===i){const e=w.autoClear;w.autoClear=!0,S.current.update(w,_),w.autoClear=e}return gn(s,p,x,U.texture,{backgroundBlurriness:null!=l?l:c,backgroundIntensity:u,backgroundRotation:f,environmentIntensity:d,environmentRotation:h})},[e,_,U.texture,p,x,s,i,w]);let T=1;return pe(()=>{if(i===1/0||T<i){const e=w.autoClear;w.autoClear=!0,S.current.update(w,_),w.autoClear=e,T++}}),r.createElement(r.Fragment,null,me(r.createElement(r.Fragment,null,e,r.createElement("cubeCamera",{ref:S,args:[t,n,U]}),v||m?r.createElement(yn,{background:!0,files:v,preset:m,path:g,extensions:y}):o?r.createElement(mn,{background:!0,map:o,extensions:y}):null),_))}function wn(e){var t,n,a,i;const o=un(e),s=e.map||o;r.useMemo(()=>ve({GroundProjectedEnvImpl:lt}),[]),r.useEffect(()=>()=>{o.dispose()},[o]);const l=r.useMemo(()=>[s],[s]),c=null==(t=e.ground)?void 0:t.height,u=null==(n=e.ground)?void 0:n.radius,f=null!==(a=null==(i=e.ground)?void 0:i.scale)&&void 0!==a?a:1e3;return r.createElement(r.Fragment,null,r.createElement(mn,Oe({},e,{map:s})),r.createElement("groundProjectedEnvImpl",{args:l,scale:f,height:c,radius:u}))}function xn(e){return e.ground?r.createElement(wn,e):e.map?r.createElement(mn,e):e.children?r.createElement(bn,e):r.createElement(yn,e)}export{xn as E,Hr as G,Nr as O,zr as P,xe as R,Br as T,Oe as _,Pe as a,ke as d,Ae as p};
